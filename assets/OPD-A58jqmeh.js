import{r as i,d as Z,j as e}from"./index-DIh5wxCw.js";import{b as ee,C as te,S as se,D as ae,d as ie,e as le,f as C}from"./AdminLayout-CVdM3u-8.js";import{C as g,d as f,B as v}from"./card-BVj2mpCd.js";import{I as b}from"./index-CXyJ5PVz.js";import{L as d}from"./label-BOSjw2jr.js";import{T as ne}from"./textarea-DqMGnoNS.js";import{B as re}from"./badge-DwC97fZb.js";import{T as ce,a as oe,b as T,c as m,d as de,e as o}from"./table-Da73gdk8.js";import{T as me,D as he,a as xe,b as pe,c as ue,e as je,d as ge}from"./dialog-CmLsLM44.js";import{S as O,a as V,b as P,c as E,d as k}from"./select-DxzT1k0b.js";import{o as N}from"./admissionService-CGLJfqEq.js";import{p as fe}from"./patientService-DfHmjeND.js";import{d as ve}from"./doctorService-xcZhvVgS.js";import{E as Ne,S as we,D as De}from"./DeleteConfirmDialog-nQwB51sc.js";import{U as Se}from"./Combination-B3qkWEI7.js";import{C as _e}from"./circle-check-big-Bo5v3wUR.js";import{P as ye}from"./plus-BlBB68lF.js";import{L as R}from"./loader-circle-u1M5w34w.js";import{E as Ce}from"./eye-BS6eP5P1.js";import"./index-lGeLsNXG.js";const be={Waiting:"bg-warning/10 text-warning border-warning/20","In Consultation":"bg-info/10 text-info border-info/20",Completed:"bg-success/10 text-success border-success/20"},Te=["Waiting","In Consultation","Completed"],Je=()=>{const[w,U]=i.useState([]),[W,B]=i.useState([]),[M,H]=i.useState([]),[F,I]=i.useState(!0),[D,z]=i.useState(""),[q,h]=i.useState(!1),[G,S]=i.useState(!1),[r,p]=i.useState(null),[x,L]=i.useState(!1),[_,u]=i.useState(!1),{toast:c}=Z(),[s,n]=i.useState({patient_id:"",doctor_id:"",visit_date:new Date().toISOString().split("T")[0],visit_time:new Date().toTimeString().slice(0,5),chief_complaint:"",status:"Waiting"});i.useEffect(()=>{y(),Q()},[]);const y=async()=>{var t,a;try{I(!0);const l=await N.getAll({limit:100});U(l.data||[])}catch(l){c({title:"Error",description:((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to load OPD visits",variant:"destructive"})}finally{I(!1)}},Q=async()=>{try{const[t,a]=await Promise.all([fe.getAll({limit:200}),ve.getAll({limit:100})]);B(t.data||[]),H(a.data||[])}catch(t){console.error("Failed to load lookups:",t)}},A=()=>{n({patient_id:"",doctor_id:"",visit_date:new Date().toISOString().split("T")[0],visit_time:new Date().toTimeString().slice(0,5),chief_complaint:"",status:"Waiting"}),p(null),L(!1)},$=()=>{A(),h(!0)},J=t=>{var a;p(t),L(!0),n({patient_id:t.patient_id||"",doctor_id:t.doctor_id||"",visit_date:((a=t.visit_date)==null?void 0:a.split("T")[0])||new Date().toISOString().split("T")[0],visit_time:t.visit_time||"",chief_complaint:t.chief_complaint||"",status:t.status||"Waiting"}),h(!0)},K=t=>{p(t),S(!0)},X=async()=>{var t,a;if(!s.patient_id||!s.doctor_id){c({title:"Error",description:"Please select patient and doctor",variant:"destructive"});return}try{u(!0),x&&r?(await N.update(r.id,s),c({title:"Success",description:"Visit updated successfully"})):(await N.create(s),c({title:"Success",description:"OPD visit registered successfully"})),h(!1),A(),y()}catch(l){c({title:"Error",description:((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{u(!1)}},Y=async()=>{var t,a;if(r)try{u(!0),await N.delete(r.id),c({title:"Success",description:"Visit deleted successfully"}),S(!1),p(null),y()}catch(l){c({title:"Error",description:((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to delete visit",variant:"destructive"})}finally{u(!1)}},j=Array.isArray(w)?w.filter(t=>{var a,l;return((a=t.patient_name)==null?void 0:a.toLowerCase().includes(D.toLowerCase()))||((l=t.token_number)==null?void 0:l.toString().includes(D))}):[];return e.jsxs(ee,{title:"OPD",subtitle:"Outpatient Department - Today's Queue",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(g,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Today"}),e.jsx("p",{className:"text-3xl font-bold",children:w.length})]}),e.jsx(Se,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(g,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Waiting"}),e.jsx("p",{className:"text-3xl font-bold text-warning",children:j.filter(t=>t.status==="Waiting").length})]}),e.jsx(te,{className:"w-8 h-8 text-warning"})]})})}),e.jsx(g,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-success",children:j.filter(t=>t.status==="Completed").length})]}),e.jsx(_e,{className:"w-8 h-8 text-success"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(b,{placeholder:"Search by name or token...",className:"pl-10",value:D,onChange:t=>z(t.target.value)})]}),e.jsxs(v,{className:"gap-2",onClick:$,children:[e.jsx(ye,{className:"w-4 h-4"}),"New Visit"]})]}),e.jsx(g,{children:e.jsx(f,{className:"p-0",children:F?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(R,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(T,{children:[e.jsx(m,{children:"Token"}),e.jsx(m,{children:"Patient"}),e.jsx(m,{children:"Doctor"}),e.jsx(m,{children:"Department"}),e.jsx(m,{children:"Status"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsxs(de,{children:[j.map(t=>e.jsxs(T,{className:"group",children:[e.jsx(o,{className:"font-bold text-lg",children:t.token_number||"-"}),e.jsx(o,{className:"font-medium",children:t.patient_name||"Unknown"}),e.jsx(o,{children:t.doctor_name||"Unassigned"}),e.jsx(o,{children:t.department_name||"General"}),e.jsx(o,{children:e.jsx(re,{variant:"outline",className:be[t.status]||"",children:t.status})}),e.jsx(o,{className:"text-right",children:e.jsxs(ae,{children:[e.jsx(ie,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(Ne,{className:"w-4 h-4"})})}),e.jsxs(le,{align:"end",children:[e.jsxs(C,{className:"gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"})," View Details"]}),e.jsxs(C,{className:"gap-2",onClick:()=>J(t),children:[e.jsx(we,{className:"w-4 h-4"})," Edit"]}),e.jsxs(C,{className:"gap-2 text-destructive",onClick:()=>K(t),children:[e.jsx(me,{className:"w-4 h-4"})," Delete"]})]})]})})]},t.id)),j.length===0&&!F&&e.jsx(T,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No OPD visits today"})})]})]})})}),e.jsx(he,{open:q,onOpenChange:h,children:e.jsxs(xe,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(pe,{children:[e.jsx(ue,{children:x?"Update OPD Visit":"Register New OPD Visit"}),e.jsx(je,{children:x?"Update visit status or details":"Register a new outpatient visit"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(O,{value:s.patient_id,onValueChange:t=>n({...s,patient_id:t}),children:[e.jsx(V,{children:e.jsx(P,{placeholder:"Select patient"})}),e.jsx(E,{className:"max-h-60",children:W.map(t=>e.jsxs(k,{value:t.id,children:[t.name," (",t.patient_id,")"]},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"doctor_id",children:"Doctor *"}),e.jsxs(O,{value:s.doctor_id,onValueChange:t=>n({...s,doctor_id:t}),children:[e.jsx(V,{children:e.jsx(P,{placeholder:"Select doctor"})}),e.jsx(E,{className:"max-h-60",children:M.map(t=>e.jsxs(k,{value:t.id,children:["Dr. ",t.name," (",t.specialization,")"]},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"visit_date",children:"Visit Date"}),e.jsx(b,{id:"visit_date",type:"date",value:s.visit_date,onChange:t=>n({...s,visit_date:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"visit_time",children:"Visit Time"}),e.jsx(b,{id:"visit_time",type:"time",value:s.visit_time,onChange:t=>n({...s,visit_time:t.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"chief_complaint",children:"Chief Complaint"}),e.jsx(ne,{id:"chief_complaint",value:s.chief_complaint,onChange:t=>n({...s,chief_complaint:t.target.value}),placeholder:"Reason for visit",rows:3})]}),x&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"status",children:"Status"}),e.jsxs(O,{value:s.status,onValueChange:t=>n({...s,status:t}),children:[e.jsx(V,{children:e.jsx(P,{placeholder:"Select status"})}),e.jsx(E,{children:Te.map(t=>e.jsx(k,{value:t,children:t},t))})]})]})]}),e.jsxs(ge,{children:[e.jsx(v,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(v,{onClick:X,disabled:_,children:[_&&e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),x?"Update":"Register"," Visit"]})]})]})}),e.jsx(De,{open:G,onOpenChange:S,onConfirm:Y,title:"Delete OPD Visit",description:`Are you sure you want to delete this visit for ${r==null?void 0:r.patient_name}?`,loading:_})]})};export{Je as default};
