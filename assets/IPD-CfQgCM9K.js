import{r as i,d as te,j as e}from"./index-DZAlsvLE.js";import{c as ae,U as ie,b as ne,L as re,e as le,B as U,D as de,f as oe,g as ce,h as y}from"./AdminLayout-D12jS9pN.js";import{C as g,d as f,I as B,B as N}from"./card-DfuB3kKO.js";import{L as m}from"./label-B7mPZteH.js";import{T as R}from"./textarea-Do4aEMUN.js";import{T as me,a as he,b,c,d as xe,e as l}from"./table-DSRtfemy.js";import{E as ue,i as pe,T as je,D as ge,a as fe,b as Ne,c as ve,k as we,S as A,d as C,e as T,f as P,g as E,h as De,j as Se}from"./DeleteConfirmDialog-DI90Viws.js";import{i as v}from"./admissionService-DJUryvmI.js";import{p as _e}from"./patientService-KkXJnLV6.js";import{d as ye}from"./doctorService-DPzdwUH8.js";import{P as be}from"./plus-j_V7wq7w.js";import{L as V}from"./loader-circle-ONSjYwRk.js";import{E as Ae}from"./eye-lejhtZAQ.js";import"./index-BF5NQnWb.js";const Ce={Admitted:"bg-info/10 text-info border-info/20",Active:"bg-success/10 text-success border-success/20",Discharged:"bg-muted text-muted-foreground border-border",Transferred:"bg-warning/10 text-warning border-warning/20"},Te=["Admitted","Active","Transferred","Discharged"],qe=()=>{const[u,M]=i.useState([]),[H,z]=i.useState([]),[q,W]=i.useState([]),[L,O]=i.useState(!0),[w,$]=i.useState(""),[G,h]=i.useState(!1),[J,D]=i.useState(!1),[d,p]=i.useState(null),[x,I]=i.useState(!1),[S,j]=i.useState(!1),{toast:o}=te(),[t,r]=i.useState({patient_id:"",doctor_id:"",admission_date:new Date().toISOString().split("T")[0],admission_reason:"",diagnosis:"",status:"Admitted"});i.useEffect(()=>{_(),K()},[]);const _=async()=>{var s,a;try{O(!0);const n=await v.getAll({limit:100});M(n.data||[])}catch(n){o({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to load IPD admissions",variant:"destructive"})}finally{O(!1)}},K=async()=>{try{const[s,a]=await Promise.all([_e.getAll({limit:200}),ye.getAll({limit:100})]);z(s.data||[]),W(a.data||[])}catch(s){console.error("Failed to load lookups:",s)}},F=()=>{r({patient_id:"",doctor_id:"",admission_date:new Date().toISOString().split("T")[0],admission_reason:"",diagnosis:"",status:"Admitted"}),p(null),I(!1)},Q=()=>{F(),h(!0)},X=s=>{var a;p(s),I(!0),r({patient_id:s.patient_id||"",doctor_id:s.doctor_id||"",admission_date:((a=s.admission_date)==null?void 0:a.split("T")[0])||new Date().toISOString().split("T")[0],admission_reason:s.admission_reason||"",diagnosis:s.diagnosis||"",status:s.status||"Admitted"}),h(!0)},Y=s=>{p(s),D(!0)},Z=async()=>{var s,a;if(!t.patient_id||!t.doctor_id){o({title:"Error",description:"Please select patient and doctor",variant:"destructive"});return}try{j(!0),x&&d?(await v.update(d.id,t),o({title:"Success",description:"Admission updated successfully"})):(await v.create(t),o({title:"Success",description:"Patient admitted successfully"})),h(!1),F(),_()}catch(n){o({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{j(!1)}},ee=async()=>{var s,a;if(d)try{j(!0),await v.delete(d.id),o({title:"Success",description:"Admission deleted successfully"}),D(!1),p(null),_()}catch(n){o({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete admission",variant:"destructive"})}finally{j(!1)}},k=u.filter(s=>{var a,n;return((a=s.patient_name)==null?void 0:a.toLowerCase().includes(w.toLowerCase()))||((n=s.admission_number)==null?void 0:n.toLowerCase().includes(w.toLowerCase()))}),se=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A";return e.jsxs(ae,{title:"IPD",subtitle:"Inpatient Department - Admitted Patients",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(g,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Admitted"}),e.jsx("p",{className:"text-3xl font-bold",children:u.length})]}),e.jsx(ie,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(g,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold text-success",children:u.filter(s=>s.status==="Active"||s.status==="Admitted").length})]}),e.jsx(ne,{className:"w-8 h-8 text-success"})]})})}),e.jsx(g,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending Discharge"}),e.jsx("p",{className:"text-3xl font-bold text-warning",children:u.filter(s=>s.discharge_date&&!s.actual_discharge).length})]}),e.jsx(re,{className:"w-8 h-8 text-warning"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search admissions...",className:"pl-10",value:w,onChange:s=>$(s.target.value)})]}),e.jsxs(N,{className:"gap-2",onClick:Q,children:[e.jsx(be,{className:"w-4 h-4"}),"New Admission"]})]}),e.jsx(g,{children:e.jsx(f,{className:"p-0",children:L?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(V,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(b,{children:[e.jsx(c,{children:"Admission No."}),e.jsx(c,{children:"Patient"}),e.jsx(c,{children:"Ward/Bed"}),e.jsx(c,{children:"Doctor"}),e.jsx(c,{children:"Admission Date"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsxs(xe,{children:[k.map(s=>e.jsxs(b,{className:"group",children:[e.jsx(l,{className:"font-mono text-sm",children:s.admission_number}),e.jsx(l,{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsx(l,{children:e.jsxs(U,{variant:"secondary",children:[s.ward_name||"N/A"," / ",s.bed_number||"N/A"]})}),e.jsx(l,{children:s.doctor_name||"Unassigned"}),e.jsx(l,{children:se(s.admission_date)}),e.jsx(l,{children:e.jsx(U,{variant:"outline",className:Ce[s.status]||"",children:s.status})}),e.jsx(l,{className:"text-right",children:e.jsxs(de,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(ue,{className:"w-4 h-4"})})}),e.jsxs(ce,{align:"end",children:[e.jsxs(y,{className:"gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"})," View Details"]}),e.jsxs(y,{className:"gap-2",onClick:()=>X(s),children:[e.jsx(pe,{className:"w-4 h-4"})," Edit"]}),e.jsxs(y,{className:"gap-2 text-destructive",onClick:()=>Y(s),children:[e.jsx(je,{className:"w-4 h-4"})," Delete"]})]})]})})]},s.id)),k.length===0&&!L&&e.jsx(b,{children:e.jsx(l,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No admissions found"})})]})]})})}),e.jsx(ge,{open:G,onOpenChange:h,children:e.jsxs(fe,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsx(ve,{children:x?"Update Admission":"New IPD Admission"}),e.jsx(we,{children:x?"Update admission details":"Admit a patient to inpatient department"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(A,{value:t.patient_id,onValueChange:s=>r({...t,patient_id:s}),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Select patient"})}),e.jsx(P,{className:"max-h-60",children:H.map(s=>e.jsxs(E,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"doctor_id",children:"Attending Doctor *"}),e.jsxs(A,{value:t.doctor_id,onValueChange:s=>r({...t,doctor_id:s}),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Select doctor"})}),e.jsx(P,{className:"max-h-60",children:q.map(s=>e.jsxs(E,{value:s.id,children:["Dr. ",s.name," (",s.specialization,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"admission_date",children:"Admission Date"}),e.jsx(B,{id:"admission_date",type:"date",value:t.admission_date,onChange:s=>r({...t,admission_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"admission_reason",children:"Reason for Admission"}),e.jsx(R,{id:"admission_reason",value:t.admission_reason,onChange:s=>r({...t,admission_reason:s.target.value}),placeholder:"Reason for admission",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"diagnosis",children:"Diagnosis"}),e.jsx(R,{id:"diagnosis",value:t.diagnosis,onChange:s=>r({...t,diagnosis:s.target.value}),placeholder:"Primary diagnosis",rows:2})]}),x&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"status",children:"Status"}),e.jsxs(A,{value:t.status,onValueChange:s=>r({...t,status:s}),children:[e.jsx(C,{children:e.jsx(T,{placeholder:"Select status"})}),e.jsx(P,{children:Te.map(s=>e.jsx(E,{value:s,children:s},s))})]})]})]}),e.jsxs(De,{children:[e.jsx(N,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(N,{onClick:Z,disabled:S,children:[S&&e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),x?"Update":"Admit"," Patient"]})]})]})}),e.jsx(Se,{open:J,onOpenChange:D,onConfirm:ee,title:"Delete Admission",description:`Are you sure you want to delete the admission for ${d==null?void 0:d.patient_name}?`,loading:S})]})};export{qe as default};
