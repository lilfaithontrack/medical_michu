import{r as l,d as be,j as e}from"./index-MFUeX4KC.js";import{c as we,b as De,L as J,S as Se,B as K,D as Ce,e as Ae,f as Te,g as F,T as Pe}from"./AdminLayout-CEyGcOXW.js";import{C as E,d as L,B as g}from"./card--ujVzSXa.js";import{U as Oe,I as o}from"./Combination-CVDpaV-S.js";import{L as n}from"./label-Cw8AwbsX.js";import{T as R}from"./textarea-BWkPO5tB.js";import{T as Fe,a as Ee,b as U,c as u,d as Le,e as x}from"./table-tgADzikB.js";import{D as Q,a as X,b as Y,c as Z,e as ee,d as se}from"./dialog-C_l7gpm1.js";import{S as j,a as v,b as _,c as f,d}from"./select-CM0PFwtY.js";import{i as y}from"./admissionService-CN444WKo.js";import{p as Be}from"./patientService-CtAKoHA_.js";import{d as Ie}from"./doctorService-Cf-rqgNH.js";import{E as ke,D as Ve}from"./DeleteConfirmDialog-Tv4EgB03.js";import{P as Re}from"./plus-DrrZjkgX.js";import{L as M}from"./loader-circle-DYBsGSuP.js";import{E as Ue}from"./eye-CxZXf5Ga.js";import{S as Me}from"./square-pen-QpnerZQe.js";import"./index-lz0iHb9C.js";const He={Admitted:"bg-info/10 text-info border-info/20",Active:"bg-success/10 text-success border-success/20",Discharged:"bg-muted text-muted-foreground border-border",Transferred:"bg-warning/10 text-warning border-warning/20"},ls=()=>{const[N,ae]=l.useState([]),[te,ie]=l.useState([]),[ne,re]=l.useState([]),[H,z]=l.useState(!0),[C,le]=l.useState(""),[ce,b]=l.useState(!1),[de,B]=l.useState(!1),[r,w]=l.useState(null),[m,W]=l.useState(!1),[D,p]=l.useState(!1),[I,oe]=l.useState([]),[k,he]=l.useState("All"),me=["Admitted","Active","Discharged","Transferred"],xe=Array.from(new Set(N.map(s=>s.status).filter(Boolean))),q=Array.from(new Set([...me,...xe])),[ue,A]=l.useState(!1),[S,V]=l.useState({discharge_type:"Normal",discharge_summary:""}),{toast:h}=be(),[a,i]=l.useState({patient_id:"",doctor_id:"",bed_id:"",admission_date:new Date().toISOString().split("T")[0],admission_reason:"",diagnosis:"",status:"Admitted",emergency_contact_name:"",emergency_contact_phone:"",emergency_contact_relation:"",height:"",weight:"",bp:"",pulse:"",temperature:"",spo2:""});l.useEffect(()=>{T(),P()},[]);const T=async()=>{var s,t;try{z(!0);const c=await y.getAll({limit:100});ae(c.data||[])}catch(c){h({title:"Error",description:((t=(s=c.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load IPD admissions",variant:"destructive"})}finally{z(!1)}},P=async()=>{try{const[s,t,c]=await Promise.all([Be.getAll({limit:200}),Ie.getAll({limit:100}),y.getAvailableBeds()]);ie(s.data||[]),re(t.data||[]),oe(c||[])}catch(s){console.error("Failed to load lookups:",s)}},$=()=>{i({patient_id:"",doctor_id:"",bed_id:"",admission_date:new Date().toISOString().split("T")[0],admission_reason:"",diagnosis:"",status:"Admitted",emergency_contact_name:"",emergency_contact_phone:"",emergency_contact_relation:"",height:"",weight:"",bp:"",pulse:"",temperature:"",spo2:""}),w(null),W(!1)},pe=()=>{$(),b(!0)},ge=s=>{var t;w(s),W(!0),i({patient_id:s.patient_id||"",doctor_id:s.attending_doctor_id||s.doctor_id||"",bed_id:s.bed_id||"",admission_date:((t=s.admission_date)==null?void 0:t.split("T")[0])||new Date().toISOString().split("T")[0],admission_reason:s.admission_reason||"",diagnosis:s.admitting_diagnosis||s.diagnosis||"",status:s.status||"Admitted",emergency_contact_name:s.emergency_contact_name||"",emergency_contact_phone:s.emergency_contact_phone||"",emergency_contact_relation:s.emergency_contact_relation||"",height:s.height||"",weight:s.weight||"",bp:s.bp||"",pulse:s.pulse||"",temperature:s.temperature||"",spo2:s.spo2||""}),b(!0)},je=s=>{w(s),B(!0)},ve=async s=>{var t,c;if(s.preventDefault(),!m&&(!a.patient_id||!a.doctor_id)){h({title:"Error",description:"Please select patient and doctor",variant:"destructive"});return}try{p(!0),m&&r?(await y.update(r.id,a),h({title:"Success",description:"Admission updated successfully"})):(await y.create(a),h({title:"Success",description:"Patient admitted successfully"})),b(!1),$(),await T(),await P()}catch(O){h({title:"Error",description:((c=(t=O.response)==null?void 0:t.data)==null?void 0:c.message)||"Operation failed",variant:"destructive"})}finally{p(!1)}},_e=async()=>{var s,t;if(r)try{p(!0),await y.delete(r.id),h({title:"Success",description:"Admission deleted successfully"}),B(!1),w(null),await T(),await P()}catch(c){h({title:"Error",description:((t=(s=c.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete admission",variant:"destructive"})}finally{p(!1)}},fe=s=>{w(s),V({discharge_type:"Normal",discharge_summary:""}),A(!0)},ye=async()=>{var s,t;if(r)try{p(!0),await y.discharge(r.id,S),h({title:"Success",description:"Patient discharged successfully"}),A(!1),await T(),await P()}catch(c){h({title:"Error",description:((t=(s=c.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to discharge patient",variant:"destructive"})}finally{p(!1)}},G=N.filter(s=>{var t,c,O;return(k==="All"||s.status===k)&&(((t=s.patient_name)==null?void 0:t.toLowerCase().includes(C.toLowerCase()))||((c=s.admission_id)==null?void 0:c.toLowerCase().includes(C.toLowerCase()))||((O=s.admission_number)==null?void 0:O.toLowerCase().includes(C.toLowerCase())))}),Ne=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A";return e.jsxs(we,{title:"IPD",subtitle:"Inpatient Department - Admitted Patients",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(E,{children:e.jsx(L,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Admitted"}),e.jsx("p",{className:"text-3xl font-bold",children:N.length})]}),e.jsx(Oe,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(E,{children:e.jsx(L,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold text-success",children:N.filter(s=>s.status==="Active"||s.status==="Admitted").length})]}),e.jsx(De,{className:"w-8 h-8 text-success"})]})})}),e.jsx(E,{children:e.jsx(L,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending Discharge"}),e.jsx("p",{className:"text-3xl font-bold text-warning",children:N.filter(s=>s.discharge_date&&!s.actual_discharge).length})]}),e.jsx(J,{className:"w-8 h-8 text-warning"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search admissions...",className:"pl-10",value:C,onChange:s=>le(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{value:k,onValueChange:he,children:[e.jsx(v,{className:"w-[180px]",children:e.jsx(_,{placeholder:"Filter by status"})}),e.jsxs(f,{children:[e.jsx(d,{value:"All",children:"All Statuses"}),q.map(s=>e.jsx(d,{value:s,children:s},s))]})]}),e.jsxs(g,{className:"gap-2",onClick:pe,children:[e.jsx(Re,{className:"w-4 h-4"}),"New Admission"]})]})]}),e.jsx(E,{children:e.jsx(L,{className:"p-0",children:H?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(Fe,{children:[e.jsx(Ee,{children:e.jsxs(U,{children:[e.jsx(u,{children:"Admission No."}),e.jsx(u,{children:"Patient"}),e.jsx(u,{children:"Ward/Bed"}),e.jsx(u,{children:"Doctor"}),e.jsx(u,{children:"Admission Date"}),e.jsx(u,{children:"Status"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsxs(Le,{children:[G.map(s=>e.jsxs(U,{className:"group",children:[e.jsx(x,{className:"font-mono text-sm",children:s.admission_id||s.admission_number}),e.jsx(x,{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsx(x,{children:e.jsxs(K,{variant:"secondary",children:[s.ward_name||"N/A"," / ",s.bed_number||"N/A"]})}),e.jsx(x,{children:s.doctor_name||"Unassigned"}),e.jsx(x,{children:Ne(s.admission_date)}),e.jsx(x,{children:e.jsx(K,{variant:"outline",className:He[s.status]||"",children:s.status})}),e.jsx(x,{className:"text-right",children:e.jsxs(Ce,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(ke,{className:"w-4 h-4"})})}),e.jsxs(Te,{align:"end",children:[e.jsxs(F,{className:"gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"})," View Details"]}),e.jsxs(F,{className:"gap-2",onClick:()=>ge(s),children:[e.jsx(Me,{className:"w-4 h-4"})," Edit"]}),e.jsxs(F,{className:"gap-2 text-destructive",onClick:()=>je(s),children:[e.jsx(Pe,{className:"w-4 h-4"})," Delete"]}),s.status==="Active"||s.status==="Admitted"?e.jsxs(F,{className:"gap-2 text-warning",onClick:()=>fe(s),children:[e.jsx(J,{className:"w-4 h-4"})," Discharge"]}):null]})]})})]},s.id)),G.length===0&&!H&&e.jsx(U,{children:e.jsx(x,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No admissions found"})})]})]})})}),e.jsx(Q,{open:ce,onOpenChange:b,children:e.jsxs(X,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:m?"Update Admission":"New IPD Admission"}),e.jsx(ee,{children:m?"Update admission details":"Admit a patient to inpatient department"})]}),e.jsxs("div",{className:"space-y-6 py-4 px-1",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:"Admission Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(j,{value:a.patient_id,onValueChange:s=>i({...a,patient_id:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select patient"})}),e.jsx(f,{className:"max-h-60",children:te.map(s=>e.jsxs(d,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"doctor_id",children:"Attending Doctor *"}),e.jsxs(j,{value:a.doctor_id,onValueChange:s=>i({...a,doctor_id:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select doctor"})}),e.jsx(f,{className:"max-h-60",children:ne.map(s=>e.jsxs(d,{value:s.id,children:["Dr. ",s.name," (",s.specialization,")"]},s.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"bed_id",children:"Assign Bed"}),e.jsxs(j,{value:a.bed_id,onValueChange:s=>i({...a,bed_id:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:a.bed_id?"Bed Selected":"Select Bed (Optional)"})}),e.jsxs(f,{className:"max-h-60",children:[m&&a.bed_id&&!I.find(s=>s.id===a.bed_id)&&(r==null?void 0:r.bed_number)&&e.jsxs(d,{value:a.bed_id,children:[r.ward_name," - ",r.bed_number," (Current)"]}),I.length===0&&(!m||!a.bed_id)?e.jsx(d,{value:"none",disabled:!0,children:"No beds available"}):I.map(s=>e.jsxs(d,{value:s.id,children:[s.ward_name," - ",s.bed_number," (",s.ward_type,")"]},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"admission_date",children:"Admission Date"}),e.jsx(o,{id:"admission_date",type:"date",value:a.admission_date,onChange:s=>i({...a,admission_date:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"admission_reason",children:"Reason for Admission"}),e.jsx(R,{id:"admission_reason",value:a.admission_reason,onChange:s=>i({...a,admission_reason:s.target.value}),placeholder:"Reason for admission",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"diagnosis",children:"Diagnosis"}),e.jsx(R,{id:"diagnosis",value:a.diagnosis,onChange:s=>i({...a,diagnosis:s.target.value}),placeholder:"Primary diagnosis",rows:2})]}),m&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"status",children:"Status"}),e.jsxs(j,{value:a.status,onValueChange:s=>i({...a,status:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select status"})}),e.jsx(f,{children:q.map(s=>e.jsx(d,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:"Medical Vitals (On Admission)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Height (cm)"}),e.jsx(o,{placeholder:"e.g. 175",value:a.height,onChange:s=>i({...a,height:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Weight (kg)"}),e.jsx(o,{placeholder:"e.g. 70",value:a.weight,onChange:s=>i({...a,weight:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Blood Pressure"}),e.jsx(o,{placeholder:"e.g. 120/80",value:a.bp,onChange:s=>i({...a,bp:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Pulse (bpm)"}),e.jsx(o,{placeholder:"e.g. 72",value:a.pulse,onChange:s=>i({...a,pulse:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Temp (Â°C)"}),e.jsx(o,{placeholder:"e.g. 36.6",value:a.temperature,onChange:s=>i({...a,temperature:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"SPO2 (%)"}),e.jsx(o,{placeholder:"e.g. 98",value:a.spo2,onChange:s=>i({...a,spo2:s.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg border-b pb-2",children:"Emergency Contact"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Name"}),e.jsx(o,{placeholder:"Contact Name",value:a.emergency_contact_name,onChange:s=>i({...a,emergency_contact_name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Relation"}),e.jsx(o,{placeholder:"e.g. Spouse, Parent",value:a.emergency_contact_relation,onChange:s=>i({...a,emergency_contact_relation:s.target.value})})]}),e.jsxs("div",{className:"space-y-2 col-span-2",children:[e.jsx(n,{children:"Phone Number"}),e.jsx(o,{placeholder:"Contact Phone",value:a.emergency_contact_phone,onChange:s=>i({...a,emergency_contact_phone:s.target.value})})]})]})]})]}),e.jsxs(se,{children:[e.jsx(g,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(g,{onClick:ve,disabled:D,children:[D&&e.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}),m?"Update":"Admit"," Patient"]})]})]})}),e.jsx(Ve,{open:de,onOpenChange:B,onConfirm:_e,title:"Delete Admission",description:`Are you sure you want to delete the admission for ${r==null?void 0:r.patient_name}?`,loading:D}),e.jsx(Q,{open:ue,onOpenChange:A,children:e.jsxs(X,{children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Discharge Patient"}),e.jsxs(ee,{children:["Process discharge for ",r==null?void 0:r.patient_name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"discharge_type",children:"Discharge Type"}),e.jsxs(j,{value:S.discharge_type,onValueChange:s=>V({...S,discharge_type:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select type"})}),e.jsxs(f,{children:[e.jsx(d,{value:"Normal",children:"Normal"}),e.jsx(d,{value:"Against Medical Advice",children:"Against Medical Advice"}),e.jsx(d,{value:"Transfer",children:"Transfer"}),e.jsx(d,{value:"Death",children:"Death"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"discharge_summary",children:"Discharge Summary / Notes"}),e.jsx(R,{id:"discharge_summary",value:S.discharge_summary,onChange:s=>V({...S,discharge_summary:s.target.value}),placeholder:"Enter discharge summary, follow-up instructions...",rows:4})]})]}),e.jsxs(se,{children:[e.jsx(g,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsxs(g,{onClick:ye,disabled:D,children:[D&&e.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}),"Confirm Discharge"]})]})]})})]})};export{ls as default};
