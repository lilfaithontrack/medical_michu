import{c as ie,r as i,d as le,j as e}from"./index-DIh5wxCw.js";import{b as ne,S as de,c as ce,D as oe,d as ue,e as me,f as O}from"./AdminLayout-CVdM3u-8.js";import{C as P,d as I,B as y}from"./card-BVj2mpCd.js";import{I as f}from"./index-CXyJ5PVz.js";import{L as d}from"./label-BOSjw2jr.js";import{T as he}from"./textarea-DqMGnoNS.js";import{B as L}from"./badge-DwC97fZb.js";import{T as pe,a as ge,b as k,c,d as xe,e as n}from"./table-Da73gdk8.js";import{T as je,D as ye,a as fe,b as _e,c as Se,e as ve,d as Ne}from"./dialog-CmLsLM44.js";import{S as _,a as S,b as v,c as N,d as w}from"./select-DxzT1k0b.js";import{s as g}from"./facilityService-BbI0RlTq.js";import{p as we}from"./patientService-DfHmjeND.js";import{d as Ce}from"./doctorService-xcZhvVgS.js";import{E as De,S as be,D as Te}from"./DeleteConfirmDialog-nQwB51sc.js";import{P as Ee}from"./plus-BlBB68lF.js";import{L as B}from"./loader-circle-u1M5w34w.js";import{E as Oe}from"./eye-BS6eP5P1.js";import"./Combination-B3qkWEI7.js";import"./index-lGeLsNXG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=ie("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),Ie={Scheduled:"bg-info/10 text-info border-info/20","In Progress":"bg-warning/10 text-warning border-warning/20",Completed:"bg-success/10 text-success border-success/20",Cancelled:"bg-muted text-muted-foreground border-border",Postponed:"bg-destructive/10 text-destructive border-destructive/20"},Le=["Scheduled","In Progress","Completed","Cancelled","Postponed"],ke=["General","Orthopedic","Cardiac","Neurological","Gynecological","Urological","Ophthalmic","ENT","Plastic","Emergency"],es=()=>{const[V,$]=i.useState([]),[F,q]=i.useState([]),[H,z]=i.useState([]),[G,J]=i.useState([]),[C,M]=i.useState(!0),[D,K]=i.useState(""),[Q,h]=i.useState(!1),[W,b]=i.useState(!1),[o,x]=i.useState(null),[p,A]=i.useState(!1),[T,j]=i.useState(!1),{toast:u}=le(),[t,l]=i.useState({patient_id:"",surgeon_id:"",surgery_type:"",scheduled_date:new Date().toISOString().split("T")[0],scheduled_time:"09:00",estimated_duration:"60",pre_op_diagnosis:"",status:"Scheduled",notes:""});i.useEffect(()=>{E(),X()},[]);const E=async()=>{var s,a;try{M(!0);const[r,m]=await Promise.all([g.getAll({limit:100}),g.getOperatingRooms().catch(()=>[])]);$(r.data||[]),q(m||[])}catch(r){u({title:"Error",description:((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to load surgery data",variant:"destructive"})}finally{M(!1)}},X=async()=>{try{const[s,a]=await Promise.all([we.getAll({limit:200}),Ce.getAll({limit:100})]);z(s.data||[]),J(a.data||[])}catch(s){console.error("Failed to load lookups:",s)}},R=()=>{l({patient_id:"",surgeon_id:"",surgery_type:"",scheduled_date:new Date().toISOString().split("T")[0],scheduled_time:"09:00",estimated_duration:"60",pre_op_diagnosis:"",status:"Scheduled",notes:""}),x(null),A(!1)},Y=()=>{R(),h(!0)},Z=s=>{var a,r;x(s),A(!0),l({patient_id:s.patient_id||"",surgeon_id:s.surgeon_id||"",surgery_type:s.surgery_type||"",scheduled_date:((a=s.scheduled_date)==null?void 0:a.split("T")[0])||new Date().toISOString().split("T")[0],scheduled_time:s.scheduled_time||"09:00",estimated_duration:((r=s.estimated_duration)==null?void 0:r.toString())||"60",pre_op_diagnosis:s.pre_op_diagnosis||"",status:s.status||"Scheduled",notes:s.notes||""}),h(!0)},ee=s=>{x(s),b(!0)},se=async()=>{var s,a;if(!t.patient_id||!t.surgeon_id||!t.surgery_type){u({title:"Error",description:"Please fill all required fields",variant:"destructive"});return}try{j(!0);const r={...t,estimated_duration:parseInt(t.estimated_duration)};p&&o?(await g.update(o.id,r),u({title:"Success",description:"Surgery updated successfully"})):(await g.create(r),u({title:"Success",description:"Surgery scheduled successfully"})),h(!1),R(),E()}catch(r){u({title:"Error",description:((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{j(!1)}},te=async()=>{var s,a;if(o)try{j(!0),await g.delete(o.id),u({title:"Success",description:"Surgery cancelled successfully"}),b(!1),x(null),E()}catch(r){u({title:"Error",description:((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete surgery",variant:"destructive"})}finally{j(!1)}},U=V.filter(s=>{var a,r;return((a=s.patient_name)==null?void 0:a.toLowerCase().includes(D.toLowerCase()))||((r=s.surgery_type)==null?void 0:r.toLowerCase().includes(D.toLowerCase()))}),ae=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A",re=s=>{if(!s)return"";const[a,r]=s.split(":"),m=parseInt(a);return`${m>12?m-12:m}:${r} ${m>=12?"PM":"AM"}`};return e.jsxs(ne,{title:"Surgery",subtitle:"Manage surgery schedules and operating rooms",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[F.map(s=>e.jsx(P,{className:s.status==="In Use"?"border-warning":"border-success",children:e.jsxs(I,{className:"pt-4 text-center",children:[e.jsx(Pe,{className:`w-8 h-8 mx-auto mb-2 ${s.status==="In Use"?"text-warning":"text-success"}`}),e.jsx("p",{className:"font-medium",children:s.room_number}),e.jsx(L,{variant:s.status==="Available"?"default":"secondary",children:s.status})]})},s.id)),F.length===0&&!C&&e.jsx(P,{className:"col-span-5",children:e.jsx(I,{className:"pt-4 text-center text-muted-foreground",children:"No operating rooms data available"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(f,{placeholder:"Search surgeries...",className:"pl-10",value:D,onChange:s=>K(s.target.value)})]}),e.jsxs(y,{className:"gap-2",onClick:Y,children:[e.jsx(Ee,{className:"w-4 h-4"}),"Schedule Surgery"]})]}),e.jsx(P,{children:e.jsx(I,{className:"p-0",children:C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsxs(k,{children:[e.jsx(c,{children:"ID"}),e.jsx(c,{children:"Patient"}),e.jsx(c,{children:"Surgery Type"}),e.jsx(c,{children:"Surgeon"}),e.jsx(c,{children:"Date/Time"}),e.jsx(c,{children:"Room"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsxs(xe,{children:[U.map(s=>e.jsxs(k,{className:"group",children:[e.jsx(n,{className:"font-mono text-sm",children:s.surgery_id}),e.jsx(n,{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsx(n,{children:s.surgery_type}),e.jsx(n,{children:s.surgeon_name||"TBD"}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),ae(s.scheduled_date)," ",re(s.scheduled_time)]})}),e.jsx(n,{children:e.jsx(L,{variant:"secondary",children:s.operating_room||"TBD"})}),e.jsx(n,{children:e.jsx(L,{variant:"outline",className:Ie[s.status]||"",children:s.status})}),e.jsx(n,{className:"text-right",children:e.jsxs(oe,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(De,{className:"w-4 h-4"})})}),e.jsxs(me,{align:"end",children:[e.jsxs(O,{className:"gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"})," View Details"]}),e.jsxs(O,{className:"gap-2",onClick:()=>Z(s),children:[e.jsx(be,{className:"w-4 h-4"})," Edit"]}),e.jsxs(O,{className:"gap-2 text-destructive",onClick:()=>ee(s),children:[e.jsx(je,{className:"w-4 h-4"})," Cancel"]})]})]})})]},s.id)),U.length===0&&!C&&e.jsx(k,{children:e.jsx(n,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No surgeries found"})})]})]})})}),e.jsx(ye,{open:Q,onOpenChange:h,children:e.jsxs(fe,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(_e,{children:[e.jsx(Se,{children:p?"Update Surgery":"Schedule New Surgery"}),e.jsx(ve,{children:p?"Update surgery details":"Schedule a new surgical procedure"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(_,{value:t.patient_id,onValueChange:s=>l({...t,patient_id:s}),children:[e.jsx(S,{children:e.jsx(v,{placeholder:"Select patient"})}),e.jsx(N,{className:"max-h-60",children:H.map(s=>e.jsxs(w,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"surgeon_id",children:"Surgeon *"}),e.jsxs(_,{value:t.surgeon_id,onValueChange:s=>l({...t,surgeon_id:s}),children:[e.jsx(S,{children:e.jsx(v,{placeholder:"Select surgeon"})}),e.jsx(N,{className:"max-h-60",children:G.map(s=>e.jsxs(w,{value:s.id,children:["Dr. ",s.name," (",s.specialization,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"surgery_type",children:"Surgery Type *"}),e.jsxs(_,{value:t.surgery_type,onValueChange:s=>l({...t,surgery_type:s}),children:[e.jsx(S,{children:e.jsx(v,{placeholder:"Select type"})}),e.jsx(N,{children:ke.map(s=>e.jsx(w,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"scheduled_date",children:"Date"}),e.jsx(f,{id:"scheduled_date",type:"date",value:t.scheduled_date,onChange:s=>l({...t,scheduled_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"scheduled_time",children:"Time"}),e.jsx(f,{id:"scheduled_time",type:"time",value:t.scheduled_time,onChange:s=>l({...t,scheduled_time:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"estimated_duration",children:"Estimated Duration (minutes)"}),e.jsx(f,{id:"estimated_duration",type:"number",value:t.estimated_duration,onChange:s=>l({...t,estimated_duration:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"pre_op_diagnosis",children:"Pre-Op Diagnosis"}),e.jsx(he,{id:"pre_op_diagnosis",value:t.pre_op_diagnosis,onChange:s=>l({...t,pre_op_diagnosis:s.target.value}),placeholder:"Pre-operative diagnosis",rows:2})]}),p&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"status",children:"Status"}),e.jsxs(_,{value:t.status,onValueChange:s=>l({...t,status:s}),children:[e.jsx(S,{children:e.jsx(v,{placeholder:"Select status"})}),e.jsx(N,{children:Le.map(s=>e.jsx(w,{value:s,children:s},s))})]})]})]}),e.jsxs(Ne,{children:[e.jsx(y,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(y,{onClick:se,disabled:T,children:[T&&e.jsx(B,{className:"w-4 h-4 mr-2 animate-spin"}),p?"Update":"Schedule"," Surgery"]})]})]})}),e.jsx(Te,{open:W,onOpenChange:b,onConfirm:te,title:"Cancel Surgery",description:`Are you sure you want to cancel the surgery for ${o==null?void 0:o.patient_name}?`,loading:T})]})};export{es as default};
