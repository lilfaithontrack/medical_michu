import{c as Ee,r,d as ke,j as e}from"./index-MFUeX4KC.js";import{c as Ue,S as Ie,B as P,D as K,e as Q,f as Y,g as A,T as Z}from"./AdminLayout-CEyGcOXW.js";import{C,d as S,B as j,a as ee,b as se}from"./card--ujVzSXa.js";import{I as D}from"./Combination-CVDpaV-S.js";import{L as o}from"./label-Cw8AwbsX.js";import{T as V}from"./textarea-BWkPO5tB.js";import{T as te,a as ae,b as F,c,d as le,e as i}from"./table-tgADzikB.js";import{D as ne,a as oe,b as re,c as ie,e as de,d as ce}from"./dialog-C_l7gpm1.js";import{S as g,a as v,b as _,c as b,d}from"./select-CM0PFwtY.js";import{a as f}from"./billingService-DOsngS27.js";import{p as Le}from"./patientService-CtAKoHA_.js";import{E as he,D as Ve}from"./DeleteConfirmDialog-Tv4EgB03.js";import{H as G}from"./heart-CDyTCbUc.js";import{P as Ge}from"./plus-DrrZjkgX.js";import{L as M}from"./loader-circle-DYBsGSuP.js";import{S as ue}from"./square-pen-QpnerZQe.js";import"./index-lz0iHb9C.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=Ee("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]),E={"A+":"bg-red-500/10 text-red-500 border-red-500/20","A-":"bg-red-600/10 text-red-600 border-red-600/20","B+":"bg-blue-500/10 text-blue-500 border-blue-500/20","B-":"bg-blue-600/10 text-blue-600 border-blue-600/20","AB+":"bg-purple-500/10 text-purple-500 border-purple-500/20","AB-":"bg-purple-600/10 text-purple-600 border-purple-600/20","O+":"bg-green-500/10 text-green-500 border-green-500/20","O-":"bg-green-600/10 text-green-600 border-green-600/20"},X=["A+","A-","B+","B-","AB+","AB-","O+","O-"],Me=["Collected","Processing","Available","Expired","Used"],Xe=["Male","Female"],He=["Whole Blood","Red Blood Cells","Plasma","Platelets","Cryoprecipitate"],ds=()=>{const[k,me]=r.useState([]),[U,pe]=r.useState([]),[H,je]=r.useState([]),[ge,ve]=r.useState([]),[_e,W]=r.useState(!0),[be,fe]=r.useState(""),[Ne,B]=r.useState(!1),[ye,R]=r.useState(!1),[Ce,I]=r.useState(!1),[p,N]=r.useState(null),[h,q]=r.useState(!1),[O,w]=r.useState(!1),{toast:u}=ke(),[a,x]=r.useState({donor_name:"",donor_phone:"",donor_age:"",gender:"",blood_group:"",units_donated:"1",hemoglobin_level:"",notes:"",status:"Collected"}),[l,m]=r.useState({patient_id:"",blood_group:"",component_type:"Whole Blood",units_requested:"1",priority:"Normal",reason:"",status:"Pending",cross_match_details:""});r.useEffect(()=>{T(),Se()},[]);const T=async()=>{var s,t;try{W(!0);const[n,y,L]=await Promise.all([f.getInventory(),f.getDonations({limit:20}).catch(()=>({data:[]})),f.getRequests({limit:20}).catch(()=>({data:[]}))]);me(n||[]),pe(y.data||[]),je(L.data||[])}catch(n){u({title:"Error",description:((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load blood bank data",variant:"destructive"})}finally{W(!1)}},Se=async()=>{try{const s=await Le.getAll({limit:200});ve(s.data||[])}catch(s){console.error("Failed to load patients:",s)}},z=()=>{x({donor_name:"",donor_phone:"",donor_age:"",gender:"",blood_group:"",units_donated:"1",hemoglobin_level:"",notes:"",status:"Collected"}),N(null),q(!1)},De=()=>{z(),B(!0)},we=s=>{var t,n,y;N(s),q(!0),x({donor_name:s.donor_name||"",donor_phone:s.donor_phone||"",donor_age:((t=s.donor_age)==null?void 0:t.toString())||"",gender:s.gender||"",blood_group:s.blood_group||"",units_donated:((n=s.units_donated)==null?void 0:n.toString())||"1",hemoglobin_level:((y=s.hemoglobin_level)==null?void 0:y.toString())||"",notes:s.notes||"",status:s.status||"Collected"}),B(!0)},Fe=()=>{m({patient_id:"",blood_group:"",component_type:"Whole Blood",units_requested:"1",priority:"Normal",reason:"",status:"Pending",cross_match_details:""}),N(null),q(!1),R(!0)},Be=s=>{var t;N(s),q(!0),m({patient_id:s.patient_id||"",blood_group:s.blood_group||"",component_type:s.component_type||"Whole Blood",units_requested:((t=s.units_requested)==null?void 0:t.toString())||"1",priority:s.priority||"Normal",reason:s.reason||"",status:s.status||"Pending",cross_match_details:s.cross_match_details||""}),R(!0)},$=(s,t="donation")=>{N({...s,type:t}),I(!0)},Re=()=>{m({patient_id:"",blood_group:"",component_type:"Whole Blood",units_requested:"1",priority:"Normal",reason:"",status:"Pending",cross_match_details:""}),N(null),q(!1)},qe=async()=>{var s,t;if(!a.donor_name||!a.blood_group){u({title:"Error",description:"Please fill donor name and blood group",variant:"destructive"});return}try{w(!0);const n={...a,donor_age:a.donor_age?parseInt(a.donor_age):null,units_donated:parseInt(a.units_donated),hemoglobin_level:a.hemoglobin_level?parseFloat(a.hemoglobin_level):null};h&&p?(await f.updateDonation(p.id,n),u({title:"Success",description:"Donation updated successfully"})):(await f.addDonation(n),u({title:"Success",description:"Donation recorded successfully"})),B(!1),z(),T()}catch(n){u({title:"Error",description:((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||"Operation failed",variant:"destructive"})}finally{w(!1)}},Oe=async()=>{var s,t;if(!l.patient_id||!l.blood_group){u({title:"Error",description:"Please select patient and blood group",variant:"destructive"});return}try{w(!0);const n={...l,units_requested:parseInt(l.units_requested)};h&&p?(await f.updateRequest(p.id,n),u({title:"Success",description:"Blood request updated successfully"})):(await f.createRequest(n),u({title:"Success",description:"Blood request submitted successfully"})),R(!1),Re(),T()}catch(n){u({title:"Error",description:((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||"Operation failed",variant:"destructive"})}finally{w(!1)}},Pe=async()=>{var s,t;if(p)try{w(!0),p.type==="request"||(await f.deleteDonation(p.id),u({title:"Success",description:"Donation record deleted successfully"})),I(!1),N(null),T()}catch(n){u({title:"Error",description:((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete item",variant:"destructive"})}finally{w(!1)}},J=k.reduce((s,t)=>(s[t.blood_group]||(s[t.blood_group]=[]),s[t.blood_group].push(t),s),{}),Te=k.reduce((s,t)=>s+(t.units_available||0),0);return e.jsxs(Ue,{title:"Blood Bank",subtitle:"Manage blood inventory and donations",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(C,{children:e.jsx(S,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Units"}),e.jsx("p",{className:"text-3xl font-bold",children:Te})]}),e.jsx(xe,{className:"w-8 h-8 text-destructive"})]})})}),e.jsx(C,{children:e.jsx(S,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Blood Groups"}),e.jsx("p",{className:"text-3xl font-bold",children:Object.keys(J).length})]}),e.jsx(G,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(C,{children:e.jsx(S,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Donations"}),e.jsx("p",{className:"text-3xl font-bold text-success",children:U.length})]}),e.jsx(G,{className:"w-8 h-8 text-success"})]})})}),e.jsx(C,{children:e.jsx(S,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Low Stock"}),e.jsx("p",{className:"text-3xl font-bold text-warning",children:k.filter(s=>s.units_available<10).length})]}),e.jsx(xe,{className:"w-8 h-8 text-warning"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search blood type...",className:"pl-10",value:be,onChange:s=>fe(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",className:"gap-2",onClick:De,children:[e.jsx(G,{className:"w-4 h-4"}),"New Donation"]}),e.jsxs(j,{className:"gap-2",onClick:Fe,children:[e.jsx(Ge,{className:"w-4 h-4"}),"Blood Request"]})]})]}),_e?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 mb-6",children:X.map(s=>{var y;const n=(J[s]||[]).reduce((L,Ae)=>L+(Ae.units_available||0),0);return e.jsx(C,{className:`border-2 ${(y=E[s])==null?void 0:y.replace("/10","/20")}`,children:e.jsxs(S,{className:"pt-4 text-center",children:[e.jsx(P,{className:`text-lg px-3 py-1 ${E[s]}`,children:s}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:n}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"units"})]})},s)})}),e.jsxs(C,{className:"mb-6",children:[e.jsx(ee,{children:e.jsx(se,{className:"text-lg",children:"Blood Requests"})}),e.jsx(S,{className:"p-0",children:e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(F,{children:[e.jsx(c,{children:"Patient"}),e.jsx(c,{children:"Blood Group"}),e.jsx(c,{children:"Component"}),e.jsx(c,{children:"Units"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsxs(le,{children:[H.map(s=>e.jsxs(F,{children:[e.jsx(i,{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsx(i,{children:e.jsx(P,{variant:"outline",className:E[s.blood_group]||"",children:s.blood_group})}),e.jsx(i,{children:s.component_type}),e.jsx(i,{children:s.units_requested}),e.jsx(i,{children:e.jsx(P,{variant:s.status==="Fulfilled"?"default":s.status==="Pending"?"secondary":"outline",children:s.status})}),e.jsx(i,{className:"text-right",children:e.jsxs(K,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",children:e.jsx(he,{className:"w-4 h-4"})})}),e.jsxs(Y,{align:"end",children:[e.jsxs(A,{onClick:()=>Be(s),children:[e.jsx(ue,{className:"w-4 h-4 mr-2"})," Update Status/Details"]}),e.jsxs(A,{className:"text-destructive",onClick:()=>$(s,"request"),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"})," Delete"]})]})]})})]},s.id)),H.length===0&&e.jsx(F,{children:e.jsx(i,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No active requests"})})]})]})})]}),e.jsxs(C,{children:[e.jsx(ee,{children:e.jsx(se,{className:"text-lg",children:"Recent Donations"})}),e.jsx(S,{className:"p-0",children:e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(F,{children:[e.jsx(c,{children:"ID"}),e.jsx(c,{children:"Donor"}),e.jsx(c,{children:"Blood Group"}),e.jsx(c,{children:"Units"}),e.jsx(c,{children:"Status"}),e.jsx(c,{className:"text-right",children:"Actions"})]})}),e.jsxs(le,{children:[U.slice(0,10).map(s=>e.jsxs(F,{className:"group",children:[e.jsx(i,{className:"font-mono text-sm",children:s.donation_id}),e.jsx(i,{className:"font-medium",children:s.donor_name}),e.jsx(i,{children:e.jsx(P,{variant:"outline",className:E[s.blood_group]||"",children:s.blood_group})}),e.jsx(i,{children:s.units_donated}),e.jsx(i,{children:e.jsx(P,{variant:s.status==="Available"?"default":"secondary",children:s.status})}),e.jsx(i,{className:"text-right",children:e.jsxs(K,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(he,{className:"w-4 h-4"})})}),e.jsxs(Y,{align:"end",children:[e.jsxs(A,{className:"gap-2",onClick:()=>we(s),children:[e.jsx(ue,{className:"w-4 h-4"})," Edit"]}),e.jsxs(A,{className:"gap-2 text-destructive",onClick:()=>$(s),children:[e.jsx(Z,{className:"w-4 h-4"})," Delete"]})]})]})})]},s.id)),U.length===0&&e.jsx(F,{children:e.jsx(i,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No recent donations"})})]})]})})]})]}),e.jsx(ne,{open:Ne,onOpenChange:B,children:e.jsxs(oe,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(ie,{children:h?"Update Donation":"Record New Donation"}),e.jsx(de,{children:h?"Update donation record":"Record a new blood donation"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(o,{htmlFor:"donor_name",children:"Donor Name *"}),e.jsx(D,{id:"donor_name",value:a.donor_name,onChange:s=>x({...a,donor_name:s.target.value}),placeholder:"Full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"donor_phone",children:"Phone"}),e.jsx(D,{id:"donor_phone",value:a.donor_phone,onChange:s=>x({...a,donor_phone:s.target.value}),placeholder:"+251 9XX XXX XXX"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"donor_age",children:"Age"}),e.jsx(D,{id:"donor_age",type:"number",value:a.donor_age,onChange:s=>x({...a,donor_age:s.target.value}),placeholder:"Age"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"gender",children:"Gender"}),e.jsxs(g,{value:a.gender,onValueChange:s=>x({...a,gender:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select"})}),e.jsx(b,{children:Xe.map(s=>e.jsx(d,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"blood_group",children:"Blood Group *"}),e.jsxs(g,{value:a.blood_group,onValueChange:s=>x({...a,blood_group:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select"})}),e.jsx(b,{children:X.map(s=>e.jsx(d,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"units_donated",children:"Units"}),e.jsx(D,{id:"units_donated",type:"number",value:a.units_donated,onChange:s=>x({...a,units_donated:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"hemoglobin_level",children:"Hemoglobin (g/dL)"}),e.jsx(D,{id:"hemoglobin_level",type:"number",step:"0.1",value:a.hemoglobin_level,onChange:s=>x({...a,hemoglobin_level:s.target.value})})]}),h&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"status",children:"Status"}),e.jsxs(g,{value:a.status,onValueChange:s=>x({...a,status:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select"})}),e.jsx(b,{children:Me.map(s=>e.jsx(d,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(o,{htmlFor:"notes",children:"Notes"}),e.jsx(V,{id:"notes",value:a.notes,onChange:s=>x({...a,notes:s.target.value}),placeholder:"Additional notes",rows:2})]})]})}),e.jsxs(ce,{children:[e.jsx(j,{variant:"outline",onClick:()=>B(!1),children:"Cancel"}),e.jsxs(j,{onClick:qe,disabled:O,children:[O&&e.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}),h?"Update":"Record"," Donation"]})]})]})}),e.jsx(ne,{open:ye,onOpenChange:R,children:e.jsxs(oe,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(ie,{children:h?"Update Request":"Blood Request"}),e.jsx(de,{children:h?"Update details and status":"Request blood component for a patient"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(g,{value:l.patient_id,onValueChange:s=>m({...l,patient_id:s}),disabled:h,children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select patient"})}),e.jsx(b,{className:"max-h-60",children:ge.map(s=>e.jsxs(d,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"component_type",children:"Component Type"}),e.jsxs(g,{value:l.component_type,onValueChange:s=>m({...l,component_type:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select component"})}),e.jsx(b,{children:He.map(s=>e.jsx(d,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"blood_group",children:"Blood Group *"}),e.jsxs(g,{value:l.blood_group,onValueChange:s=>m({...l,blood_group:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select"})}),e.jsx(b,{children:X.map(s=>e.jsx(d,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"units_requested",children:"Units"}),e.jsx(D,{id:"units_requested",type:"number",value:l.units_requested,onChange:s=>m({...l,units_requested:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"priority",children:"Priority"}),e.jsxs(g,{value:l.priority,onValueChange:s=>m({...l,priority:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select"})}),e.jsxs(b,{children:[e.jsx(d,{value:"Normal",children:"Normal"}),e.jsx(d,{value:"Urgent",children:"Urgent"}),e.jsx(d,{value:"Emergency",children:"Emergency"})]})]})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"status",children:"Status"}),e.jsxs(g,{value:l.status,onValueChange:s=>m({...l,status:s}),children:[e.jsx(v,{children:e.jsx(_,{placeholder:"Select status"})}),e.jsxs(b,{children:[e.jsx(d,{value:"Pending",children:"Pending"}),e.jsx(d,{value:"Approved",children:"Approved"}),e.jsx(d,{value:"Fulfilled",children:"Fulfilled"}),e.jsx(d,{value:"Rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"cross_match_details",children:"Cross Match Details"}),e.jsx(V,{id:"cross_match_details",value:l.cross_match_details,onChange:s=>m({...l,cross_match_details:s.target.value}),placeholder:"Enter cross matching results/notes",rows:3})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"reason",children:"Reason"}),e.jsx(V,{id:"reason",value:l.reason,onChange:s=>m({...l,reason:s.target.value}),placeholder:"Reason for blood request",rows:2})]})]}),e.jsxs(ce,{children:[e.jsx(j,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),e.jsxs(j,{onClick:Oe,disabled:O,children:[O&&e.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}),h?"Update Request":"Submit Request"]})]})]})}),e.jsx(Ve,{open:Ce,onOpenChange:I,onConfirm:Pe,title:"Delete Donation Record",description:`Are you sure you want to delete the donation record for ${p==null?void 0:p.donor_name}?`,loading:O})]})};export{ds as default};
