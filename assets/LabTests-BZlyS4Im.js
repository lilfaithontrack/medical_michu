import{r as i,d as le,j as e}from"./index-BM0IHp2M.js";import{c as ie,S as ne,B as O,j as ce,D as oe,e as de,f as me,g as T,h as he,T as ue}from"./AdminLayout-CWUWmsnS.js";import{B as g,C as A,d as I}from"./card-DeprxXCB.js";import{I as p}from"./Combination-DWTH6IhY.js";import{L as n}from"./label-PzrI3jAD.js";import{T as U}from"./textarea-DWoGW9ma.js";import{T as pe,a as xe,b as E,c as x,d as je,e as h}from"./table-BzDp6Nnk.js";import{D as ge,a as fe,b as _e,c as ve,e as ye,d as Ne}from"./dialog-DCRhT7_F.js";import{S as f,a as _,b as v,c as y,d as o}from"./select-OA5PXWO7.js";import{l as N}from"./diagnosticService-BPEkfwoq.js";import{p as Ce}from"./patientService-DFGR6BTX.js";import{d as be}from"./doctorService-jnKXpXU3.js";import{E as Se,D as we}from"./DeleteConfirmDialog-Dqug50Ir.js";import{F as Te}from"./filter-MpqZckG0.js";import{P as De}from"./plus-BoDGEuOf.js";import{L as M}from"./loader-circle-aBlEtCJL.js";import{E as Fe}from"./eye-Dp2HsTK1.js";import{S as Le}from"./square-pen-D0IrTuyB.js";import"./index-yV4U6faZ.js";const Oe={Ordered:"bg-info/10 text-info border-info/20","Sample Collected":"bg-warning/10 text-warning border-warning/20","In Progress":"bg-warning/10 text-warning border-warning/20",Completed:"bg-success/10 text-success border-success/20",Verified:"bg-success/10 text-success border-success/20",Cancelled:"bg-muted text-muted-foreground border-border"},Ee=["Ordered","Sample Collected","In Progress","Completed","Verified","Cancelled"],Pe=["Normal","Urgent","STAT"],Ze=()=>{const[H,q]=i.useState([]),[d,z]=i.useState([]),[$,G]=i.useState([]),[J,K]=i.useState([]),[P,R]=i.useState(!0),[C,Q]=i.useState(""),[W,j]=i.useState(!1),[X,D]=i.useState(!1),[l,b]=i.useState(null),[u,B]=i.useState(!1),[F,S]=i.useState(!1),{toast:m}=le(),[t,r]=i.useState({patient_id:"",doctor_id:"",test_type:"",priority:"Normal",clinical_notes:"",status:"Ordered",result:"",result_notes:"",specimen_info:"",reference_ranges:"",units:"",critical_flag:!1});i.useEffect(()=>{L(),Y()},[]);const L=async()=>{var s,a;try{R(!0);const[c,w]=await Promise.all([N.getAll({limit:100}),N.getCatalog().catch(()=>[])]);q(c.data||[]),z(w||[])}catch(c){m({title:"Error",description:((a=(s=c.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to load lab tests",variant:"destructive"})}finally{R(!1)}},Y=async()=>{try{const[s,a]=await Promise.all([Ce.getAll({limit:200}),be.getAll({limit:100})]);G(s.data||[]),K(a.data||[])}catch(s){console.error("Failed to load lookups:",s)}},k=()=>{r({patient_id:"",doctor_id:"",test_type:"",priority:"Normal",clinical_notes:"",status:"Ordered",result:"",result_notes:"",specimen_info:"",reference_ranges:"",units:"",critical_flag:!1}),b(null),B(!1)},Z=()=>{k(),j(!0)},ee=s=>{b(s),B(!0),r({patient_id:s.patient_id||"",doctor_id:s.doctor_id||"",test_type:s.test_type||"",priority:s.priority||"Normal",clinical_notes:s.clinical_notes||"",status:s.status||"Ordered",result:s.result||"",result_notes:s.result_notes||"",specimen_info:s.specimen_info||"",reference_ranges:s.reference_ranges||"",units:s.units||"",critical_flag:s.critical_flag||!1}),j(!0)},se=s=>{b(s),D(!0)},te=async()=>{var s,a;if(!t.patient_id||!t.doctor_id||!t.test_type){m({title:"Error",description:"Please fill all required fields",variant:"destructive"});return}try{S(!0),u&&l?(await N.update(l.id,t),m({title:"Success",description:"Lab test updated successfully"})):(await N.create(t),m({title:"Success",description:"Lab test ordered successfully"})),j(!1),k(),L()}catch(c){m({title:"Error",description:((a=(s=c.response)==null?void 0:s.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{S(!1)}},ae=async()=>{var s,a;if(l)try{S(!0),await N.delete(l.id),m({title:"Success",description:"Lab test cancelled successfully"}),D(!1),b(null),L()}catch(c){m({title:"Error",description:((a=(s=c.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete test",variant:"destructive"})}finally{S(!1)}},V=H.filter(s=>{var a,c,w;return((a=s.test_name)==null?void 0:a.toLowerCase().includes(C.toLowerCase()))||((c=s.patient_name)==null?void 0:c.toLowerCase().includes(C.toLowerCase()))||((w=s.test_code)==null?void 0:w.toLowerCase().includes(C.toLowerCase()))}),re=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A";return e.jsxs(ie,{title:"Lab Tests",subtitle:"Manage laboratory test orders and results",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Search lab tests...",className:"pl-10",value:C,onChange:s=>Q(s.target.value)})]}),e.jsx(g,{variant:"outline",size:"icon",children:e.jsx(Te,{className:"w-4 h-4"})})]}),e.jsxs(g,{className:"gap-2",onClick:Z,children:[e.jsx(De,{className:"w-4 h-4"}),"Order Test"]})]}),d.length>0&&e.jsx(A,{className:"mb-6",children:e.jsxs(I,{className:"pt-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Available Tests (",d.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.slice(0,8).map(s=>{var a;return e.jsxs(O,{variant:"secondary",children:[s.test_code,": ",(a=s.test_name)==null?void 0:a.split("(")[0]," - ETB ",s.price]},s.id)}),d.length>8&&e.jsxs(O,{variant:"outline",children:["+",d.length-8," more"]})]})]})}),e.jsx(A,{children:e.jsx(I,{className:"p-0",children:P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(pe,{children:[e.jsx(xe,{children:e.jsxs(E,{children:[e.jsx(x,{children:"Test Code"}),e.jsx(x,{children:"Test Name"}),e.jsx(x,{children:"Patient"}),e.jsx(x,{children:"Ordered Date"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsxs(je,{children:[V.map(s=>{var a;return e.jsxs(E,{className:"group",children:[e.jsx(h,{className:"font-mono text-sm",children:s.test_code}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:((a=s.test_name)==null?void 0:a.split("(")[0])||s.test_type})]})}),e.jsx(h,{className:"text-muted-foreground",children:s.patient_name||"Unknown"}),e.jsx(h,{children:re(s.ordered_date||s.created_at)}),e.jsx(h,{children:e.jsx(O,{variant:"outline",className:Oe[s.status]||"",children:s.status})}),e.jsx(h,{className:"text-right",children:e.jsxs(oe,{children:[e.jsx(de,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(Se,{className:"w-4 h-4"})})}),e.jsxs(me,{align:"end",children:[e.jsxs(T,{className:"gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"})," View Results"]}),e.jsxs(T,{className:"gap-2",onClick:()=>ee(s),children:[e.jsx(Le,{className:"w-4 h-4"})," Enter Results"]}),e.jsxs(T,{className:"gap-2",children:[e.jsx(he,{className:"w-4 h-4"})," Verify"]}),e.jsxs(T,{className:"gap-2 text-destructive",onClick:()=>se(s),children:[e.jsx(ue,{className:"w-4 h-4"})," Cancel"]})]})]})})]},s.id)}),V.length===0&&!P&&e.jsx(E,{children:e.jsx(h,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No lab tests found"})})]})]})})}),e.jsx(ge,{open:W,onOpenChange:j,children:e.jsxs(fe,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(_e,{children:[e.jsx(ve,{children:u?"Update Lab Test":"Order New Lab Test"}),e.jsx(ye,{children:u?"Update test status and enter results":"Order a new laboratory test"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[!u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(f,{value:t.patient_id,onValueChange:s=>r({...t,patient_id:s}),children:[e.jsx(_,{children:e.jsx(v,{placeholder:"Select patient"})}),e.jsx(y,{className:"max-h-60",children:$.map(s=>e.jsxs(o,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"doctor_id",children:"Ordering Doctor *"}),e.jsxs(f,{value:t.doctor_id,onValueChange:s=>r({...t,doctor_id:s}),children:[e.jsx(_,{children:e.jsx(v,{placeholder:"Select doctor"})}),e.jsx(y,{className:"max-h-60",children:J.map(s=>e.jsxs(o,{value:s.id,children:["Dr. ",s.name]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"test_type",children:"Test Type *"}),e.jsxs(f,{value:t.test_type,onValueChange:s=>r({...t,test_type:s}),children:[e.jsx(_,{children:e.jsx(v,{placeholder:"Select test"})}),e.jsx(y,{className:"max-h-60",children:d.length>0?d.map(s=>e.jsxs(o,{value:s.test_code,children:[s.test_name," - ETB ",s.price]},s.id)):e.jsxs(e.Fragment,{children:[e.jsx(o,{value:"CBC",children:"Complete Blood Count (CBC)"}),e.jsx(o,{value:"BMP",children:"Basic Metabolic Panel"}),e.jsx(o,{value:"UA",children:"Urinalysis"}),e.jsx(o,{value:"LFT",children:"Liver Function Tests"}),e.jsx(o,{value:"TSH",children:"Thyroid Panel"})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"priority",children:"Priority"}),e.jsxs(f,{value:t.priority,onValueChange:s=>r({...t,priority:s}),children:[e.jsx(_,{children:e.jsx(v,{placeholder:"Select priority"})}),e.jsx(y,{children:Pe.map(s=>e.jsx(o,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"clinical_notes",children:"Clinical Notes"}),e.jsx(U,{id:"clinical_notes",value:t.clinical_notes,onChange:s=>r({...t,clinical_notes:s.target.value}),placeholder:"Relevant clinical information",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"specimen_info",children:"Specimen Info"}),e.jsx(p,{id:"specimen_info",value:t.specimen_info,onChange:s=>r({...t,specimen_info:s.target.value}),placeholder:"e.g., Sodium Citrate, 5ml"})]})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"status",children:"Status"}),e.jsxs(f,{value:t.status,onValueChange:s=>r({...t,status:s}),children:[e.jsx(_,{children:e.jsx(v,{placeholder:"Select status"})}),e.jsx(y,{children:Ee.map(s=>e.jsx(o,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"result",children:"Result Value"}),e.jsx(p,{id:"result",value:t.result,onChange:s=>r({...t,result:s.target.value}),placeholder:"Enter test result"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"result_notes",children:"Result Notes"}),e.jsx(U,{id:"result_notes",value:t.result_notes,onChange:s=>r({...t,result_notes:s.target.value}),placeholder:"Interpretation or comments",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"units",children:"Units"}),e.jsx(p,{id:"units",value:t.units,onChange:s=>r({...t,units:s.target.value}),placeholder:"e.g., mg/dL"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"reference_ranges",children:"Ref. Range"}),e.jsx(p,{id:"reference_ranges",value:t.reference_ranges,onChange:s=>r({...t,reference_ranges:s.target.value}),placeholder:"e.g., 70-110"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 border p-3 rounded-md",children:[e.jsx("input",{type:"checkbox",id:"critical_flag",checked:t.critical_flag,onChange:s=>r({...t,critical_flag:s.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),e.jsx(n,{htmlFor:"critical_flag",className:"font-medium text-destructive",children:"Critical Result Flag"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"specimen_info_edit",children:"Specimen Info"}),e.jsx(p,{id:"specimen_info_edit",value:t.specimen_info,onChange:s=>r({...t,specimen_info:s.target.value}),placeholder:"Specimen details"})]})]})]}),e.jsxs(Ne,{children:[e.jsx(g,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsxs(g,{onClick:te,disabled:F,children:[F&&e.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}),u?"Save Results":"Order Test"]})]})]})}),e.jsx(we,{open:X,onOpenChange:D,onConfirm:ae,title:"Cancel Lab Test",description:`Are you sure you want to cancel the ${(l==null?void 0:l.test_name)||(l==null?void 0:l.test_type)} test for ${l==null?void 0:l.patient_name}?`,loading:F})]})};export{Ze as default};
