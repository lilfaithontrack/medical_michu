import{r,d as xe,j as e}from"./index-MFUeX4KC.js";import{c as he,S as pe,B as je,D as fe,e as ge,f as ye,g as T,T as Ne}from"./AdminLayout-CEyGcOXW.js";import{C as v,d as b,B as u}from"./card--ujVzSXa.js";import{I as j}from"./Combination-CVDpaV-S.js";import{L as c}from"./label-Cw8AwbsX.js";import{T as ve}from"./textarea-BWkPO5tB.js";import{T as be,a as _e,b as F,c as x,d as we,e as d}from"./table-tgADzikB.js";import{D as V,a as U,b as H,c as z,e as $,d as q}from"./dialog-C_l7gpm1.js";import{S as G,a as J,b as K,c as Q,d as W}from"./select-CM0PFwtY.js";import{b as _}from"./billingService-DOsngS27.js";import{p as Ce}from"./patientService-CtAKoHA_.js";import{E as Se,D as De}from"./DeleteConfirmDialog-Tv4EgB03.js";import{C as Te}from"./credit-card-BwSBlcYN.js";import{D as P}from"./dollar-sign-CM5HpJ7h.js";import{F as Pe}from"./filter-MFaesxLD.js";import{P as Be}from"./plus-DrrZjkgX.js";import{L as O}from"./loader-circle-DYBsGSuP.js";import{E as Ee}from"./eye-CxZXf5Ga.js";import{S as Fe}from"./square-pen-QpnerZQe.js";import"./index-lz0iHb9C.js";const Oe={Pending:"bg-warning/10 text-warning border-warning/20",Paid:"bg-success/10 text-success border-success/20",Partial:"bg-info/10 text-info border-info/20",Overdue:"bg-destructive/10 text-destructive border-destructive/20",Cancelled:"bg-muted text-muted-foreground border-border"},Le=["Cash","Card","Bank Transfer","Insurance","Mobile Payment"],tt=()=>{const[f,X]=r.useState([]),[Y,Z]=r.useState([]),[L,k]=r.useState(!0),[B,ee]=r.useState(""),[te,g]=r.useState(!1),[se,w]=r.useState(!1),[ae,E]=r.useState(!1),[s,y]=r.useState(null),[C,A]=r.useState(!1),[N,h]=r.useState(!1),{toast:i}=xe(),[l,m]=r.useState({patient_id:"",bill_date:new Date().toISOString().split("T")[0],total_amount:"",discount:"0",notes:""}),[o,S]=r.useState({amount:"",payment_method:"Cash",reference_number:"",notes:""});r.useEffect(()=>{D(),ne()},[]);const D=async()=>{var t,a;try{k(!0);const n=await _.getAllBills({limit:100});X(n.data||[])}catch(n){i({title:"Error",description:((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to load bills",variant:"destructive"})}finally{k(!1)}},ne=async()=>{try{const t=await Ce.getAll({limit:200});Z(t.data||[])}catch(t){console.error("Failed to load patients:",t)}},R=()=>{m({patient_id:"",bill_date:new Date().toISOString().split("T")[0],total_amount:"",discount:"0",notes:""}),y(null),A(!1)},le=()=>{R(),g(!0)},re=t=>{var a,n,M;y(t),A(!0),m({patient_id:t.patient_id||"",bill_date:((a=t.bill_date)==null?void 0:a.split("T")[0])||new Date().toISOString().split("T")[0],total_amount:((n=t.total_amount)==null?void 0:n.toString())||"",discount:((M=t.discount)==null?void 0:M.toString())||"0",notes:t.notes||""}),g(!0)},ie=t=>{y(t),S({amount:((t.total_amount||0)-(t.paid_amount||0)).toString(),payment_method:"Cash",reference_number:"",notes:""}),w(!0)},oe=t=>{y(t),E(!0)},ce=async()=>{var t,a;if(!l.patient_id||!l.total_amount){i({title:"Error",description:"Please select patient and enter amount",variant:"destructive"});return}try{h(!0);const n={...l,total_amount:parseFloat(l.total_amount),discount:parseFloat(l.discount)};C&&s?(await _.updateBill(s.id,n),i({title:"Success",description:"Bill updated successfully"})):(await _.createBill(n),i({title:"Success",description:"Bill created successfully"})),g(!1),R(),D()}catch(n){i({title:"Error",description:((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{h(!1)}},de=async()=>{var t,a;if(!o.amount||!s){i({title:"Error",description:"Please enter payment amount",variant:"destructive"});return}try{h(!0),await _.recordPayment(s.id,{...o,amount:parseFloat(o.amount)}),i({title:"Success",description:"Payment recorded successfully"}),w(!1),D()}catch(n){i({title:"Error",description:((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Payment failed",variant:"destructive"})}finally{h(!1)}},me=async()=>{var t,a;if(s)try{h(!0),await _.deleteBill(s.id),i({title:"Success",description:"Bill deleted successfully"}),E(!1),y(null),D()}catch(n){i({title:"Error",description:((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to delete bill",variant:"destructive"})}finally{h(!1)}},I=f.filter(t=>{var a,n;return((a=t.bill_number)==null?void 0:a.toLowerCase().includes(B.toLowerCase()))||((n=t.patient_name)==null?void 0:n.toLowerCase().includes(B.toLowerCase()))}),ue=t=>t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A",p=t=>`ETB ${(t||0).toLocaleString()}`;return e.jsxs(he,{title:"Billing",subtitle:"Manage patient bills and payments",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(v,{children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Bills"}),e.jsx("p",{className:"text-2xl font-bold",children:f.length})]}),e.jsx(Te,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(v,{children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-warning",children:f.filter(t=>t.payment_status==="Pending").length})]}),e.jsx(P,{className:"w-8 h-8 text-warning"})]})})}),e.jsx(v,{children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paid"}),e.jsx("p",{className:"text-2xl font-bold text-success",children:f.filter(t=>t.payment_status==="Paid").length})]}),e.jsx(P,{className:"w-8 h-8 text-success"})]})})}),e.jsx(v,{children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold",children:p(f.reduce((t,a)=>t+(a.paid_amount||0),0))})]}),e.jsx(P,{className:"w-8 h-8 text-primary"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(j,{placeholder:"Search bills...",className:"pl-10",value:B,onChange:t=>ee(t.target.value)})]}),e.jsx(u,{variant:"outline",size:"icon",children:e.jsx(Pe,{className:"w-4 h-4"})})]}),e.jsxs(u,{className:"gap-2",onClick:le,children:[e.jsx(Be,{className:"w-4 h-4"}),"Create Bill"]})]}),e.jsx(v,{children:e.jsx(b,{className:"p-0",children:L?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(O,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(be,{children:[e.jsx(_e,{children:e.jsxs(F,{children:[e.jsx(x,{children:"Bill No."}),e.jsx(x,{children:"Patient"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Total Amount"}),e.jsx(x,{children:"Paid"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsxs(we,{children:[I.map(t=>e.jsxs(F,{className:"group",children:[e.jsx(d,{className:"font-mono text-sm",children:t.bill_number}),e.jsx(d,{className:"font-medium",children:t.patient_name||"Unknown"}),e.jsx(d,{className:"text-muted-foreground",children:ue(t.bill_date||t.created_at)}),e.jsx(d,{className:"font-medium",children:p(t.total_amount)}),e.jsx(d,{className:"text-success",children:p(t.paid_amount)}),e.jsx(d,{children:e.jsx(je,{variant:"outline",className:Oe[t.payment_status]||"",children:t.payment_status})}),e.jsx(d,{className:"text-right",children:e.jsxs(fe,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(Se,{className:"w-4 h-4"})})}),e.jsxs(ye,{align:"end",children:[e.jsxs(T,{className:"gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"})," View Details"]}),e.jsxs(T,{className:"gap-2",onClick:()=>ie(t),children:[e.jsx(P,{className:"w-4 h-4"})," Record Payment"]}),e.jsxs(T,{className:"gap-2",onClick:()=>re(t),children:[e.jsx(Fe,{className:"w-4 h-4"})," Edit"]}),e.jsxs(T,{className:"gap-2 text-destructive",onClick:()=>oe(t),children:[e.jsx(Ne,{className:"w-4 h-4"})," Delete"]})]})]})})]},t.id)),I.length===0&&!L&&e.jsx(F,{children:e.jsx(d,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No bills found"})})]})]})})}),e.jsx(V,{open:te,onOpenChange:g,children:e.jsxs(U,{className:"max-w-md",children:[e.jsxs(H,{children:[e.jsx(z,{children:C?"Edit Bill":"Create New Bill"}),e.jsx($,{children:C?"Update bill details":"Create a new patient bill"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(G,{value:l.patient_id,onValueChange:t=>m({...l,patient_id:t}),children:[e.jsx(J,{children:e.jsx(K,{placeholder:"Select patient"})}),e.jsx(Q,{className:"max-h-60",children:Y.map(t=>e.jsxs(W,{value:t.id,children:[t.name," (",t.patient_id,")"]},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"bill_date",children:"Bill Date"}),e.jsx(j,{id:"bill_date",type:"date",value:l.bill_date,onChange:t=>m({...l,bill_date:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"total_amount",children:"Total Amount (ETB) *"}),e.jsx(j,{id:"total_amount",type:"number",step:"0.01",value:l.total_amount,onChange:t=>m({...l,total_amount:t.target.value}),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"discount",children:"Discount (ETB)"}),e.jsx(j,{id:"discount",type:"number",step:"0.01",value:l.discount,onChange:t=>m({...l,discount:t.target.value}),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"notes",children:"Notes"}),e.jsx(ve,{id:"notes",value:l.notes,onChange:t=>m({...l,notes:t.target.value}),placeholder:"Bill description or notes",rows:2})]})]}),e.jsxs(q,{children:[e.jsx(u,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsxs(u,{onClick:ce,disabled:N,children:[N&&e.jsx(O,{className:"w-4 h-4 mr-2 animate-spin"}),C?"Update":"Create"," Bill"]})]})]})}),e.jsx(V,{open:se,onOpenChange:w,children:e.jsxs(U,{className:"max-w-md",children:[e.jsxs(H,{children:[e.jsx(z,{children:"Record Payment"}),e.jsxs($,{children:["Record payment for Bill #",s==null?void 0:s.bill_number]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Amount:"}),e.jsx("span",{className:"font-medium",children:p(s==null?void 0:s.total_amount)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Already Paid:"}),e.jsx("span",{className:"font-medium text-success",children:p(s==null?void 0:s.paid_amount)})]}),e.jsxs("div",{className:"flex justify-between text-sm font-medium border-t mt-2 pt-2",children:[e.jsx("span",{children:"Balance Due:"}),e.jsx("span",{className:"text-warning",children:p(((s==null?void 0:s.total_amount)||0)-((s==null?void 0:s.paid_amount)||0))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"amount",children:"Payment Amount (ETB) *"}),e.jsx(j,{id:"amount",type:"number",step:"0.01",value:o.amount,onChange:t=>S({...o,amount:t.target.value}),placeholder:"0.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"payment_method",children:"Payment Method"}),e.jsxs(G,{value:o.payment_method,onValueChange:t=>S({...o,payment_method:t}),children:[e.jsx(J,{children:e.jsx(K,{placeholder:"Select method"})}),e.jsx(Q,{children:Le.map(t=>e.jsx(W,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"reference_number",children:"Reference Number"}),e.jsx(j,{id:"reference_number",value:o.reference_number,onChange:t=>S({...o,reference_number:t.target.value}),placeholder:"Transaction/Receipt number"})]})]}),e.jsxs(q,{children:[e.jsx(u,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsxs(u,{onClick:de,disabled:N,children:[N&&e.jsx(O,{className:"w-4 h-4 mr-2 animate-spin"}),"Record Payment"]})]})]})}),e.jsx(De,{open:ae,onOpenChange:E,onConfirm:me,title:"Delete Bill",description:`Are you sure you want to delete bill #${s==null?void 0:s.bill_number}? This action cannot be undone.`,loading:N})]})};export{tt as default};
