import{c as L,f as l,R as F,j as e,r as x,d as O}from"./index-MFUeX4KC.js";import{c as A,n as E,T as D,B as H}from"./AdminLayout-CEyGcOXW.js";import{B as j,C as h,a as v,b as T,d as p}from"./card--ujVzSXa.js";import{T as U,a as q,b as P,c as _}from"./tabs-BKpu8yr4.js";import{u as M}from"./index.esm-BsxwV1DL.js";import{D as B,a as $,b as z,c as Z,d as G}from"./dialog-C_l7gpm1.js";import{I as o,U as J}from"./Combination-CVDpaV-S.js";import{L as d}from"./label-Cw8AwbsX.js";import{S as K,a as Q,b as W,c as X,d as y}from"./select-CM0PFwtY.js";import{P as Y}from"./plus-DrrZjkgX.js";import{S as I}from"./shield-alert--1XbH9cv.js";import"./index-lz0iHb9C.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=L("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),u={getCameras:async()=>(await l.get("/security/cameras")).data,createCamera:async a=>(await l.post("/security/cameras",a)).data,addCamera:a=>l.post("/security/cameras",a),updateCamera:async(a,r)=>(await l.put(`/security/cameras/${a}`,r)).data,deleteCamera:async a=>(await l.delete(`/security/cameras/${a}`)).data,getVisitors:async a=>(await l.get("/security/visitors",{params:a})).data,checkInVisitor:async a=>(await l.post("/security/visitors",a)).data,checkOutVisitor:async a=>(await l.put(`/security/visitors/${a}/checkout`)).data,getIncidents:async()=>(await l.get("/security/incidents")).data,createIncident:async a=>(await l.post("/security/incidents",a,{headers:{"Content-Type":"multipart/form-data"}})).data};function ee({open:a,onOpenChange:r,initialData:c,onSubmit:b}){const{register:t,handleSubmit:w,reset:N,setValue:i,watch:f,formState:{errors:g,isSubmitting:m}}=M({defaultValues:{status:"Online",protocol:"RTSP",port:554}});F.useEffect(()=>{a&&N(c||{status:"Online",protocol:"RTSP",port:554,maintenance_mode:!1})},[a,c,N]);const n=f("protocol");return F.useEffect(()=>{n==="HTTP"||n==="ONVIF"?i("port",80):n==="HTTPS"?i("port",443):n==="RTSP"&&i("port",554)},[n,i]),e.jsx(B,{open:a,onOpenChange:r,children:e.jsxs($,{className:"max-w-2xl",children:[e.jsx(z,{children:e.jsx(Z,{children:c?"Edit Camera Configuration":"Add New Camera"})}),e.jsxs("form",{onSubmit:w(b),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Camera Name"}),e.jsx(o,{id:"name",...t("name",{required:"Name is required"}),placeholder:"Main Entrance Cam"}),g.name&&e.jsx("p",{className:"text-sm text-destructive",children:g.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"location",children:"Location / Zone"}),e.jsx(o,{id:"location",...t("location",{required:"Location is required"}),placeholder:"Building A, Lobby"})]})]}),e.jsxs("div",{className:"border rounded-md p-4 space-y-4 bg-muted/20",children:[e.jsx("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Network Configuration"}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(d,{children:"Protocol"}),e.jsxs(K,{onValueChange:C=>i("protocol",C),defaultValue:(c==null?void 0:c.protocol)||"RTSP",children:[e.jsx(Q,{children:e.jsx(W,{placeholder:"Protocol"})}),e.jsxs(X,{children:[e.jsx(y,{value:"RTSP",children:"RTSP"}),e.jsx(y,{value:"ONVIF",children:"ONVIF"}),e.jsx(y,{value:"HTTP",children:"HTTP"}),e.jsx(y,{value:"HTTPS",children:"HTTPS"})]})]})]}),e.jsxs("div",{className:"col-span-6 space-y-2",children:[e.jsx(d,{htmlFor:"ip_address",children:"IP Address / Hostname"}),e.jsx(o,{id:"ip_address",...t("ip_address",{required:"IP is required"}),placeholder:"192.168.1.100"})]}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(d,{htmlFor:"port",children:"Port"}),e.jsx(o,{id:"port",type:"number",...t("port",{valueAsNumber:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"stream_url",children:"Stream Path"}),e.jsx(o,{id:"stream_url",...t("stream_url"),placeholder:"/live/ch0 (Auto-appended to base URL)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Full URL will be constructed as: protocol://user:pass@ip:port/stream_path"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"username",children:"Username"}),e.jsx(o,{id:"username",...t("username"),placeholder:"admin"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"password",children:"Password"}),e.jsx(o,{id:"password",type:"password",...t("password"),placeholder:"••••••••"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"model",children:"Device Model"}),e.jsx(o,{id:"model",...t("model"),placeholder:"Hikvision DS-2CD..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"firmware_version",children:"Firmware Version"}),e.jsx(o,{id:"firmware_version",...t("firmware_version"),placeholder:"v5.7.1"})]})]}),e.jsxs(G,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsx(j,{type:"submit",disabled:m,children:m?"Saving...":c?"Update Configuration":"Add Camera"})]})]})]})})}const he=()=>{const[a,r]=x.useState([]),[c,b]=x.useState([]),[t,w]=x.useState([]),[N,i]=x.useState(!1),[f,g]=x.useState(null),{toast:m}=O(),n=async()=>{try{const[s,S,R]=await Promise.all([u.getCameras(),u.getVisitors(),u.getIncidents()]);r(s.data||[]),b(S.data||[]),w(R.data||[])}catch(s){console.error("Failed to fetch security data",s)}};x.useEffect(()=>{n()},[]);const C=async s=>{try{f?(await u.updateCamera(f.id,s),m({title:"Updated",description:"Camera configuration updated."})):(await u.addCamera(s),m({title:"Success",description:"Camera added successfully."})),i(!1),n()}catch{m({variant:"destructive",title:"Error",description:"Failed to save camera."})}},V=async s=>{if(confirm("Delete this camera configuration?"))try{await u.deleteCamera(s),m({title:"Deleted",description:"Camera removed."}),n()}catch{m({variant:"destructive",title:"Error",description:"Failed to delete camera."})}};return e.jsxs(A,{title:"Security Operations",subtitle:"Surveillance and Access Control",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{onClick:()=>{g(null),i(!0)},className:"gap-2",children:[e.jsx(Y,{className:"w-4 h-4"})," Add Camera"]}),e.jsxs(j,{variant:"destructive",className:"gap-2",children:[e.jsx(I,{className:"w-4 h-4"})," Report Incident"]})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(h,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium",children:"Active Cameras"}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.filter(s=>s.status==="Online").length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Total: ",a.length]})]})]}),e.jsxs(h,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium",children:"Visitors On-Site"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c.filter(s=>!s.check_out_time).length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Total Today: ",c.length]})]})]}),e.jsxs(h,{children:[e.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium",children:"Open Incidents"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.filter(s=>s.status==="Open").length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Investigating: ",t.filter(s=>s.status==="Under Investigation").length]})]})]})]}),e.jsxs(U,{defaultValue:"cameras",className:"space-y-4",children:[e.jsxs(q,{children:[e.jsx(P,{value:"cameras",children:"Live Matrix"}),e.jsx(P,{value:"visitors",children:"Visitors Log"}),e.jsx(P,{value:"incidents",children:"Incidents"})]}),e.jsx(_,{value:"cameras",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[a.map(s=>e.jsxs(h,{className:"overflow-hidden border-2 border-transparent hover:border-primary/50 transition-all group",children:[e.jsxs(v,{className:"p-3 bg-muted/30 flex flex-row justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-sm",children:s.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.location})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.status==="Online"?"bg-green-500 animate-pulse":"bg-red-500"} mr-2`}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{g(s),i(!0)},children:e.jsx(E,{className:"w-3 h-3"})}),e.jsx(j,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>V(s.id),children:e.jsx(D,{className:"w-3 h-3"})})]})]}),e.jsxs(p,{className:"p-0 bg-black relative aspect-video",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs",children:s.ip_address}),e.jsx("p",{className:"text-[10px] uppercase opacity-70",children:s.protocol||"RTSP"})]})}),e.jsx("div",{className:"absolute top-2 right-2 px-1.5 py-0.5 bg-black/60 rounded text-[10px] text-white font-mono",children:"REC"})]})]},s.id)),a.length===0&&e.jsx("div",{className:"col-span-full py-12 text-center text-muted-foreground border-2 border-dashed rounded-lg",children:'No cameras configured. Click "Add Camera" to setup a stream.'})]})}),e.jsx(_,{value:"visitors",children:e.jsx(h,{children:e.jsx(p,{className:"p-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Name"}),e.jsx("th",{className:"p-2 text-left",children:"Purpose"}),e.jsx("th",{className:"p-2 text-left",children:"Contact"}),e.jsx("th",{className:"p-2 text-left",children:"Entry"}),e.jsx("th",{className:"p-2 text-left",children:"Exit"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2 font-medium",children:s.visitor_name}),e.jsx("td",{className:"p-2",children:s.purpose}),e.jsx("td",{className:"p-2",children:s.phone}),e.jsx("td",{className:"p-2",children:new Date(s.check_in_time).toLocaleTimeString()}),e.jsx("td",{className:"p-2",children:s.check_out_time?new Date(s.check_out_time).toLocaleTimeString():"-"})]},s.id))})]})})})})}),e.jsx(_,{value:"incidents",children:e.jsx(h,{children:e.jsx(p,{className:"pt-6",children:e.jsx("div",{className:"space-y-4",children:t.map(s=>e.jsxs("div",{className:"flex items-center justify-between border-b pb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.incident_type}),e.jsx("p",{className:"text-sm text-gray-500",children:s.description}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.created_at||"").toLocaleString()})]}),e.jsx(H,{variant:s.severity==="Critical"?"destructive":s.severity==="Major"?"default":"outline",children:s.severity})]},s.id))})})})})]})]}),e.jsx(ee,{open:N,onOpenChange:i,initialData:f,onSubmit:C})]})};export{he as default};
