import{r as l,d as le,j as e}from"./index-DIh5wxCw.js";import{b as ie,S as ne,g as oe,D as ce,d as de,e as me,f as w}from"./AdminLayout-CVdM3u-8.js";import{B as j,C as A,d as k}from"./card-BVj2mpCd.js";import{I}from"./index-CXyJ5PVz.js";import{L as c}from"./label-BOSjw2jr.js";import{T as M}from"./textarea-DqMGnoNS.js";import{B as F}from"./badge-DwC97fZb.js";import{T as ue,a as he,b as O,c as x,d as xe,e as u}from"./table-Da73gdk8.js";import{T as pe,D as je,a as ge,b as fe,c as ye,e as ve,d as Ne}from"./dialog-CmLsLM44.js";import{S as g,a as f,b as y,c as v,d as o}from"./select-DxzT1k0b.js";import{l as N}from"./diagnosticService-CX6lvtv1.js";import{p as Ce}from"./patientService-DfHmjeND.js";import{d as _e}from"./doctorService-xcZhvVgS.js";import{E as be,S as Se,D as we}from"./DeleteConfirmDialog-nQwB51sc.js";import{F as Te}from"./filter-DgvuW_0V.js";import{P as De}from"./plus-BlBB68lF.js";import{L as U}from"./loader-circle-u1M5w34w.js";import{E as Le}from"./eye-BS6eP5P1.js";import{C as Fe}from"./circle-check-big-Bo5v3wUR.js";import"./Combination-B3qkWEI7.js";import"./index-lGeLsNXG.js";const Oe={Ordered:"bg-info/10 text-info border-info/20","Sample Collected":"bg-warning/10 text-warning border-warning/20","In Progress":"bg-warning/10 text-warning border-warning/20",Completed:"bg-success/10 text-success border-success/20",Verified:"bg-success/10 text-success border-success/20",Cancelled:"bg-muted text-muted-foreground border-border"},Ee=["Ordered","Sample Collected","In Progress","Completed","Verified","Cancelled"],Pe=["Normal","Urgent","STAT"],ss=()=>{const[H,q]=l.useState([]),[d,z]=l.useState([]),[$,G]=l.useState([]),[J,K]=l.useState([]),[E,P]=l.useState(!0),[C,Q]=l.useState(""),[W,p]=l.useState(!1),[X,T]=l.useState(!1),[r,_]=l.useState(null),[h,B]=l.useState(!1),[D,b]=l.useState(!1),{toast:m}=le(),[t,i]=l.useState({patient_id:"",doctor_id:"",test_type:"",priority:"Normal",clinical_notes:"",status:"Ordered",result:"",result_notes:""});l.useEffect(()=>{L(),Y()},[]);const L=async()=>{var s,a;try{P(!0);const[n,S]=await Promise.all([N.getAll({limit:100}),N.getCatalog().catch(()=>[])]);q(n.data||[]),z(S||[])}catch(n){m({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to load lab tests",variant:"destructive"})}finally{P(!1)}},Y=async()=>{try{const[s,a]=await Promise.all([Ce.getAll({limit:200}),_e.getAll({limit:100})]);G(s.data||[]),K(a.data||[])}catch(s){console.error("Failed to load lookups:",s)}},R=()=>{i({patient_id:"",doctor_id:"",test_type:"",priority:"Normal",clinical_notes:"",status:"Ordered",result:"",result_notes:""}),_(null),B(!1)},Z=()=>{R(),p(!0)},ee=s=>{_(s),B(!0),i({patient_id:s.patient_id||"",doctor_id:s.doctor_id||"",test_type:s.test_type||"",priority:s.priority||"Normal",clinical_notes:s.clinical_notes||"",status:s.status||"Ordered",result:s.result||"",result_notes:s.result_notes||""}),p(!0)},se=s=>{_(s),T(!0)},te=async()=>{var s,a;if(!t.patient_id||!t.doctor_id||!t.test_type){m({title:"Error",description:"Please fill all required fields",variant:"destructive"});return}try{b(!0),h&&r?(await N.update(r.id,t),m({title:"Success",description:"Lab test updated successfully"})):(await N.create(t),m({title:"Success",description:"Lab test ordered successfully"})),p(!1),R(),L()}catch(n){m({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{b(!1)}},ae=async()=>{var s,a;if(r)try{b(!0),await N.delete(r.id),m({title:"Success",description:"Lab test cancelled successfully"}),T(!1),_(null),L()}catch(n){m({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete test",variant:"destructive"})}finally{b(!1)}},V=H.filter(s=>{var a,n,S;return((a=s.test_name)==null?void 0:a.toLowerCase().includes(C.toLowerCase()))||((n=s.patient_name)==null?void 0:n.toLowerCase().includes(C.toLowerCase()))||((S=s.test_code)==null?void 0:S.toLowerCase().includes(C.toLowerCase()))}),re=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"N/A";return e.jsxs(ie,{title:"Lab Tests",subtitle:"Manage laboratory test orders and results",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search lab tests...",className:"pl-10",value:C,onChange:s=>Q(s.target.value)})]}),e.jsx(j,{variant:"outline",size:"icon",children:e.jsx(Te,{className:"w-4 h-4"})})]}),e.jsxs(j,{className:"gap-2",onClick:Z,children:[e.jsx(De,{className:"w-4 h-4"}),"Order Test"]})]}),d.length>0&&e.jsx(A,{className:"mb-6",children:e.jsxs(k,{className:"pt-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Available Tests (",d.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.slice(0,8).map(s=>{var a;return e.jsxs(F,{variant:"secondary",children:[s.test_code,": ",(a=s.test_name)==null?void 0:a.split("(")[0]," - ETB ",s.price]},s.id)}),d.length>8&&e.jsxs(F,{variant:"outline",children:["+",d.length-8," more"]})]})]})}),e.jsx(A,{children:e.jsx(k,{className:"p-0",children:E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(O,{children:[e.jsx(x,{children:"Test Code"}),e.jsx(x,{children:"Test Name"}),e.jsx(x,{children:"Patient"}),e.jsx(x,{children:"Ordered Date"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsxs(xe,{children:[V.map(s=>{var a;return e.jsxs(O,{className:"group",children:[e.jsx(u,{className:"font-mono text-sm",children:s.test_code}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:((a=s.test_name)==null?void 0:a.split("(")[0])||s.test_type})]})}),e.jsx(u,{className:"text-muted-foreground",children:s.patient_name||"Unknown"}),e.jsx(u,{children:re(s.ordered_date||s.created_at)}),e.jsx(u,{children:e.jsx(F,{variant:"outline",className:Oe[s.status]||"",children:s.status})}),e.jsx(u,{className:"text-right",children:e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(be,{className:"w-4 h-4"})})}),e.jsxs(me,{align:"end",children:[e.jsxs(w,{className:"gap-2",children:[e.jsx(Le,{className:"w-4 h-4"})," View Results"]}),e.jsxs(w,{className:"gap-2",onClick:()=>ee(s),children:[e.jsx(Se,{className:"w-4 h-4"})," Enter Results"]}),e.jsxs(w,{className:"gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"})," Verify"]}),e.jsxs(w,{className:"gap-2 text-destructive",onClick:()=>se(s),children:[e.jsx(pe,{className:"w-4 h-4"})," Cancel"]})]})]})})]},s.id)}),V.length===0&&!E&&e.jsx(O,{children:e.jsx(u,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No lab tests found"})})]})]})})}),e.jsx(je,{open:W,onOpenChange:p,children:e.jsxs(ge,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(fe,{children:[e.jsx(ye,{children:h?"Update Lab Test":"Order New Lab Test"}),e.jsx(ve,{children:h?"Update test status and enter results":"Order a new laboratory test"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[!h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(g,{value:t.patient_id,onValueChange:s=>i({...t,patient_id:s}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Select patient"})}),e.jsx(v,{className:"max-h-60",children:$.map(s=>e.jsxs(o,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"doctor_id",children:"Ordering Doctor *"}),e.jsxs(g,{value:t.doctor_id,onValueChange:s=>i({...t,doctor_id:s}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Select doctor"})}),e.jsx(v,{className:"max-h-60",children:J.map(s=>e.jsxs(o,{value:s.id,children:["Dr. ",s.name]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"test_type",children:"Test Type *"}),e.jsxs(g,{value:t.test_type,onValueChange:s=>i({...t,test_type:s}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Select test"})}),e.jsx(v,{className:"max-h-60",children:d.length>0?d.map(s=>e.jsxs(o,{value:s.test_code,children:[s.test_name," - ETB ",s.price]},s.id)):e.jsxs(e.Fragment,{children:[e.jsx(o,{value:"CBC",children:"Complete Blood Count (CBC)"}),e.jsx(o,{value:"BMP",children:"Basic Metabolic Panel"}),e.jsx(o,{value:"UA",children:"Urinalysis"}),e.jsx(o,{value:"LFT",children:"Liver Function Tests"}),e.jsx(o,{value:"TSH",children:"Thyroid Panel"})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"priority",children:"Priority"}),e.jsxs(g,{value:t.priority,onValueChange:s=>i({...t,priority:s}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Select priority"})}),e.jsx(v,{children:Pe.map(s=>e.jsx(o,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"clinical_notes",children:"Clinical Notes"}),e.jsx(M,{id:"clinical_notes",value:t.clinical_notes,onChange:s=>i({...t,clinical_notes:s.target.value}),placeholder:"Relevant clinical information",rows:2})]})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"status",children:"Status"}),e.jsxs(g,{value:t.status,onValueChange:s=>i({...t,status:s}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Select status"})}),e.jsx(v,{children:Ee.map(s=>e.jsx(o,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"result",children:"Result Value"}),e.jsx(I,{id:"result",value:t.result,onChange:s=>i({...t,result:s.target.value}),placeholder:"Enter test result"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"result_notes",children:"Result Notes"}),e.jsx(M,{id:"result_notes",value:t.result_notes,onChange:s=>i({...t,result_notes:s.target.value}),placeholder:"Interpretation or comments",rows:3})]})]})]}),e.jsxs(Ne,{children:[e.jsx(j,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(j,{onClick:te,disabled:D,children:[D&&e.jsx(U,{className:"w-4 h-4 mr-2 animate-spin"}),h?"Save Results":"Order Test"]})]})]})}),e.jsx(we,{open:X,onOpenChange:T,onConfirm:ae,title:"Cancel Lab Test",description:`Are you sure you want to cancel the ${(r==null?void 0:r.test_name)||(r==null?void 0:r.test_type)} test for ${r==null?void 0:r.patient_name}?`,loading:D})]})};export{ss as default};
