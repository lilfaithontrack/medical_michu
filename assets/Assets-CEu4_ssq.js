import{f as o,r as c,d as ne,j as e}from"./index-MFUeX4KC.js";import{c as re,P as I,W as ie,S as le,B as E,T as ce,i as de}from"./AdminLayout-CEyGcOXW.js";import{C as j,d as g,B as w,a as oe,b as xe}from"./card--ujVzSXa.js";import{I as i}from"./Combination-CVDpaV-S.js";import{L as n}from"./label-Cw8AwbsX.js";import{T as G}from"./textarea-BWkPO5tB.js";import{D as ue,a as he,b as me,c as pe,d as je}from"./dialog-C_l7gpm1.js";import{S as C,a as S,b,c as A,d as h}from"./select-CM0PFwtY.js";import{T as ge,a as ve,b as F,c as u,d as fe,e as x}from"./table-tgADzikB.js";import{P as ye}from"./plus-DrrZjkgX.js";import{L as _e}from"./loader-circle-DYBsGSuP.js";import{S as Ne}from"./square-pen-QpnerZQe.js";import"./index-lz0iHb9C.js";const v={getAll:async r=>(await o.get("/assets",{params:r})).data,getById:async r=>(await o.get(`/assets/${r}`)).data,create:async r=>(await o.post("/assets",r)).data,update:async(r,d)=>(await o.put(`/assets/${r}`,d)).data,delete:async r=>(await o.delete(`/assets/${r}`)).data,addMaintenance:async(r,d)=>(await o.post(`/assets/${r}/maintenance`,d)).data,getMaintenanceLog:async r=>(await o.get(`/assets/${r}/maintenance`)).data,getDueMaintenance:async()=>(await o.get("/assets/due-maintenance")).data,getStats:async()=>(await o.get("/assets/stats")).data},U=["Medical Equipment","Furniture","IT Equipment","Vehicle","Utility","Laboratory","Imaging","Surgical"],$=["Active","Under Maintenance","Retired","Disposed","In Storage"],we=["Excellent","Good","Fair","Poor","Non-functional"],Oe=()=>{var V,k,q;const[r,d]=c.useState([]),[l,H]=c.useState(null),[M,W]=c.useState([]),[z,P]=c.useState(!0),[X,f]=c.useState(!1),[T,R]=c.useState(null),[D,J]=c.useState(""),[y,K]=c.useState(""),[_,Q]=c.useState(""),[t,s]=c.useState({name:"",category:"Medical Equipment",description:"",manufacturer:"",model:"",serial_number:"",purchase_date:"",purchase_price:"",depreciation_rate:"10",location:"",department:"",assigned_to:"",status:"Active",condition_rating:"Good",warranty_expiry:"",next_maintenance_date:"",supplier:"",notes:""}),{toast:m}=ne();c.useEffect(()=>{L()},[y,_]);const L=async()=>{try{P(!0);const a={limit:100};y&&y!=="all"&&(a.category=y),_&&_!=="all"&&(a.status=_);const[N,p,se]=await Promise.all([v.getAll(a),v.getStats(),v.getDueMaintenance().catch(()=>[])]);d(N.data||[]),H(p),W(se||[])}catch{m({title:"Error",description:"Failed to load assets",variant:"destructive"})}finally{P(!1)}},Y=()=>{R(null),s({name:"",category:"Medical Equipment",description:"",manufacturer:"",model:"",serial_number:"",purchase_date:"",purchase_price:"",depreciation_rate:"10",location:"",department:"",assigned_to:"",status:"Active",condition_rating:"Good",warranty_expiry:"",next_maintenance_date:"",supplier:"",notes:""}),f(!0)},Z=a=>{R(a),s({name:a.name,category:a.category,description:a.description||"",manufacturer:a.manufacturer||"",model:a.model||"",serial_number:a.serial_number||"",purchase_date:a.purchase_date?new Date(a.purchase_date).toISOString().split("T")[0]:"",purchase_price:String(a.purchase_price||""),depreciation_rate:String(a.depreciation_rate||"10"),location:a.location||"",department:a.department||"",assigned_to:a.assigned_to||"",status:a.status,condition_rating:a.condition_rating,warranty_expiry:a.warranty_expiry?new Date(a.warranty_expiry).toISOString().split("T")[0]:"",next_maintenance_date:a.next_maintenance_date?new Date(a.next_maintenance_date).toISOString().split("T")[0]:"",supplier:a.supplier||"",notes:a.notes||""}),f(!0)},ee=async()=>{var a,N;try{const p={...t,purchase_price:parseFloat(t.purchase_price)||0,depreciation_rate:parseFloat(t.depreciation_rate)||10,purchase_date:t.purchase_date||null,warranty_expiry:t.warranty_expiry||null,next_maintenance_date:t.next_maintenance_date||null};T?(await v.update(T.id,p),m({title:"Success",description:"Asset updated"})):(await v.create(p),m({title:"Success",description:"Asset created"})),f(!1),L()}catch(p){m({title:"Error",description:((N=(a=p.response)==null?void 0:a.data)==null?void 0:N.message)||"Failed to save asset",variant:"destructive"})}},ae=async a=>{try{await v.delete(a),m({title:"Success",description:"Asset deleted"}),L()}catch{m({title:"Error",description:"Failed to delete",variant:"destructive"})}},O=r.filter(a=>a.name.toLowerCase().includes(D.toLowerCase())||a.asset_code.toLowerCase().includes(D.toLowerCase())||(a.manufacturer||"").toLowerCase().includes(D.toLowerCase())),B=a=>`ETB ${(a||0).toLocaleString()}`,te=a=>{switch(a){case"Active":return"default";case"Under Maintenance":return"secondary";case"Retired":return"outline";case"Disposed":return"destructive";default:return"outline"}};return e.jsxs(re,{title:"Assets",subtitle:"Manage hospital assets and equipment",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(j,{children:e.jsx(g,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Assets"}),e.jsx("p",{className:"text-3xl font-bold",children:((V=l==null?void 0:l.totals)==null?void 0:V.total_assets)||0})]}),e.jsx(I,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(j,{children:e.jsx(g,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:((k=l==null?void 0:l.totals)==null?void 0:k.active_count)||0})]}),e.jsx(I,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(j,{children:e.jsx(g,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Maintenance Due"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:M.length})]}),e.jsx(ie,{className:"w-8 h-8 text-yellow-600"})]})})}),e.jsx(j,{children:e.jsx(g,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold",children:B(((q=l==null?void 0:l.totals)==null?void 0:q.total_current_value)||0)})]}),e.jsx(I,{className:"w-8 h-8 text-blue-600"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"flex gap-3 items-center flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-xs",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(i,{placeholder:"Search assets...",className:"pl-10",value:D,onChange:a=>J(a.target.value)})]}),e.jsxs(C,{value:y,onValueChange:K,children:[e.jsx(S,{className:"w-[160px]",children:e.jsx(b,{placeholder:"All Categories"})}),e.jsxs(A,{children:[e.jsx(h,{value:"all",children:"All Categories"}),U.map(a=>e.jsx(h,{value:a,children:a},a))]})]}),e.jsxs(C,{value:_,onValueChange:Q,children:[e.jsx(S,{className:"w-[140px]",children:e.jsx(b,{placeholder:"All Status"})}),e.jsxs(A,{children:[e.jsx(h,{value:"all",children:"All Status"}),$.map(a=>e.jsx(h,{value:a,children:a},a))]})]})]}),e.jsxs(w,{className:"gap-2",onClick:Y,children:[e.jsx(ye,{className:"w-4 h-4"})," Add Asset"]})]}),e.jsx(j,{children:e.jsx(g,{className:"p-0",children:z?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_e,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(ge,{children:[e.jsx(ve,{children:e.jsxs(F,{children:[e.jsx(u,{children:"Code"}),e.jsx(u,{children:"Name"}),e.jsx(u,{children:"Category"}),e.jsx(u,{children:"Location"}),e.jsx(u,{children:"Value"}),e.jsx(u,{children:"Condition"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Actions"})]})}),e.jsxs(fe,{children:[O.map(a=>e.jsxs(F,{children:[e.jsx(x,{className:"font-mono text-sm",children:a.asset_code}),e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),a.manufacturer&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a.manufacturer})]})}),e.jsx(x,{children:e.jsx(E,{variant:"secondary",children:a.category})}),e.jsx(x,{className:"text-sm",children:a.location||"N/A"}),e.jsx(x,{className:"text-sm",children:B(a.current_value)}),e.jsx(x,{children:e.jsx(E,{variant:"outline",className:a.condition_rating==="Excellent"?"border-green-500 text-green-600":a.condition_rating==="Good"?"border-blue-500 text-blue-600":a.condition_rating==="Fair"?"border-yellow-500 text-yellow-600":"border-red-500 text-red-600",children:a.condition_rating})}),e.jsx(x,{children:e.jsx(E,{variant:te(a.status),children:a.status})}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>Z(a),children:e.jsx(Ne,{className:"w-3 h-3"})}),e.jsx(w,{size:"sm",variant:"ghost",className:"text-red-500",onClick:()=>ae(a.id),children:e.jsx(ce,{className:"w-3 h-3"})})]})})]},a.id)),O.length===0&&e.jsx(F,{children:e.jsx(x,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No assets found"})})]})]})})}),M.length>0&&e.jsxs(j,{className:"mt-6",children:[e.jsx(oe,{children:e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5 text-yellow-500"})," Maintenance Due"]})}),e.jsx(g,{className:"space-y-2",children:M.map(a=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b last:border-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.location," â€¢ Due: ",a.next_maintenance_date]})]}),e.jsx(E,{variant:"outline",className:"border-yellow-500 text-yellow-600",children:"Due"})]},a.id))})]}),e.jsx(ue,{open:X,onOpenChange:f,children:e.jsxs(he,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(me,{children:e.jsx(pe,{children:T?"Edit Asset":"Add New Asset"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Name *"}),e.jsx(i,{value:t.name,onChange:a=>s({...t,name:a.target.value}),placeholder:"e.g. Digital X-Ray Machine"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Category"}),e.jsxs(C,{value:t.category,onValueChange:a=>s({...t,category:a}),children:[e.jsx(S,{children:e.jsx(b,{})}),e.jsx(A,{children:U.map(a=>e.jsx(h,{value:a,children:a},a))})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Status"}),e.jsxs(C,{value:t.status,onValueChange:a=>s({...t,status:a}),children:[e.jsx(S,{children:e.jsx(b,{})}),e.jsx(A,{children:$.map(a=>e.jsx(h,{value:a,children:a},a))})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Manufacturer"}),e.jsx(i,{value:t.manufacturer,onChange:a=>s({...t,manufacturer:a.target.value}),placeholder:"e.g. GE Healthcare"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Model"}),e.jsx(i,{value:t.model,onChange:a=>s({...t,model:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Serial Number"}),e.jsx(i,{value:t.serial_number,onChange:a=>s({...t,serial_number:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Purchase Date"}),e.jsx(i,{type:"date",value:t.purchase_date,onChange:a=>s({...t,purchase_date:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Purchase Price (ETB)"}),e.jsx(i,{type:"number",value:t.purchase_price,onChange:a=>s({...t,purchase_price:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Depreciation Rate (%)"}),e.jsx(i,{type:"number",value:t.depreciation_rate,onChange:a=>s({...t,depreciation_rate:a.target.value}),placeholder:"10"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Location"}),e.jsx(i,{value:t.location,onChange:a=>s({...t,location:a.target.value}),placeholder:"e.g. Radiology Dept"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Department"}),e.jsx(i,{value:t.department,onChange:a=>s({...t,department:a.target.value}),placeholder:"e.g. ICU, OPD"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Assigned To"}),e.jsx(i,{value:t.assigned_to,onChange:a=>s({...t,assigned_to:a.target.value}),placeholder:"Staff member or team"})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Condition"}),e.jsxs(C,{value:t.condition_rating,onValueChange:a=>s({...t,condition_rating:a}),children:[e.jsx(S,{children:e.jsx(b,{})}),e.jsx(A,{children:we.map(a=>e.jsx(h,{value:a,children:a},a))})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Warranty Expiry"}),e.jsx(i,{type:"date",value:t.warranty_expiry,onChange:a=>s({...t,warranty_expiry:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Next Maintenance"}),e.jsx(i,{type:"date",value:t.next_maintenance_date,onChange:a=>s({...t,next_maintenance_date:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Supplier"}),e.jsx(i,{value:t.supplier,onChange:a=>s({...t,supplier:a.target.value})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Description"}),e.jsx(G,{value:t.description,onChange:a=>s({...t,description:a.target.value}),rows:2,placeholder:"Asset description..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(n,{children:"Notes"}),e.jsx(G,{value:t.notes,onChange:a=>s({...t,notes:a.target.value}),rows:2})]})]}),e.jsxs(je,{children:[e.jsx(w,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsxs(w,{onClick:ee,children:[T?"Update":"Create"," Asset"]})]})]})})]})};export{Oe as default};
