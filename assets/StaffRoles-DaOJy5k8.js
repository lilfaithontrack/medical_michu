import{m as de,r as d,n as J,j as e,P as F,o as me,p as Ve,q as ue,s as Be,t as ze,R as b,e as Q,d as qe}from"./index-MFUeX4KC.js";import{c as Ge,S as Ke,B as M,D as Ue,e as Ye,f as Je,g as oe,T as Qe}from"./AdminLayout-CEyGcOXW.js";import{B as P,C as ne,d as re,a as We,b as Xe,c as Ze}from"./card--ujVzSXa.js";import{u as pe,c as es,d as ss,I as le,S as ts,L as as}from"./Combination-CVDpaV-S.js";import{L as K}from"./label-Cw8AwbsX.js";import{T as os}from"./textarea-BWkPO5tB.js";import{C as ie}from"./checkbox-D5sbX6eA.js";import{S as ns}from"./switch-BSdZvj2s.js";import{T as rs,a as ls,b as U,c as E,d as is,e as k}from"./table-tgADzikB.js";import{D as cs,a as ds,b as ms,c as us,e as ps,d as hs}from"./dialog-C_l7gpm1.js";import{s as L}from"./staffRoleService-C1Icp4Fs.js";import{E as xs,D as fs}from"./DeleteConfirmDialog-Tv4EgB03.js";import{P as gs}from"./plus-DrrZjkgX.js";import{L as ce}from"./loader-circle-DYBsGSuP.js";import{S as vs}from"./square-pen-QpnerZQe.js";import"./index-lz0iHb9C.js";var z="Collapsible",[js,he]=de(z),[Cs,W]=js(z),xe=d.forwardRef((t,l)=>{const{__scopeCollapsible:a,open:o,defaultOpen:i,disabled:n,onOpenChange:m,...p}=t,[g,x]=J({prop:o,defaultProp:i??!1,onChange:m,caller:z});return e.jsx(Cs,{scope:a,disabled:n,contentId:pe(),open:g,onOpenToggle:d.useCallback(()=>x(j=>!j),[x]),children:e.jsx(F.div,{"data-state":Z(g),"data-disabled":n?"":void 0,...p,ref:l})})});xe.displayName=z;var fe="CollapsibleTrigger",ge=d.forwardRef((t,l)=>{const{__scopeCollapsible:a,...o}=t,i=W(fe,a);return e.jsx(F.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":Z(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...o,ref:l,onClick:me(t.onClick,i.onOpenToggle)})});ge.displayName=fe;var X="CollapsibleContent",ve=d.forwardRef((t,l)=>{const{forceMount:a,...o}=t,i=W(X,t.__scopeCollapsible);return e.jsx(Ve,{present:a||i.open,children:({present:n})=>e.jsx(bs,{...o,ref:l,present:n})})});ve.displayName=X;var bs=d.forwardRef((t,l)=>{const{__scopeCollapsible:a,present:o,children:i,...n}=t,m=W(X,a),[p,g]=d.useState(o),x=d.useRef(null),j=ue(l,x),v=d.useRef(0),f=v.current,w=d.useRef(0),_=w.current,S=m.open||p,y=d.useRef(S),N=d.useRef(void 0);return d.useEffect(()=>{const c=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(c)},[]),Be(()=>{const c=x.current;if(c){N.current=N.current||{transitionDuration:c.style.transitionDuration,animationName:c.style.animationName},c.style.transitionDuration="0s",c.style.animationName="none";const u=c.getBoundingClientRect();v.current=u.height,w.current=u.width,y.current||(c.style.transitionDuration=N.current.transitionDuration,c.style.animationName=N.current.animationName),g(o)}},[m.open,o]),e.jsx(F.div,{"data-state":Z(m.open),"data-disabled":m.disabled?"":void 0,id:m.contentId,hidden:!S,...n,ref:j,style:{"--radix-collapsible-content-height":f?`${f}px`:void 0,"--radix-collapsible-content-width":_?`${_}px`:void 0,...t.style},children:S&&i})});function Z(t){return t?"open":"closed"}var ws=xe,Ns=ge,ys=ve,A="Accordion",As=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[ee,_s,Ss]=ze(A),[q,et]=de(A,[Ss,he]),se=he(),je=b.forwardRef((t,l)=>{const{type:a,...o}=t,i=o,n=o;return e.jsx(ee.Provider,{scope:t.__scopeAccordion,children:a==="multiple"?e.jsx(ks,{...n,ref:l}):e.jsx(Ds,{...i,ref:l})})});je.displayName=A;var[Ce,Rs]=q(A),[be,Is]=q(A,{collapsible:!1}),Ds=b.forwardRef((t,l)=>{const{value:a,defaultValue:o,onValueChange:i=()=>{},collapsible:n=!1,...m}=t,[p,g]=J({prop:a,defaultProp:o??"",onChange:i,caller:A});return e.jsx(Ce,{scope:t.__scopeAccordion,value:b.useMemo(()=>p?[p]:[],[p]),onItemOpen:g,onItemClose:b.useCallback(()=>n&&g(""),[n,g]),children:e.jsx(be,{scope:t.__scopeAccordion,collapsible:n,children:e.jsx(we,{...m,ref:l})})})}),ks=b.forwardRef((t,l)=>{const{value:a,defaultValue:o,onValueChange:i=()=>{},...n}=t,[m,p]=J({prop:a,defaultProp:o??[],onChange:i,caller:A}),g=b.useCallback(j=>p((v=[])=>[...v,j]),[p]),x=b.useCallback(j=>p((v=[])=>v.filter(f=>f!==j)),[p]);return e.jsx(Ce,{scope:t.__scopeAccordion,value:m,onItemOpen:g,onItemClose:x,children:e.jsx(be,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx(we,{...n,ref:l})})})}),[Ps,G]=q(A),we=b.forwardRef((t,l)=>{const{__scopeAccordion:a,disabled:o,dir:i,orientation:n="vertical",...m}=t,p=b.useRef(null),g=ue(p,l),x=_s(a),v=es(i)==="ltr",f=me(t.onKeyDown,w=>{var $;if(!As.includes(w.key))return;const _=w.target,S=x().filter(O=>{var V;return!((V=O.ref.current)!=null&&V.disabled)}),y=S.findIndex(O=>O.ref.current===_),N=S.length;if(y===-1)return;w.preventDefault();let c=y;const u=0,C=N-1,D=()=>{c=y+1,c>C&&(c=u)},T=()=>{c=y-1,c<u&&(c=C)};switch(w.key){case"Home":c=u;break;case"End":c=C;break;case"ArrowRight":n==="horizontal"&&(v?D():T());break;case"ArrowDown":n==="vertical"&&D();break;case"ArrowLeft":n==="horizontal"&&(v?T():D());break;case"ArrowUp":n==="vertical"&&T();break}const H=c%N;($=S[H].ref.current)==null||$.focus()});return e.jsx(Ps,{scope:a,disabled:o,direction:i,orientation:n,children:e.jsx(ee.Slot,{scope:a,children:e.jsx(F.div,{...m,"data-orientation":n,ref:g,onKeyDown:o?void 0:f})})})}),B="AccordionItem",[Es,te]=q(B),Ne=b.forwardRef((t,l)=>{const{__scopeAccordion:a,value:o,...i}=t,n=G(B,a),m=Rs(B,a),p=se(a),g=pe(),x=o&&m.value.includes(o)||!1,j=n.disabled||t.disabled;return e.jsx(Es,{scope:a,open:x,disabled:j,triggerId:g,children:e.jsx(ws,{"data-orientation":n.orientation,"data-state":Ie(x),...p,...i,ref:l,disabled:j,open:x,onOpenChange:v=>{v?m.onItemOpen(o):m.onItemClose(o)}})})});Ne.displayName=B;var ye="AccordionHeader",Ae=b.forwardRef((t,l)=>{const{__scopeAccordion:a,...o}=t,i=G(A,a),n=te(ye,a);return e.jsx(F.h3,{"data-orientation":i.orientation,"data-state":Ie(n.open),"data-disabled":n.disabled?"":void 0,...o,ref:l})});Ae.displayName=ye;var Y="AccordionTrigger",_e=b.forwardRef((t,l)=>{const{__scopeAccordion:a,...o}=t,i=G(A,a),n=te(Y,a),m=Is(Y,a),p=se(a);return e.jsx(ee.ItemSlot,{scope:a,children:e.jsx(Ns,{"aria-disabled":n.open&&!m.collapsible||void 0,"data-orientation":i.orientation,id:n.triggerId,...p,...o,ref:l})})});_e.displayName=Y;var Se="AccordionContent",Re=b.forwardRef((t,l)=>{const{__scopeAccordion:a,...o}=t,i=G(A,a),n=te(Se,a),m=se(a);return e.jsx(ys,{role:"region","aria-labelledby":n.triggerId,"data-orientation":i.orientation,...m,...o,ref:l,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Re.displayName=Se;function Ie(t){return t?"open":"closed"}var Ts=je,Os=Ne,Ms=Ae,De=_e,ke=Re;const Ls=Ts,Pe=d.forwardRef(({className:t,...l},a)=>e.jsx(Os,{ref:a,className:Q("border-b",t),...l}));Pe.displayName="AccordionItem";const Ee=d.forwardRef(({className:t,children:l,...a},o)=>e.jsx(Ms,{className:"flex",children:e.jsxs(De,{ref:o,className:Q("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...a,children:[l,e.jsx(ss,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));Ee.displayName=De.displayName;const Te=d.forwardRef(({className:t,children:l,...a},o)=>e.jsx(ke,{ref:o,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...a,children:e.jsx("div",{className:Q("pb-4 pt-0",t),children:l})}));Te.displayName=ke.displayName;const st=()=>{const[t,l]=d.useState([]),[a,o]=d.useState({}),[i,n]=d.useState(!0),[m,p]=d.useState(""),[g,x]=d.useState(!1),[j,v]=d.useState(!1),[f,w]=d.useState(null),[_,S]=d.useState(!1),[y,N]=d.useState(!1),{toast:c}=qe(),[u,C]=d.useState({name:"",description:"",allowed_modules:[],is_active:!0});d.useEffect(()=>{D(),T()},[]);const D=async()=>{var s,r;try{n(!0);const h=await L.getAll({limit:100});l(h.data||[])}catch(h){c({title:"Error",description:((r=(s=h.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to load roles",variant:"destructive"})}finally{n(!1)}},T=async()=>{try{const s=await L.getModules(!0);o(s)}catch(s){console.error("Failed to load modules:",s)}},H=()=>{C({name:"",description:"",allowed_modules:[],is_active:!0}),w(null),S(!1)},$=()=>{H(),x(!0)},O=s=>{w(s),S(!0),C({name:s.name,description:s.description||"",allowed_modules:s.allowed_modules||[],is_active:s.is_active}),x(!0)},V=s=>{w(s),v(!0)},Oe=s=>{C(r=>({...r,allowed_modules:r.allowed_modules.includes(s)?r.allowed_modules.filter(h=>h!==s):[...r.allowed_modules,s]}))},Me=s=>{const r=s.map(I=>I.key),h=r.every(I=>u.allowed_modules.includes(I));C(I=>({...I,allowed_modules:h?I.allowed_modules.filter(R=>!r.includes(R)):[...new Set([...I.allowed_modules,...r])]}))},Le=()=>{const s=Object.values(a).flat().map(r=>r.key);C(r=>({...r,allowed_modules:s}))},Fe=()=>{C(s=>({...s,allowed_modules:[]}))},He=async()=>{var s,r;if(!u.name){c({title:"Error",description:"Role name is required",variant:"destructive"});return}if(u.allowed_modules.length===0){c({title:"Error",description:"Select at least one module",variant:"destructive"});return}try{N(!0),_&&f?(await L.update(f.id,u),c({title:"Success",description:"Role updated successfully"})):(await L.create(u),c({title:"Success",description:"Role created successfully"})),x(!1),H(),D()}catch(h){c({title:"Error",description:((r=(s=h.response)==null?void 0:s.data)==null?void 0:r.message)||"Operation failed",variant:"destructive"})}finally{N(!1)}},$e=async()=>{var s,r;if(f)try{N(!0),await L.delete(f.id),c({title:"Success",description:"Role deleted successfully"}),v(!1),w(null),D()}catch(h){c({title:"Error",description:((r=(s=h.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete role",variant:"destructive"})}finally{N(!1)}},ae=t.filter(s=>{var r,h;return((r=s.name)==null?void 0:r.toLowerCase().includes(m.toLowerCase()))||((h=s.description)==null?void 0:h.toLowerCase().includes(m.toLowerCase()))});return e.jsxs(Ge,{title:"Staff Roles",subtitle:"Manage roles and assign module permissions",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsx("div",{className:"flex flex-1 gap-3",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(le,{placeholder:"Search roles...",className:"pl-10",value:m,onChange:s=>p(s.target.value)})]})}),e.jsxs(P,{className:"gap-2",onClick:$,children:[e.jsx(gs,{className:"w-4 h-4"}),"Create Role"]})]}),e.jsx(ne,{children:e.jsx(re,{className:"p-0",children:i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ce,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(rs,{children:[e.jsx(ls,{children:e.jsxs(U,{children:[e.jsx(E,{children:"Role Name"}),e.jsx(E,{children:"Description"}),e.jsx(E,{children:"Modules"}),e.jsx(E,{children:"Type"}),e.jsx(E,{children:"Status"}),e.jsx(E,{className:"text-right",children:"Actions"})]})}),e.jsxs(is,{children:[ae.map(s=>{var r,h;return e.jsxs(U,{className:"group",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(k,{className:"text-muted-foreground max-w-xs truncate",children:s.description||"-"}),e.jsx(k,{children:e.jsx(M,{variant:"secondary",children:(r=s.allowed_modules)!=null&&r.includes("*")?"All Modules":`${((h=s.allowed_modules)==null?void 0:h.length)||0} modules`})}),e.jsx(k,{children:s.is_system?e.jsxs(M,{variant:"outline",className:"border-primary text-primary",children:[e.jsx(as,{className:"w-3 h-3 mr-1"}),"System"]}):e.jsx(M,{variant:"outline",children:"Custom"})}),e.jsx(k,{children:e.jsx(M,{variant:"outline",className:s.is_active?"border-success text-success":"border-muted",children:s.is_active?"Active":"Inactive"})}),e.jsx(k,{className:"text-right",children:e.jsxs(Ue,{children:[e.jsx(Ye,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(xs,{className:"w-4 h-4"})})}),e.jsxs(Je,{align:"end",children:[e.jsxs(oe,{className:"gap-2",onClick:()=>O(s),children:[e.jsx(vs,{className:"w-4 h-4"})," Edit"]}),!s.is_system&&e.jsxs(oe,{className:"gap-2 text-destructive",onClick:()=>V(s),children:[e.jsx(Qe,{className:"w-4 h-4"})," Delete"]})]})]})})]},s.id)}),ae.length===0&&!i&&e.jsx(U,{children:e.jsx(k,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No roles found"})})]})]})})}),e.jsx(cs,{open:g,onOpenChange:x,children:e.jsxs(ds,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ms,{children:[e.jsx(us,{children:_?"Edit Role":"Create New Role"}),e.jsx(ps,{children:_?"Update role details and module permissions":"Create a new staff role and assign module access"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"name",children:"Role Name *"}),e.jsx(le,{id:"name",value:u.name,onChange:s=>C({...u,name:s.target.value}),placeholder:"e.g., Senior Nurse",disabled:_&&(f==null?void 0:f.is_system)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2 h-10",children:[e.jsx(ns,{checked:u.is_active,onCheckedChange:s=>C({...u,is_active:s})}),e.jsx("span",{className:"text-sm",children:u.is_active?"Active":"Inactive"})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(K,{htmlFor:"description",children:"Description"}),e.jsx(os,{id:"description",value:u.description,onChange:s=>C({...u,description:s.target.value}),placeholder:"Brief description of this role's responsibilities",rows:2})]})]}),e.jsxs(ne,{children:[e.jsx(We,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Xe,{className:"text-base",children:"Module Access"}),e.jsxs(Ze,{children:["Select which modules this role can access (",u.allowed_modules.length," selected)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:"outline",size:"sm",onClick:Le,children:"Select All"}),e.jsx(P,{variant:"outline",size:"sm",onClick:Fe,children:"Clear"})]})]})}),e.jsx(re,{children:e.jsx(Ls,{type:"multiple",defaultValue:Object.keys(a),className:"w-full",children:Object.entries(a).map(([s,r])=>{const h=r.filter(R=>u.allowed_modules.includes(R.key)).length,I=h===r.length;return e.jsxs(Pe,{value:s,children:[e.jsx(Ee,{className:"hover:no-underline",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{checked:I,onCheckedChange:()=>Me(r),onClick:R=>R.stopPropagation()}),e.jsx("span",{children:s}),e.jsxs(M,{variant:"secondary",className:"ml-2",children:[h,"/",r.length]})]})}),e.jsx(Te,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 pl-8 pt-2",children:r.map(R=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:text-primary",children:[e.jsx(ie,{checked:u.allowed_modules.includes(R.key),onCheckedChange:()=>Oe(R.key)}),e.jsx("span",{className:"text-sm",children:R.label})]},R.key))})})]},s)})})})]})]}),e.jsxs(hs,{children:[e.jsx(P,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(P,{onClick:He,disabled:y,children:[y&&e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}),_?"Update":"Create"," Role"]})]})]})}),e.jsx(fs,{open:j,onOpenChange:v,onConfirm:$e,title:"Delete Role",description:`Are you sure you want to delete "${f==null?void 0:f.name}"? Staff members with this role will need to be reassigned.`,loading:y})]})};export{st as default};
