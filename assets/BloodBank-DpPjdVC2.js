import{c as _e,r as o,d as Ne,j as e}from"./index-DIh5wxCw.js";import{b as ye,S as De,D as Se,d as Ce,e as we,f as M}from"./AdminLayout-CVdM3u-8.js";import{C as v,d as b,B as x,a as Fe,b as Be}from"./card-BVj2mpCd.js";import{I as m}from"./index-CXyJ5PVz.js";import{L as r}from"./label-BOSjw2jr.js";import{T as $}from"./textarea-DqMGnoNS.js";import{B as A}from"./badge-DwC97fZb.js";import{T as qe,a as Re,b as k,c as f,d as Oe,e as p}from"./table-Da73gdk8.js";import{T as Te,D as z,a as J,b as K,c as Q,e as W,d as Y}from"./dialog-CmLsLM44.js";import{S as _,a as N,b as y,c as D,d as c}from"./select-DxzT1k0b.js";import{a as S}from"./billingService-xYtcB7oE.js";import{p as Ee}from"./patientService-DfHmjeND.js";import{E as Ae,S as ke,D as Ie}from"./DeleteConfirmDialog-nQwB51sc.js";import{H as I}from"./heart-Dd3dtGYD.js";import{P as Pe}from"./plus-BlBB68lF.js";import{L as P}from"./loader-circle-u1M5w34w.js";import"./Combination-B3qkWEI7.js";import"./index-lGeLsNXG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=_e("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]),U={"A+":"bg-red-500/10 text-red-500 border-red-500/20","A-":"bg-red-600/10 text-red-600 border-red-600/20","B+":"bg-blue-500/10 text-blue-500 border-blue-500/20","B-":"bg-blue-600/10 text-blue-600 border-blue-600/20","AB+":"bg-purple-500/10 text-purple-500 border-purple-500/20","AB-":"bg-purple-600/10 text-purple-600 border-purple-600/20","O+":"bg-green-500/10 text-green-500 border-green-500/20","O-":"bg-green-600/10 text-green-600 border-green-600/20"},L=["A+","A-","B+","B-","AB+","AB-","O+","O-"],Ue=["Collected","Processing","Available","Expired","Used"],Le=["Male","Female"],ls=()=>{const[O,ee]=o.useState([]),[T,se]=o.useState([]),[te,ae]=o.useState([]),[ne,V]=o.useState(!0),[le,oe]=o.useState(""),[re,C]=o.useState(!1),[ie,B]=o.useState(!1),[de,E]=o.useState(!1),[u,q]=o.useState(null),[w,X]=o.useState(!1),[F,j]=o.useState(!1),{toast:d}=Ne(),[t,i]=o.useState({donor_name:"",donor_phone:"",donor_age:"",gender:"",blood_group:"",units_donated:"1",hemoglobin_level:"",notes:"",status:"Collected"}),[l,g]=o.useState({patient_id:"",blood_group:"",units_requested:"1",priority:"Normal",reason:""});o.useEffect(()=>{R(),ce()},[]);const R=async()=>{var s,a;try{V(!0);const[n,h]=await Promise.all([S.getInventory(),S.getDonations({limit:20}).catch(()=>({data:[]}))]);ee(n||[]),se(h.data||[])}catch(n){d({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to load blood bank data",variant:"destructive"})}finally{V(!1)}},ce=async()=>{try{const s=await Ee.getAll({limit:200});ae(s.data||[])}catch(s){console.error("Failed to load patients:",s)}},G=()=>{i({donor_name:"",donor_phone:"",donor_age:"",gender:"",blood_group:"",units_donated:"1",hemoglobin_level:"",notes:"",status:"Collected"}),q(null),X(!1)},ue=()=>{G(),C(!0)},he=s=>{var a,n,h;q(s),X(!0),i({donor_name:s.donor_name||"",donor_phone:s.donor_phone||"",donor_age:((a=s.donor_age)==null?void 0:a.toString())||"",gender:s.gender||"",blood_group:s.blood_group||"",units_donated:((n=s.units_donated)==null?void 0:n.toString())||"1",hemoglobin_level:((h=s.hemoglobin_level)==null?void 0:h.toString())||"",notes:s.notes||"",status:s.status||"Collected"}),C(!0)},xe=()=>{g({patient_id:"",blood_group:"",units_requested:"1",priority:"Normal",reason:""}),B(!0)},me=s=>{q(s),E(!0)},pe=async()=>{var s,a;if(!t.donor_name||!t.blood_group){d({title:"Error",description:"Please fill donor name and blood group",variant:"destructive"});return}try{j(!0);const n={...t,donor_age:t.donor_age?parseInt(t.donor_age):null,units_donated:parseInt(t.units_donated),hemoglobin_level:t.hemoglobin_level?parseFloat(t.hemoglobin_level):null};w&&u?(await S.updateDonation(u.id,n),d({title:"Success",description:"Donation updated successfully"})):(await S.addDonation(n),d({title:"Success",description:"Donation recorded successfully"})),C(!1),G(),R()}catch(n){d({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{j(!1)}},je=async()=>{var s,a;if(!l.patient_id||!l.blood_group){d({title:"Error",description:"Please select patient and blood group",variant:"destructive"});return}try{j(!0),await S.createRequest({...l,units_requested:parseInt(l.units_requested)}),d({title:"Success",description:"Blood request submitted successfully"}),B(!1),R()}catch(n){d({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{j(!1)}},ge=async()=>{var s,a;if(u)try{j(!0),await S.deleteDonation(u.id),d({title:"Success",description:"Donation record deleted successfully"}),E(!1),q(null),R()}catch(n){d({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete donation",variant:"destructive"})}finally{j(!1)}},H=O.reduce((s,a)=>(s[a.blood_group]||(s[a.blood_group]=[]),s[a.blood_group].push(a),s),{}),ve=O.reduce((s,a)=>s+(a.units_available||0),0);return e.jsxs(ye,{title:"Blood Bank",subtitle:"Manage blood inventory and donations",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(v,{children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Units"}),e.jsx("p",{className:"text-3xl font-bold",children:ve})]}),e.jsx(Z,{className:"w-8 h-8 text-destructive"})]})})}),e.jsx(v,{children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Blood Groups"}),e.jsx("p",{className:"text-3xl font-bold",children:Object.keys(H).length})]}),e.jsx(I,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(v,{children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Donations"}),e.jsx("p",{className:"text-3xl font-bold text-success",children:T.length})]}),e.jsx(I,{className:"w-8 h-8 text-success"})]})})}),e.jsx(v,{children:e.jsx(b,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Low Stock"}),e.jsx("p",{className:"text-3xl font-bold text-warning",children:O.filter(s=>s.units_available<10).length})]}),e.jsx(Z,{className:"w-8 h-8 text-warning"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search blood type...",className:"pl-10",value:le,onChange:s=>oe(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:"outline",className:"gap-2",onClick:ue,children:[e.jsx(I,{className:"w-4 h-4"}),"New Donation"]}),e.jsxs(x,{className:"gap-2",onClick:xe,children:[e.jsx(Pe,{className:"w-4 h-4"}),"Blood Request"]})]})]}),ne?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 mb-6",children:L.map(s=>{var h;const n=(H[s]||[]).reduce((be,fe)=>be+(fe.units_available||0),0);return e.jsx(v,{className:`border-2 ${(h=U[s])==null?void 0:h.replace("/10","/20")}`,children:e.jsxs(b,{className:"pt-4 text-center",children:[e.jsx(A,{className:`text-lg px-3 py-1 ${U[s]}`,children:s}),e.jsx("p",{className:"text-3xl font-bold mt-2",children:n}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"units"})]})},s)})}),e.jsxs(v,{children:[e.jsx(Fe,{children:e.jsx(Be,{className:"text-lg",children:"Recent Donations"})}),e.jsx(b,{className:"p-0",children:e.jsxs(qe,{children:[e.jsx(Re,{children:e.jsxs(k,{children:[e.jsx(f,{children:"ID"}),e.jsx(f,{children:"Donor"}),e.jsx(f,{children:"Blood Group"}),e.jsx(f,{children:"Units"}),e.jsx(f,{children:"Status"}),e.jsx(f,{className:"text-right",children:"Actions"})]})}),e.jsxs(Oe,{children:[T.slice(0,10).map(s=>e.jsxs(k,{className:"group",children:[e.jsx(p,{className:"font-mono text-sm",children:s.donation_id}),e.jsx(p,{className:"font-medium",children:s.donor_name}),e.jsx(p,{children:e.jsx(A,{variant:"outline",className:U[s.blood_group]||"",children:s.blood_group})}),e.jsx(p,{children:s.units_donated}),e.jsx(p,{children:e.jsx(A,{variant:s.status==="Available"?"default":"secondary",children:s.status})}),e.jsx(p,{className:"text-right",children:e.jsxs(Se,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsxs(we,{align:"end",children:[e.jsxs(M,{className:"gap-2",onClick:()=>he(s),children:[e.jsx(ke,{className:"w-4 h-4"})," Edit"]}),e.jsxs(M,{className:"gap-2 text-destructive",onClick:()=>me(s),children:[e.jsx(Te,{className:"w-4 h-4"})," Delete"]})]})]})})]},s.id)),T.length===0&&e.jsx(k,{children:e.jsx(p,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No recent donations"})})]})]})})]})]}),e.jsx(z,{open:re,onOpenChange:C,children:e.jsxs(J,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsx(Q,{children:w?"Update Donation":"Record New Donation"}),e.jsx(W,{children:w?"Update donation record":"Record a new blood donation"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(r,{htmlFor:"donor_name",children:"Donor Name *"}),e.jsx(m,{id:"donor_name",value:t.donor_name,onChange:s=>i({...t,donor_name:s.target.value}),placeholder:"Full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"donor_phone",children:"Phone"}),e.jsx(m,{id:"donor_phone",value:t.donor_phone,onChange:s=>i({...t,donor_phone:s.target.value}),placeholder:"+251 9XX XXX XXX"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"donor_age",children:"Age"}),e.jsx(m,{id:"donor_age",type:"number",value:t.donor_age,onChange:s=>i({...t,donor_age:s.target.value}),placeholder:"Age"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"gender",children:"Gender"}),e.jsxs(_,{value:t.gender,onValueChange:s=>i({...t,gender:s}),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Select"})}),e.jsx(D,{children:Le.map(s=>e.jsx(c,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"blood_group",children:"Blood Group *"}),e.jsxs(_,{value:t.blood_group,onValueChange:s=>i({...t,blood_group:s}),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Select"})}),e.jsx(D,{children:L.map(s=>e.jsx(c,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"units_donated",children:"Units"}),e.jsx(m,{id:"units_donated",type:"number",value:t.units_donated,onChange:s=>i({...t,units_donated:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"hemoglobin_level",children:"Hemoglobin (g/dL)"}),e.jsx(m,{id:"hemoglobin_level",type:"number",step:"0.1",value:t.hemoglobin_level,onChange:s=>i({...t,hemoglobin_level:s.target.value})})]}),w&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"status",children:"Status"}),e.jsxs(_,{value:t.status,onValueChange:s=>i({...t,status:s}),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Select"})}),e.jsx(D,{children:Ue.map(s=>e.jsx(c,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(r,{htmlFor:"notes",children:"Notes"}),e.jsx($,{id:"notes",value:t.notes,onChange:s=>i({...t,notes:s.target.value}),placeholder:"Additional notes",rows:2})]})]})}),e.jsxs(Y,{children:[e.jsx(x,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsxs(x,{onClick:pe,disabled:F,children:[F&&e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}),w?"Update":"Record"," Donation"]})]})]})}),e.jsx(z,{open:ie,onOpenChange:B,children:e.jsxs(J,{className:"max-w-md",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Blood Request"}),e.jsx(W,{children:"Request blood for a patient"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(_,{value:l.patient_id,onValueChange:s=>g({...l,patient_id:s}),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Select patient"})}),e.jsx(D,{className:"max-h-60",children:te.map(s=>e.jsxs(c,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"blood_group",children:"Blood Group *"}),e.jsxs(_,{value:l.blood_group,onValueChange:s=>g({...l,blood_group:s}),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Select"})}),e.jsx(D,{children:L.map(s=>e.jsx(c,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"units_requested",children:"Units"}),e.jsx(m,{id:"units_requested",type:"number",value:l.units_requested,onChange:s=>g({...l,units_requested:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"priority",children:"Priority"}),e.jsxs(_,{value:l.priority,onValueChange:s=>g({...l,priority:s}),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Select"})}),e.jsxs(D,{children:[e.jsx(c,{value:"Normal",children:"Normal"}),e.jsx(c,{value:"Urgent",children:"Urgent"}),e.jsx(c,{value:"Emergency",children:"Emergency"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"reason",children:"Reason"}),e.jsx($,{id:"reason",value:l.reason,onChange:s=>g({...l,reason:s.target.value}),placeholder:"Reason for blood request",rows:2})]})]}),e.jsxs(Y,{children:[e.jsx(x,{variant:"outline",onClick:()=>B(!1),children:"Cancel"}),e.jsxs(x,{onClick:je,disabled:F,children:[F&&e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}),"Submit Request"]})]})]})}),e.jsx(Ie,{open:de,onOpenChange:E,onConfirm:ge,title:"Delete Donation Record",description:`Are you sure you want to delete the donation record for ${u==null?void 0:u.donor_name}?`,loading:F})]})};export{ls as default};
