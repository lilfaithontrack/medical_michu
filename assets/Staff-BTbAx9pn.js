import{c as O,r as i,d as se,j as e,p as ae}from"./index-C7Usvyjo.js";import{c as te,S as re,A as le,a as ne,B as j,D as ie,e as ce,f as oe,g as D}from"./AdminLayout-KJdpyVPw.js";import{B as g,C as de,d as he}from"./card-D4lL5XKr.js";import{I as o}from"./input-BWiyuCbu.js";import{L as n}from"./label-BR1iVthZ.js";import{S as me}from"./switch-BrbROC7b.js";import{T as ue,a as pe,b as E,c as h,d as xe,e as d}from"./table-4bgxXXk3.js";import{E as fe,S as je,T as ge,D as ye,a as ve,b as we,c as Ne,f as Se,d as Ce,e as _e}from"./DeleteConfirmDialog-DieDgxFE.js";import{S as k,a as F,b as M,c as T,d as L}from"./select-C3KF1_PI.js";import{s as N}from"./staffService-CDhqhHLk.js";import{s as Ae}from"./staffRoleService-BDtT7EUS.js";import{P as be}from"./plus-BMYysXAs.js";import{L as B}from"./loader-circle-CE1kBXf-.js";import{E as De}from"./eye-BhGGlvcf.js";import"./index-DXYLpZ2l.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=O("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=O("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=O("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),Me={Morning:"bg-warning/10 text-warning border-warning/20",Afternoon:"bg-info/10 text-info border-info/20",Night:"bg-purple-500/10 text-purple-500 border-purple-500/20",Rotating:"bg-muted text-muted-foreground border-border"},Te=["Morning","Afternoon","Night","Rotating"],Le=["Active","Inactive","On Leave"],Qe=()=>{const[H,V]=i.useState([]),[S,U]=i.useState([]),[R,I]=i.useState(!0),[y,K]=i.useState(""),[$,u]=i.useState(!1),[z,C]=i.useState(!1),[m,v]=i.useState(null),[p,P]=i.useState(!1),[_,w]=i.useState(!1),{toast:c}=se(),[a,l]=i.useState({name:"",role_id:"",phone:"",email:"",shift:"Morning",status:"Active",join_date:new Date().toISOString().split("T")[0],salary:"",address:"",emergency_contact:"",createAccount:!1,password:""});i.useEffect(()=>{A(),G()},[]);const A=async()=>{var s,t;try{I(!0);const r=await N.getAll({limit:100});V(r.data||[])}catch(r){c({title:"Error",description:((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load staff",variant:"destructive"})}finally{I(!1)}},G=async()=>{try{const s=await Ae.getActiveRoles();U(s)}catch(s){console.error("Failed to load roles:",s)}},X=()=>{l({name:"",role_id:"",phone:"",email:"",shift:"Morning",status:"Active",join_date:new Date().toISOString().split("T")[0],salary:"",address:"",emergency_contact:"",createAccount:!1,password:""}),v(null),P(!1)},J=()=>{const s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%";let t="";for(let r=0;r<10;r++)t+=s.charAt(Math.floor(Math.random()*s.length));l({...a,password:t})},Q=()=>{X(),u(!0)},W=s=>{var t,r;v(s),P(!0),l({name:s.name||"",role_id:s.role_id||"",phone:s.phone||"",email:s.email||"",shift:s.shift||"Morning",status:s.status||"Active",join_date:((t=s.join_date)==null?void 0:t.split("T")[0])||new Date().toISOString().split("T")[0],salary:((r=s.salary)==null?void 0:r.toString())||"",address:s.address||"",emergency_contact:s.emergency_contact||"",createAccount:!1,password:""}),u(!0)},Y=s=>{v(s),C(!0)},Z=async()=>{var s,t,r,x;if(!a.name||!a.role_id||!a.phone||!a.email){c({title:"Error",description:"Please fill all required fields",variant:"destructive"});return}if(a.createAccount&&!a.password){c({title:"Error",description:"Password is required when creating an account",variant:"destructive"});return}if(a.createAccount&&a.password.length<6){c({title:"Error",description:"Password must be at least 6 characters",variant:"destructive"});return}try{if(w(!0),p&&m){const f={name:a.name,role_id:a.role_id,role:((s=S.find(b=>b.id===a.role_id))==null?void 0:s.name)||"",phone:a.phone,email:a.email,shift:a.shift,status:a.status,salary:a.salary?parseFloat(a.salary):null,address:a.address||null,emergency_contact:a.emergency_contact||null};await N.update(m.id,f),c({title:"Success",description:"Staff member updated successfully"})}else if(a.createAccount)await ae.createStaffAccount({email:a.email,password:a.password,name:a.name,role_id:a.role_id,phone:a.phone,shift:a.shift}),c({title:"Success",description:`Staff account created. Login: ${a.email}`});else{const f={name:a.name,role_id:a.role_id,role:((t=S.find(b=>b.id===a.role_id))==null?void 0:t.name)||"",phone:a.phone,email:a.email,shift:a.shift,status:a.status,join_date:a.join_date,salary:a.salary?parseFloat(a.salary):null,address:a.address||null,emergency_contact:a.emergency_contact||null};await N.create(f),c({title:"Success",description:"Staff member added successfully"})}u(!1),X(),A()}catch(f){c({title:"Error",description:((x=(r=f.response)==null?void 0:r.data)==null?void 0:x.message)||"Operation failed",variant:"destructive"})}finally{w(!1)}},ee=async()=>{var s,t;if(m)try{w(!0),await N.delete(m.id),c({title:"Success",description:"Staff member deleted successfully"}),C(!1),v(null),A()}catch(r){c({title:"Error",description:((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete staff member",variant:"destructive"})}finally{w(!1)}},q=H.filter(s=>{var t,r,x;return((t=s.name)==null?void 0:t.toLowerCase().includes(y.toLowerCase()))||((r=s.role)==null?void 0:r.toLowerCase().includes(y.toLowerCase()))||((x=s.staff_id)==null?void 0:x.toLowerCase().includes(y.toLowerCase()))});return e.jsxs(te,{title:"Staff Management",subtitle:"Manage hospital staff and create user accounts",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsx("div",{className:"flex flex-1 gap-3",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search staff...",className:"pl-10",value:y,onChange:s=>K(s.target.value)})]})}),e.jsxs(g,{className:"gap-2",onClick:Q,children:[e.jsx(be,{className:"w-4 h-4"}),"Add Staff"]})]}),e.jsx(de,{children:e.jsx(he,{className:"p-0",children:R?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(ue,{children:[e.jsx(pe,{children:e.jsxs(E,{children:[e.jsx(h,{children:"Staff ID"}),e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Role"}),e.jsx(h,{children:"Contact"}),e.jsx(h,{children:"Shift"}),e.jsx(h,{children:"Account"}),e.jsx(h,{children:"Status"}),e.jsx(h,{className:"text-right",children:"Actions"})]})}),e.jsxs(xe,{children:[q.map(s=>{var t;return e.jsxs(E,{className:"group",children:[e.jsx(d,{className:"font-mono text-sm",children:s.staff_id}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-9 w-9",children:e.jsx(ne,{className:"bg-primary/10 text-primary text-sm",children:(t=s.name)==null?void 0:t.split(" ").map(r=>r[0]).join("").substring(0,2)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})]})}),e.jsx(d,{children:e.jsx(j,{variant:"secondary",children:s.role})}),e.jsx(d,{className:"text-muted-foreground",children:s.phone}),e.jsx(d,{children:e.jsx(j,{variant:"outline",className:Me[s.shift]||"",children:s.shift})}),e.jsx(d,{children:s.user_id?e.jsxs(j,{variant:"outline",className:"border-success text-success",children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),"Active"]}):e.jsx(j,{variant:"outline",className:"border-muted text-muted-foreground",children:"No Account"})}),e.jsx(d,{children:e.jsx(j,{variant:"outline",className:s.status==="Active"?"border-success text-success":"border-muted",children:s.status})}),e.jsx(d,{className:"text-right",children:e.jsxs(ie,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(fe,{className:"w-4 h-4"})})}),e.jsxs(oe,{align:"end",children:[e.jsxs(D,{className:"gap-2",children:[e.jsx(De,{className:"w-4 h-4"})," View"]}),e.jsxs(D,{className:"gap-2",onClick:()=>W(s),children:[e.jsx(je,{className:"w-4 h-4"})," Edit"]}),e.jsxs(D,{className:"gap-2 text-destructive",onClick:()=>Y(s),children:[e.jsx(ge,{className:"w-4 h-4"})," Delete"]})]})]})})]},s.id)}),q.length===0&&!R&&e.jsx(E,{children:e.jsx(d,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No staff found"})})]})]})})}),e.jsx(ye,{open:$,onOpenChange:u,children:e.jsxs(ve,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(we,{children:[e.jsx(Ne,{children:p?"Edit Staff Member":"Add New Staff Member"}),e.jsx(Se,{children:p?"Update staff member information":"Fill in the details to add a new staff member"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Full Name *"}),e.jsx(o,{id:"name",value:a.name,onChange:s=>l({...a,name:s.target.value}),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"role",children:"Role *"}),e.jsxs(k,{value:a.role_id,onValueChange:s=>l({...a,role_id:s}),children:[e.jsx(F,{children:e.jsx(M,{placeholder:"Select role"})}),e.jsx(T,{children:S.map(s=>e.jsx(L,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phone",children:"Phone *"}),e.jsx(o,{id:"phone",value:a.phone,onChange:s=>l({...a,phone:s.target.value}),placeholder:"+251 9XX XXX XXX"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"Email *"}),e.jsx(o,{id:"email",type:"email",value:a.email,onChange:s=>l({...a,email:s.target.value}),placeholder:"email@hospital.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"shift",children:"Shift"}),e.jsxs(k,{value:a.shift,onValueChange:s=>l({...a,shift:s}),children:[e.jsx(F,{children:e.jsx(M,{placeholder:"Select shift"})}),e.jsx(T,{children:Te.map(s=>e.jsx(L,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"status",children:"Status"}),e.jsxs(k,{value:a.status,onValueChange:s=>l({...a,status:s}),children:[e.jsx(F,{children:e.jsx(M,{placeholder:"Select status"})}),e.jsx(T,{children:Le.map(s=>e.jsx(L,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"join_date",children:"Join Date"}),e.jsx(o,{id:"join_date",type:"date",value:a.join_date,onChange:s=>l({...a,join_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"salary",children:"Salary (ETB)"}),e.jsx(o,{id:"salary",type:"number",value:a.salary,onChange:s=>l({...a,salary:s.target.value}),placeholder:"Monthly salary"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(n,{htmlFor:"address",children:"Address"}),e.jsx(o,{id:"address",value:a.address,onChange:s=>l({...a,address:s.target.value}),placeholder:"Home address"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(n,{htmlFor:"emergency_contact",children:"Emergency Contact"}),e.jsx(o,{id:"emergency_contact",value:a.emergency_contact,onChange:s=>l({...a,emergency_contact:s.target.value}),placeholder:"Emergency contact name and phone"})]}),!p&&e.jsxs("div",{className:"col-span-2 border rounded-lg p-4 bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-base font-medium",children:"Create Login Account"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow this staff member to log into the system"})]}),e.jsx(me,{checked:a.createAccount,onCheckedChange:s=>l({...a,createAccount:s})})]}),a.createAccount&&e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Username"}),e.jsx(o,{value:a.email,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email will be used as username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"password",children:"Password *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"password",type:"text",value:a.password,onChange:s=>l({...a,password:s.target.value}),placeholder:"Enter password (min 6 characters)",className:"flex-1"}),e.jsxs(g,{type:"button",variant:"outline",onClick:J,children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Generate"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Ee,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm",children:"Save the password and share it with the staff member securely."})]})]})]})]}),e.jsxs(Ce,{children:[e.jsx(g,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(g,{onClick:Z,disabled:_,children:[_&&e.jsx(B,{className:"w-4 h-4 mr-2 animate-spin"}),p?"Update":a.createAccount?"Create with Account":"Add"," Staff"]})]})]})}),e.jsx(_e,{open:z,onOpenChange:C,onConfirm:ee,title:"Delete Staff Member",description:`Are you sure you want to delete ${m==null?void 0:m.name}? This action cannot be undone.`,loading:_})]})};export{Qe as default};
