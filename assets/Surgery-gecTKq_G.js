import{c as J,r as c,d as pe,j as e}from"./index-MFUeX4KC.js";import{c as xe,B as P,S as ge,d as je,D as _e,e as fe,f as ye,o as ve,g as E,T as Ne,C as Se}from"./AdminLayout-CEyGcOXW.js";import{C as f,d as y,B as v,a as we,b as Ce,c as be}from"./card--ujVzSXa.js";import{I as d}from"./Combination-CVDpaV-S.js";import{L as l}from"./label-Cw8AwbsX.js";import{T as K}from"./textarea-BWkPO5tB.js";import{T as ke,a as De,b as F,c as L}from"./tabs-BKpu8yr4.js";import{C as A}from"./checkbox-D5sbX6eA.js";import{T as Te,a as Ie,b as M,c as m,d as Oe,e as o}from"./table-tgADzikB.js";import{D as Pe,a as Ee,b as Fe,c as Le,e as Ae,d as Me}from"./dialog-C_l7gpm1.js";import{S as N,a as S,b as w,c as C,d as b}from"./select-CM0PFwtY.js";import{s as x}from"./facilityService-4zu1snfu.js";import{p as Re}from"./patientService-CtAKoHA_.js";import{d as Ue}from"./doctorService-Cf-rqgNH.js";import{E as Be,D as Ve}from"./DeleteConfirmDialog-Tv4EgB03.js";import{P as He}from"./plus-DrrZjkgX.js";import{L as W}from"./loader-circle-DYBsGSuP.js";import{E as qe}from"./eye-CxZXf5Ga.js";import{S as $e}from"./square-pen-QpnerZQe.js";import"./index-lz0iHb9C.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=J("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=J("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),Ge={Scheduled:"bg-info/10 text-info border-info/20","In Progress":"bg-warning/10 text-warning border-warning/20",Completed:"bg-success/10 text-success border-success/20",Cancelled:"bg-muted text-muted-foreground border-border",Postponed:"bg-destructive/10 text-destructive border-destructive/20"},Ke=["Scheduled","In Progress","Completed","Cancelled","Postponed"],We=["General","Orthopedic","Cardiac","Neurological","Gynecological","Urological","Ophthalmic","ENT","Plastic","Emergency"],xs=()=>{var $,z,G;const[Q,X]=c.useState([]),[U,Y]=c.useState([]),[Z,ee]=c.useState([]),[se,te]=c.useState([]),[k,B]=c.useState(!0),[D,ae]=c.useState(""),[ie,p]=c.useState(!1),[re,T]=c.useState(!1),[h,g]=c.useState(null),[j,V]=c.useState(!1),[I,_]=c.useState(!1),{toast:u}=pe(),[t,a]=c.useState({patient_id:"",surgeon_id:"",surgery_type:"",scheduled_date:new Date().toISOString().split("T")[0],scheduled_time:"09:00",estimated_duration:"60",pre_op_diagnosis:"",status:"Scheduled",notes:"",who_checklist:{sign_in:!1,time_out:!1,sign_out:!1},anesthesia_start_time:"",incision_time:"",closure_time:"",anesthesia_end_time:"",aldrete_score:"",implants_used:""});c.useEffect(()=>{O(),le()},[]);const O=async()=>{var s,i;try{B(!0);const[r,n]=await Promise.all([x.getAll({limit:100}),x.getOperatingRooms().catch(()=>[])]);X(r.data||[]),Y(n||[])}catch(r){u({title:"Error",description:((i=(s=r.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to load surgery data",variant:"destructive"})}finally{B(!1)}},le=async()=>{try{const[s,i]=await Promise.all([Re.getAll({limit:200}),Ue.getAll({limit:100})]);ee(s.data||[]),te(i.data||[])}catch(s){console.error("Failed to load lookups:",s)}},H=()=>{a({patient_id:"",surgeon_id:"",surgery_type:"",scheduled_date:new Date().toISOString().split("T")[0],scheduled_time:"09:00",estimated_duration:"60",pre_op_diagnosis:"",status:"Scheduled",notes:"",who_checklist:{sign_in:!1,time_out:!1,sign_out:!1},anesthesia_start_time:"",incision_time:"",closure_time:"",anesthesia_end_time:"",aldrete_score:"",implants_used:""}),g(null),V(!1)},ne=()=>{H(),p(!0)},ce=s=>{var i,r,n;g(s),V(!0),a({patient_id:s.patient_id||"",surgeon_id:s.surgeon_id||"",surgery_type:s.surgery_type||"",scheduled_date:((i=s.scheduled_date)==null?void 0:i.split("T")[0])||new Date().toISOString().split("T")[0],scheduled_time:s.scheduled_time||"09:00",estimated_duration:((r=s.estimated_duration)==null?void 0:r.toString())||"60",pre_op_diagnosis:s.pre_op_diagnosis||"",status:s.status||"Scheduled",notes:s.notes||"",who_checklist:s.who_checklist_completed||{sign_in:!1,time_out:!1,sign_out:!1},anesthesia_start_time:s.anesthesia_start_time||"",incision_time:s.incision_time||"",closure_time:s.closure_time||"",anesthesia_end_time:s.anesthesia_end_time||"",aldrete_score:((n=s.aldrete_score)==null?void 0:n.toString())||"",implants_used:Array.isArray(s.implants_used)?s.implants_used.join(", "):s.implants_used||""}),p(!0)},de=s=>{g(s),T(!0)},oe=async()=>{var s,i;if(!t.patient_id||!t.surgeon_id||!t.surgery_type){u({title:"Error",description:"Please fill all required fields",variant:"destructive"});return}try{_(!0);const r={...t,estimated_duration:parseInt(t.estimated_duration),aldrete_score:t.aldrete_score?parseInt(t.aldrete_score):null,implants_used:t.implants_used.split(",").map(n=>n.trim()).filter(n=>n),who_checklist_completed:t.who_checklist};j&&h?(await x.update(h.id,r),u({title:"Success",description:"Surgery updated successfully"})):(await x.create(r),u({title:"Success",description:"Surgery scheduled successfully"})),p(!1),H(),O()}catch(r){u({title:"Error",description:((i=(s=r.response)==null?void 0:s.data)==null?void 0:i.message)||"Operation failed",variant:"destructive"})}finally{_(!1)}},me=async()=>{var s,i;if(h)try{_(!0),await x.delete(h.id),u({title:"Success",description:"Surgery cancelled successfully"}),T(!1),g(null),O()}catch(r){u({title:"Error",description:((i=(s=r.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to delete surgery",variant:"destructive"})}finally{_(!1)}},q=Q.filter(s=>{var i,r;return((i=s.patient_name)==null?void 0:i.toLowerCase().includes(D.toLowerCase()))||((r=s.surgery_type)==null?void 0:r.toLowerCase().includes(D.toLowerCase()))}),he=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A",ue=s=>{if(!s)return"";const[i,r]=s.split(":"),n=parseInt(i);return`${n>12?n-12:n}:${r} ${n>=12?"PM":"AM"}`};return e.jsxs(xe,{title:"Surgery Department",subtitle:"Manage surgery schedules and operating rooms",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[U.map(s=>e.jsx(f,{className:s.status==="In Use"?"border-warning":"border-success",children:e.jsxs(y,{className:"pt-4 text-center",children:[e.jsx(R,{className:`w-8 h-8 mx-auto mb-2 ${s.status==="In Use"?"text-warning":"text-success"}`}),e.jsx("p",{className:"font-medium",children:s.room_number}),e.jsx(P,{variant:s.status==="Available"?"default":"secondary",children:s.status})]})},s.id)),U.length===0&&!k&&e.jsx(f,{className:"col-span-5",children:e.jsx(y,{className:"pt-4 text-center text-muted-foreground",children:"No operating rooms data available"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Search surgeries...",className:"pl-10",value:D,onChange:s=>ae(s.target.value)})]}),e.jsxs(v,{className:"gap-2",onClick:ne,children:[e.jsx(He,{className:"w-4 h-4"}),"Schedule Surgery"]})]}),e.jsx(f,{children:e.jsx(y,{className:"p-0",children:k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(W,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(Te,{children:[e.jsx(Ie,{className:"bg-muted/50",children:e.jsxs(M,{children:[e.jsx(m,{className:"w-[100px]",children:"ID"}),e.jsx(m,{children:"Patient"}),e.jsx(m,{children:"Type"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Surgeon"}),e.jsx(m,{children:"Schedule"}),e.jsx(m,{children:"Room"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsxs(Oe,{children:[q.map(s=>e.jsxs(M,{className:"group hover:bg-muted/20",children:[e.jsx(o,{className:"font-mono text-xs text-muted-foreground",children:s.surgery_id}),e.jsx(o,{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsx(o,{children:s.surgery_type}),e.jsx(o,{children:e.jsx(P,{variant:"outline",className:Ge[s.status]||"",children:s.status})}),e.jsx(o,{className:"text-sm",children:s.surgeon_name||"TBD"}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(je,{className:"w-3 h-3"}),he(s.scheduled_date)," ",ue(s.scheduled_time)]})}),e.jsx(o,{children:e.jsx(P,{variant:"secondary",children:s.operating_room||"TBD"})}),e.jsx(o,{className:"text-right",children:e.jsxs(_e,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(Be,{className:"w-4 h-4"})})}),e.jsxs(ye,{align:"end",children:[e.jsx(ve,{children:"Actions"}),e.jsxs(E,{className:"gap-2 cursor-pointer",children:[e.jsx(qe,{className:"w-4 h-4"})," View Details"]}),e.jsxs(E,{className:"gap-2 cursor-pointer",onClick:()=>ce(s),children:[e.jsx($e,{className:"w-4 h-4"})," Edit / Update"]}),e.jsxs(E,{className:"gap-2 text-destructive cursor-pointer",onClick:()=>de(s),children:[e.jsx(Ne,{className:"w-4 h-4"})," Cancel Schedule"]})]})]})})]},s.id)),q.length===0&&!k&&e.jsx(M,{children:e.jsx(o,{colSpan:8,className:"text-center py-12 text-muted-foreground",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(R,{className:"w-10 h-10 opacity-20"}),e.jsx("p",{children:"No surgeries found."})]})})})]})]})})}),e.jsx(Pe,{open:ie,onOpenChange:p,children:e.jsxs(Ee,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Fe,{children:[e.jsxs(Le,{children:[e.jsx(R,{className:"w-5 h-5 inline-block mr-2"}),j?"Update Surgery":"Schedule New Surgery"]}),e.jsx(Ae,{children:j?"Update surgery details, checklist, and recovery status":"Schedule a new surgical procedure"})]}),e.jsxs(ke,{defaultValue:"schedule",className:"w-full",children:[e.jsxs(De,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsx(F,{value:"schedule",children:"Schedule Info"}),e.jsx(F,{value:"safety",children:"Safety Checklist"}),e.jsx(F,{value:"process",children:"Intra-Op & Recovery"})]}),e.jsx(L,{value:"schedule",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(N,{value:t.patient_id,onValueChange:s=>a({...t,patient_id:s}),children:[e.jsx(S,{children:e.jsx(w,{placeholder:"Select patient"})}),e.jsx(C,{className:"max-h-60",children:Z.map(s=>e.jsxs(b,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"surgeon_id",children:"Lead Surgeon *"}),e.jsxs(N,{value:t.surgeon_id,onValueChange:s=>a({...t,surgeon_id:s}),children:[e.jsx(S,{children:e.jsx(w,{placeholder:"Select surgeon"})}),e.jsx(C,{className:"max-h-60",children:se.map(s=>e.jsxs(b,{value:s.id,children:["Dr. ",s.name," (",s.specialization,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"surgery_type",children:"Procedure Type *"}),e.jsxs(N,{value:t.surgery_type,onValueChange:s=>a({...t,surgery_type:s}),children:[e.jsx(S,{children:e.jsx(w,{placeholder:"Select type"})}),e.jsx(C,{children:We.map(s=>e.jsx(b,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"scheduled_date",children:"Date"}),e.jsx(d,{id:"scheduled_date",type:"date",value:t.scheduled_date,onChange:s=>a({...t,scheduled_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"scheduled_time",children:"Time"}),e.jsx(d,{id:"scheduled_time",type:"time",value:t.scheduled_time,onChange:s=>a({...t,scheduled_time:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"estimated_duration",children:"Est. Duration (min)"}),e.jsx(d,{id:"estimated_duration",type:"number",value:t.estimated_duration,onChange:s=>a({...t,estimated_duration:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"status",children:"Status"}),e.jsxs(N,{value:t.status,onValueChange:s=>a({...t,status:s}),children:[e.jsx(S,{children:e.jsx(w,{placeholder:"Select status"})}),e.jsx(C,{children:Ke.map(s=>e.jsx(b,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(l,{htmlFor:"pre_op_diagnosis",children:"Pre-Op Diagnosis"}),e.jsx(K,{id:"pre_op_diagnosis",value:t.pre_op_diagnosis,onChange:s=>a({...t,pre_op_diagnosis:s.target.value}),placeholder:"Pre-operative diagnosis...",rows:2})]})]})}),e.jsx(L,{value:"safety",className:"space-y-6",children:e.jsxs(f,{className:"border-blue-200 bg-blue-50/50",children:[e.jsxs(we,{className:"pb-3",children:[e.jsxs(Ce,{className:"text-base flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"})," WHO Surgical Safety Checklist"]}),e.jsx(be,{children:"Confirm safety checks at each stage."})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-white rounded-md border",children:[e.jsx(A,{id:"sign_in",checked:($=t.who_checklist)==null?void 0:$.sign_in,onCheckedChange:s=>a({...t,who_checklist:{...t.who_checklist,sign_in:s}})}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(l,{htmlFor:"sign_in",className:"text-sm font-semibold cursor-pointer",children:"Sign In (Before Induction)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Patient identity, site, procedure confirmed. Consent verified."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-white rounded-md border",children:[e.jsx(A,{id:"time_out",checked:(z=t.who_checklist)==null?void 0:z.time_out,onCheckedChange:s=>a({...t,who_checklist:{...t.who_checklist,time_out:s}})}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(l,{htmlFor:"time_out",className:"text-sm font-semibold cursor-pointer",children:"Time Out (Before Incision)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Team introduced. Critical steps reviewed. Antibiotics prophylaxis confirmed."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-white rounded-md border",children:[e.jsx(A,{id:"sign_out",checked:(G=t.who_checklist)==null?void 0:G.sign_out,onCheckedChange:s=>a({...t,who_checklist:{...t.who_checklist,sign_out:s}})}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(l,{htmlFor:"sign_out",className:"text-sm font-semibold cursor-pointer",children:"Sign Out (Before Leaving OR)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Instrument/sponge counts correct. Specimens labeled. Key recovery concerns reviewed."})]})]})]})]})}),e.jsx(L,{value:"process",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2 space-y-4",children:[e.jsxs(l,{className:"flex items-center gap-2 font-semibold",children:[e.jsx(Se,{className:"w-4 h-4"})," Procedure Timings"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"text-xs",children:"Anesthesia Start"}),e.jsx(d,{type:"time",value:t.anesthesia_start_time,onChange:s=>a({...t,anesthesia_start_time:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"text-xs",children:"Incision"}),e.jsx(d,{type:"time",value:t.incision_time,onChange:s=>a({...t,incision_time:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"text-xs",children:"Closure"}),e.jsx(d,{type:"time",value:t.closure_time,onChange:s=>a({...t,closure_time:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"text-xs",children:"Anesthesia End"}),e.jsx(d,{type:"time",value:t.anesthesia_end_time,onChange:s=>a({...t,anesthesia_end_time:s.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"implants",children:"Implants/Prosthetics Used"}),e.jsx(K,{id:"implants",value:t.implants_used,onChange:s=>a({...t,implants_used:s.target.value}),placeholder:"E.g., Mesh (10x15cm), Screws (3.5mm)... (comma separated)",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"aldrete",children:"Aldrete Recovery Score (0-10)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(d,{id:"aldrete",type:"number",max:10,min:0,value:t.aldrete_score,onChange:s=>a({...t,aldrete_score:s.target.value}),placeholder:"Total Score",className:"w-32"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"â‰¥ 9 required for discharge from PACU."})]})]})]})})]}),e.jsxs(Me,{children:[e.jsx(v,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(v,{onClick:oe,disabled:I,children:[I&&e.jsx(W,{className:"w-4 h-4 mr-2 animate-spin"}),j?"Update":"Schedule"," Surgery"]})]})]})}),e.jsx(Ve,{open:re,onOpenChange:T,onConfirm:me,title:"Cancel Surgery",description:`Are you sure you want to cancel the surgery for ${h==null?void 0:h.patient_name}?`,loading:I})]})};export{xs as default};
