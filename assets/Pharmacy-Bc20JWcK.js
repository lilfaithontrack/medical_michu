import{r as i,d as W,j as e}from"./index-DIh5wxCw.js";import{b as X,T as Y,S as Z,P as A,D as ee,d as ae,e as se,f as k}from"./AdminLayout-CVdM3u-8.js";import{C as O,a as te,b as re,d as B,B as g}from"./card-BVj2mpCd.js";import{I as c}from"./index-CXyJ5PVz.js";import{L as l}from"./label-BOSjw2jr.js";import{T as ne}from"./textarea-DqMGnoNS.js";import{B as N}from"./badge-DwC97fZb.js";import{T as ie,a as le,b,c as p,d as ce,e as o}from"./table-Da73gdk8.js";import{T as oe,D as de,a as me,b as he,c as pe,e as ue,d as xe}from"./dialog-CmLsLM44.js";import{S as ge,a as je,b as fe,c as _e,d as ye}from"./select-DxzT1k0b.js";import{p as j}from"./pharmacyService-B-LFXMhh.js";import{E as ve,S as Ne,D as we}from"./DeleteConfirmDialog-nQwB51sc.js";import{F as Se}from"./filter-DgvuW_0V.js";import{P as Ce}from"./plus-BlBB68lF.js";import{L as M}from"./loader-circle-u1M5w34w.js";import"./Combination-B3qkWEI7.js";import"./index-lGeLsNXG.js";const ke=["Tablet","Capsule","Syrup","Injection","Cream","Ointment","Drops","Inhaler","Suppository","Powder"],Ve=()=>{const[R,H]=i.useState([]),[u,U]=i.useState([]),[D,T]=i.useState(!0),[f,G]=i.useState(""),[V,x]=i.useState(!1),[z,w]=i.useState(!1),[d,_]=i.useState(null),[y,F]=i.useState(!1),[S,v]=i.useState(!1),{toast:m}=W(),[s,n]=i.useState({name:"",generic_name:"",dosage_form:"",strength:"",manufacturer:"",stock_quantity:"",min_stock_level:"50",unit_price:"",selling_price:"",expiry_date:"",description:""});i.useEffect(()=>{C()},[]);const C=async()=>{var a,r;try{T(!0);const[t,h]=await Promise.all([j.getAll({limit:100}),j.getLowStock().catch(()=>[])]);H(t.data||[]),U(h||[])}catch(t){m({title:"Error",description:((r=(a=t.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to load pharmacy data",variant:"destructive"})}finally{T(!1)}},I=()=>{n({name:"",generic_name:"",dosage_form:"",strength:"",manufacturer:"",stock_quantity:"",min_stock_level:"50",unit_price:"",selling_price:"",expiry_date:"",description:""}),_(null),F(!1)},Q=()=>{I(),x(!0)},E=a=>{var r,t,h,q,P;_(a),F(!0),n({name:a.name||"",generic_name:a.generic_name||"",dosage_form:a.dosage_form||"",strength:a.strength||"",manufacturer:a.manufacturer||"",stock_quantity:((r=a.stock_quantity)==null?void 0:r.toString())||"",min_stock_level:((t=a.min_stock_level)==null?void 0:t.toString())||"50",unit_price:((h=a.unit_price)==null?void 0:h.toString())||"",selling_price:((q=a.selling_price)==null?void 0:q.toString())||"",expiry_date:((P=a.expiry_date)==null?void 0:P.split("T")[0])||"",description:a.description||""}),x(!0)},$=a=>{_(a),w(!0)},J=async()=>{var a,r;if(!s.name||!s.dosage_form||!s.selling_price){m({title:"Error",description:"Please fill name, dosage form, and price",variant:"destructive"});return}try{v(!0);const t={...s,stock_quantity:s.stock_quantity?parseInt(s.stock_quantity):0,min_stock_level:parseInt(s.min_stock_level),unit_price:s.unit_price?parseFloat(s.unit_price):null,selling_price:parseFloat(s.selling_price)};y&&d?(await j.update(d.id,t),m({title:"Success",description:"Item updated successfully"})):(await j.create(t),m({title:"Success",description:"Item added successfully"})),x(!1),I(),C()}catch(t){m({title:"Error",description:((r=(a=t.response)==null?void 0:a.data)==null?void 0:r.message)||"Operation failed",variant:"destructive"})}finally{v(!1)}},K=async()=>{var a,r;if(d)try{v(!0),await j.delete(d.id),m({title:"Success",description:"Item deleted successfully"}),w(!1),_(null),C()}catch(t){m({title:"Error",description:((r=(a=t.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to delete item",variant:"destructive"})}finally{v(!1)}},L=R.filter(a=>{var r,t,h;return((r=a.name)==null?void 0:r.toLowerCase().includes(f.toLowerCase()))||((t=a.item_code)==null?void 0:t.toLowerCase().includes(f.toLowerCase()))||((h=a.generic_name)==null?void 0:h.toLowerCase().includes(f.toLowerCase()))});return e.jsxs(X,{title:"Pharmacy",subtitle:"Manage pharmacy inventory and medications",children:[u.length>0&&e.jsxs(O,{className:"mb-6 border-warning/50 bg-warning/5",children:[e.jsx(te,{className:"pb-2",children:e.jsxs(re,{className:"text-sm font-medium text-warning flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Low Stock Alert (",u.length," items)"]})}),e.jsx(B,{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[u.slice(0,5).map(a=>e.jsxs(N,{variant:"outline",className:"border-warning/50 text-warning",children:[a.name," (",a.stock_quantity," left)"]},a.id)),u.length>5&&e.jsxs(N,{variant:"secondary",children:["+",u.length-5," more"]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Search medications...",className:"pl-10",value:f,onChange:a=>G(a.target.value)})]}),e.jsx(g,{variant:"outline",size:"icon",children:e.jsx(Se,{className:"w-4 h-4"})})]}),e.jsxs(g,{className:"gap-2",onClick:Q,children:[e.jsx(Ce,{className:"w-4 h-4"}),"Add Item"]})]}),e.jsx(O,{children:e.jsx(B,{className:"p-0",children:D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(b,{children:[e.jsx(p,{children:"Code"}),e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Generic Name"}),e.jsx(p,{children:"Form"}),e.jsx(p,{children:"Stock"}),e.jsx(p,{children:"Price"}),e.jsx(p,{className:"text-right",children:"Actions"})]})}),e.jsxs(ce,{children:[L.map(a=>e.jsxs(b,{className:"group",children:[e.jsx(o,{className:"font-mono text-sm",children:a.item_code}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:a.name})]})}),e.jsx(o,{className:"text-muted-foreground",children:a.generic_name||"N/A"}),e.jsx(o,{children:e.jsx(N,{variant:"secondary",children:a.dosage_form||"Tablet"})}),e.jsx(o,{children:e.jsx(N,{variant:"outline",className:a.stock_quantity<=(a.min_stock_level||50)?"border-warning text-warning":"border-success text-success",children:a.stock_quantity})}),e.jsxs(o,{children:["ETB ",a.selling_price]}),e.jsx(o,{className:"text-right",children:e.jsxs(ee,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(ve,{className:"w-4 h-4"})})}),e.jsxs(se,{align:"end",children:[e.jsxs(k,{className:"gap-2",onClick:()=>E(a),children:[e.jsx(Ne,{className:"w-4 h-4"})," Edit"]}),e.jsxs(k,{className:"gap-2",onClick:()=>E(a),children:[e.jsx(A,{className:"w-4 h-4"})," Update Stock"]}),e.jsxs(k,{className:"gap-2 text-destructive",onClick:()=>$(a),children:[e.jsx(oe,{className:"w-4 h-4"})," Delete"]})]})]})})]},a.id)),L.length===0&&!D&&e.jsx(b,{children:e.jsx(o,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No items found"})})]})]})})}),e.jsx(de,{open:V,onOpenChange:x,children:e.jsxs(me,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(he,{children:[e.jsx(pe,{children:y?"Edit Pharmacy Item":"Add New Item"}),e.jsx(ue,{children:y?"Update item information and stock":"Add a new medication to inventory"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Item Name *"}),e.jsx(c,{id:"name",value:s.name,onChange:a=>n({...s,name:a.target.value}),placeholder:"Brand name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"generic_name",children:"Generic Name"}),e.jsx(c,{id:"generic_name",value:s.generic_name,onChange:a=>n({...s,generic_name:a.target.value}),placeholder:"Generic name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"dosage_form",children:"Dosage Form *"}),e.jsxs(ge,{value:s.dosage_form,onValueChange:a=>n({...s,dosage_form:a}),children:[e.jsx(je,{children:e.jsx(fe,{placeholder:"Select form"})}),e.jsx(_e,{children:ke.map(a=>e.jsx(ye,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"strength",children:"Strength"}),e.jsx(c,{id:"strength",value:s.strength,onChange:a=>n({...s,strength:a.target.value}),placeholder:"e.g., 500mg, 10ml"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"manufacturer",children:"Manufacturer"}),e.jsx(c,{id:"manufacturer",value:s.manufacturer,onChange:a=>n({...s,manufacturer:a.target.value}),placeholder:"Manufacturer name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"expiry_date",children:"Expiry Date"}),e.jsx(c,{id:"expiry_date",type:"date",value:s.expiry_date,onChange:a=>n({...s,expiry_date:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"stock_quantity",children:"Stock Quantity"}),e.jsx(c,{id:"stock_quantity",type:"number",value:s.stock_quantity,onChange:a=>n({...s,stock_quantity:a.target.value}),placeholder:"Current stock"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"min_stock_level",children:"Min Stock Level"}),e.jsx(c,{id:"min_stock_level",type:"number",value:s.min_stock_level,onChange:a=>n({...s,min_stock_level:a.target.value}),placeholder:"Reorder level"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"unit_price",children:"Unit Price (ETB)"}),e.jsx(c,{id:"unit_price",type:"number",step:"0.01",value:s.unit_price,onChange:a=>n({...s,unit_price:a.target.value}),placeholder:"Cost price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"selling_price",children:"Selling Price (ETB) *"}),e.jsx(c,{id:"selling_price",type:"number",step:"0.01",value:s.selling_price,onChange:a=>n({...s,selling_price:a.target.value}),placeholder:"Retail price"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(l,{htmlFor:"description",children:"Description"}),e.jsx(ne,{id:"description",value:s.description,onChange:a=>n({...s,description:a.target.value}),placeholder:"Additional information",rows:2})]})]}),e.jsxs(xe,{children:[e.jsx(g,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(g,{onClick:J,disabled:S,children:[S&&e.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}),y?"Update":"Add"," Item"]})]})]})}),e.jsx(we,{open:z,onOpenChange:w,onConfirm:K,title:"Delete Pharmacy Item",description:`Are you sure you want to delete ${d==null?void 0:d.name}? This action cannot be undone.`,loading:S})]})};export{Ve as default};
