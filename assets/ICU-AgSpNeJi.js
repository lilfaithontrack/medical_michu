import{c as ge,r as n,d as _e,j as e}from"./index-BM0IHp2M.js";import{c as fe,i as ve,b as ye,S as Ne,B as j,D as be,e as Ce,f as Se,o as we,g as L,p as De,T as Ie,q as Ae}from"./AdminLayout-CWUWmsnS.js";import{C as d,d as x,B as I,a as P,b as O}from"./card-DeprxXCB.js";import{A as Te,I as c}from"./Combination-DWTH6IhY.js";import{L as r}from"./label-PzrI3jAD.js";import{T as W}from"./textarea-DWoGW9ma.js";import{S as ke}from"./switch-Cai_3vKN.js";import{T as Fe,a as Le,b as U,c as E}from"./tabs-DApUIZ-m.js";import{T as Pe,a as Oe,b as B,c as m,d as Ue,e as o}from"./table-BzDp6Nnk.js";import{D as Ee,a as Be,b as Ve,c as Re,e as He,d as Me}from"./dialog-DCRhT7_F.js";import{S as g,a as _,b as f,c as v,d as y}from"./select-OA5PXWO7.js";import{i as N}from"./facilityService-B7BLElXw.js";import{p as qe}from"./patientService-DFGR6BTX.js";import{d as ze}from"./doctorService-jnKXpXU3.js";import{E as Ye,D as Ze}from"./DeleteConfirmDialog-Dqug50Ir.js";import{H as V}from"./heart-DD8J4J6P.js";import{P as $e}from"./plus-BoDGEuOf.js";import{L as X}from"./loader-circle-aBlEtCJL.js";import{E as Ge}from"./eye-Dp2HsTK1.js";import{S as Je}from"./square-pen-D0IrTuyB.js";import"./index-yV4U6faZ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ge("Thermometer",[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]]),Qe=["Critical","Serious","Stable","Improving"],We=["Active","Transferred","Discharged","Deceased"],vs=()=>{const[b,ee]=n.useState([]),[se,ae]=n.useState([]),[te,ie]=n.useState([]),[le,re]=n.useState([]),[R,H]=n.useState(!0),[A,ne]=n.useState(""),[ce,p]=n.useState(!1),[oe,T]=n.useState(!1),[h,C]=n.useState(null),[S,M]=n.useState(!1),[k,w]=n.useState(!1),{toast:u}=_e(),[a,t]=n.useState({patient_id:"",doctor_id:"",admission_date:new Date().toISOString().split("T")[0],diagnosis:"",condition:"Critical",ventilator_support:!1,status:"Active",notes:"",apache_ii_score:"",sofa_score:"",rass_score:"",central_line_days:"0",arterial_line_days:"0",foley_catheter_days:"0",daily_intake:"",daily_output:"",fluid_balance:""});n.useEffect(()=>{F(),de()},[]);const F=async()=>{var s,i;try{H(!0);const[l,D]=await Promise.all([N.getAll({limit:100}),N.getBeds().catch(()=>[])]);ee(l.data||[]),ae(D||[])}catch(l){u({title:"Error",description:((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to load ICU data",variant:"destructive"})}finally{H(!1)}},de=async()=>{try{const[s,i]=await Promise.all([qe.getAll({limit:200}),ze.getAll({limit:100})]);ie(s.data||[]),re(i.data||[])}catch(s){console.error("Failed to load lookups:",s)}},q=()=>{t({patient_id:"",doctor_id:"",admission_date:new Date().toISOString().split("T")[0],diagnosis:"",condition:"Critical",ventilator_support:!1,status:"Active",notes:"",apache_ii_score:"",sofa_score:"",rass_score:"",central_line_days:"0",arterial_line_days:"0",foley_catheter_days:"0",daily_intake:"",daily_output:"",fluid_balance:""}),C(null),M(!1)},xe=()=>{q(),p(!0)},me=s=>{var i,l,D,Y,Z,$,G,J,K,Q;C(s),M(!0),t({patient_id:s.patient_id||"",doctor_id:s.doctor_id||"",admission_date:((i=s.admission_date)==null?void 0:i.split("T")[0])||new Date().toISOString().split("T")[0],diagnosis:s.diagnosis||"",condition:s.condition||"Critical",ventilator_support:s.ventilator_support||!1,status:s.status||"Active",notes:s.notes||"",apache_ii_score:((l=s.apache_ii_score)==null?void 0:l.toString())||"",sofa_score:((D=s.sofa_score)==null?void 0:D.toString())||"",rass_score:((Y=s.rass_score)==null?void 0:Y.toString())||"",central_line_days:((Z=s.central_line_days)==null?void 0:Z.toString())||"0",arterial_line_days:(($=s.arterial_line_days)==null?void 0:$.toString())||"0",foley_catheter_days:((G=s.foley_catheter_days)==null?void 0:G.toString())||"0",daily_intake:((J=s.daily_intake)==null?void 0:J.toString())||"",daily_output:((K=s.daily_output)==null?void 0:K.toString())||"",fluid_balance:((Q=s.fluid_balance)==null?void 0:Q.toString())||""}),p(!0)},he=s=>{C(s),T(!0)},ue=async()=>{var s,i;if(!a.patient_id||!a.doctor_id){u({title:"Error",description:"Please select patient and doctor",variant:"destructive"});return}try{w(!0);const l={...a,apache_ii_score:a.apache_ii_score?parseInt(a.apache_ii_score):null,sofa_score:a.sofa_score?parseInt(a.sofa_score):null,rass_score:a.rass_score?parseInt(a.rass_score):null,central_line_days:parseInt(a.central_line_days)||0,arterial_line_days:parseInt(a.arterial_line_days)||0,foley_catheter_days:parseInt(a.foley_catheter_days)||0,daily_intake:a.daily_intake?parseFloat(a.daily_intake):null,daily_output:a.daily_output?parseFloat(a.daily_output):null,fluid_balance:a.fluid_balance?parseFloat(a.fluid_balance):null};S&&h?(await N.update(h.id,l),u({title:"Success",description:"ICU patient updated successfully"})):(await N.create(l),u({title:"Success",description:"Patient admitted to ICU successfully"})),p(!1),q(),F()}catch(l){u({title:"Error",description:((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||"Operation failed",variant:"destructive"})}finally{w(!1)}},pe=async()=>{var s,i;if(h)try{w(!0),await N.delete(h.id),u({title:"Success",description:"ICU record deleted successfully"}),T(!1),C(null),F()}catch(l){u({title:"Error",description:((i=(s=l.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to delete record",variant:"destructive"})}finally{w(!1)}},z=b.filter(s=>{var i,l;return((i=s.patient_name)==null?void 0:i.toLowerCase().includes(A.toLowerCase()))||((l=s.bed_number)==null?void 0:l.toLowerCase().includes(A.toLowerCase()))}),je=se.filter(s=>s.status==="Available").length;return e.jsxs(fe,{title:"ICU",subtitle:"Intensive Care Unit Monitoring",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(d,{className:"border-destructive/50",children:e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ICU Patients"}),e.jsx("p",{className:"text-3xl font-bold text-destructive",children:b.length})]}),e.jsx(ve,{className:"w-8 h-8 text-destructive"})]})})}),e.jsx(d,{children:e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Critical"}),e.jsx("p",{className:"text-3xl font-bold text-warning",children:b.filter(s=>s.condition==="Critical").length})]}),e.jsx(V,{className:"w-8 h-8 text-warning"})]})})}),e.jsx(d,{children:e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"On Ventilator"}),e.jsx("p",{className:"text-3xl font-bold",children:b.filter(s=>s.ventilator_support).length})]}),e.jsx(Te,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(d,{children:e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Available Beds"}),e.jsx("p",{className:"text-3xl font-bold text-success",children:je})]}),e.jsx(ye,{className:"w-8 h-8 text-success"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Search ICU patients...",className:"pl-10",value:A,onChange:s=>ne(s.target.value)})]}),e.jsxs(I,{className:"gap-2",onClick:xe,children:[e.jsx($e,{className:"w-4 h-4"}),"Admit to ICU"]})]}),e.jsx(d,{children:e.jsx(x,{className:"p-0",children:R?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(X,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(Pe,{children:[e.jsx(Oe,{className:"bg-muted/50",children:e.jsxs(B,{children:[e.jsx(m,{className:"w-[80px]",children:"Bed"}),e.jsx(m,{children:"Patient"}),e.jsx(m,{children:"Diagnosis"}),e.jsx(m,{children:"Scores"}),e.jsx(m,{children:"Condition"}),e.jsx(m,{children:"Ventilator"}),e.jsx(m,{children:"Status"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsxs(Ue,{children:[z.map(s=>e.jsxs(B,{className:"group hover:bg-muted/20",children:[e.jsx(o,{className:"font-bold",children:s.bed_number}),e.jsx(o,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.patient_code})]})}),e.jsx(o,{className:"max-w-[200px] truncate",children:s.diagnosis}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-2 text-xs",children:[s.apache_ii_score&&e.jsxs(j,{variant:"outline",className:"text-[10px]",children:["AP II: ",s.apache_ii_score]}),s.sofa_score&&e.jsxs(j,{variant:"outline",className:"text-[10px]",children:["SOFA: ",s.sofa_score]})]})}),e.jsx(o,{children:e.jsx(j,{variant:"outline",className:s.condition==="Critical"?"bg-destructive/10 text-destructive border-destructive/20":"bg-warning/10 text-warning border-warning/20",children:s.condition})}),e.jsx(o,{children:e.jsx(j,{variant:s.ventilator_support?"destructive":"secondary",children:s.ventilator_support?"Yes":"No"})}),e.jsx(o,{children:e.jsx(j,{variant:"outline",children:s.status})}),e.jsx(o,{className:"text-right",children:e.jsxs(be,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(Ye,{className:"w-4 h-4"})})}),e.jsxs(Se,{align:"end",children:[e.jsx(we,{children:"Actions"}),e.jsxs(L,{className:"gap-2 cursor-pointer",children:[e.jsx(Ge,{className:"w-4 h-4"})," Clinical View"]}),e.jsxs(L,{className:"gap-2 cursor-pointer",onClick:()=>me(s),children:[e.jsx(Je,{className:"w-4 h-4"})," Update Status"]}),e.jsx(De,{}),e.jsxs(L,{className:"gap-2 text-destructive cursor-pointer",onClick:()=>he(s),children:[e.jsx(Ie,{className:"w-4 h-4"})," Discharge/Remove"]})]})]})})]},s.id)),z.length===0&&!R&&e.jsx(B,{children:e.jsx(o,{colSpan:8,className:"text-center py-12 text-muted-foreground",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(V,{className:"w-10 h-10 opacity-20"}),e.jsx("p",{children:"No active ICU patients found."})]})})})]})]})})}),e.jsx(Ee,{open:ce,onOpenChange:p,children:e.jsxs(Be,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ve,{children:[e.jsxs(Re,{children:[e.jsx(V,{className:"w-5 h-5 text-destructive inline-block mr-2"}),S?"Update ICU Patient":"Admit to ICU"]}),e.jsx(He,{children:S?"Update patient condition, scores, and status":"Admit a patient to intensive care unit"})]}),e.jsxs(Fe,{defaultValue:"admission",className:"w-full",children:[e.jsxs(Le,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsx(U,{value:"admission",children:"Admission Info"}),e.jsx(U,{value:"scores",children:"Clinical Scores"}),e.jsx(U,{value:"lines",children:"Lines & Fluids"})]}),e.jsx(E,{value:"admission",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(g,{value:a.patient_id,onValueChange:s=>t({...a,patient_id:s}),children:[e.jsx(_,{children:e.jsx(f,{placeholder:"Select patient"})}),e.jsx(v,{className:"max-h-60",children:te.map(s=>e.jsxs(y,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"doctor_id",children:"Attending Physician *"}),e.jsxs(g,{value:a.doctor_id,onValueChange:s=>t({...a,doctor_id:s}),children:[e.jsx(_,{children:e.jsx(f,{placeholder:"Select doctor"})}),e.jsx(v,{className:"max-h-60",children:le.map(s=>e.jsxs(y,{value:s.id,children:["Dr. ",s.name," (",s.specialization,")"]},s.id))})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(r,{htmlFor:"diagnosis",children:"Admitting Diagnosis"}),e.jsx(W,{id:"diagnosis",value:a.diagnosis,onChange:s=>t({...a,diagnosis:s.target.value}),placeholder:"Primary diagnosis details...",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 col-span-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"condition",children:"Condition"}),e.jsxs(g,{value:a.condition,onValueChange:s=>t({...a,condition:s}),children:[e.jsx(_,{children:e.jsx(f,{placeholder:"Select condition"})}),e.jsx(v,{children:Qe.map(s=>e.jsx(y,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"status",children:"Status"}),e.jsxs(g,{value:a.status,onValueChange:s=>t({...a,status:s}),children:[e.jsx(_,{children:e.jsx(f,{placeholder:"Select status"})}),e.jsx(v,{children:We.map(s=>e.jsx(y,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 col-span-2 border p-3 rounded-md bg-muted/40",children:[e.jsx(ke,{id:"ventilator",checked:a.ventilator_support,onCheckedChange:s=>t({...a,ventilator_support:s})}),e.jsxs("div",{className:"grid gap-1.5 leading-none",children:[e.jsx(r,{htmlFor:"ventilator",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Ventilator Support Required"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select if patient is intubated/ventilated."})]})]})]})}),e.jsxs(E,{value:"scores",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(d,{children:[e.jsx(P,{className:"p-4 pb-2",children:e.jsx(O,{className:"text-sm",children:"APACHE II Score"})}),e.jsxs(x,{className:"p-4 pt-2",children:[e.jsx(c,{type:"number",placeholder:"0-71",value:a.apache_ii_score,onChange:s=>t({...a,apache_ii_score:s.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Acute Physiology and Chronic Health Evaluation"})]})]}),e.jsxs(d,{children:[e.jsx(P,{className:"p-4 pb-2",children:e.jsx(O,{className:"text-sm",children:"SOFA Score"})}),e.jsxs(x,{className:"p-4 pt-2",children:[e.jsx(c,{type:"number",placeholder:"0-24",value:a.sofa_score,onChange:s=>t({...a,sofa_score:s.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Sequential Organ Failure Assessment"})]})]}),e.jsxs(d,{children:[e.jsx(P,{className:"p-4 pb-2",children:e.jsx(O,{className:"text-sm",children:"RASS Score"})}),e.jsxs(x,{className:"p-4 pt-2",children:[e.jsxs(g,{value:a.rass_score,onValueChange:s=>t({...a,rass_score:s}),children:[e.jsx(_,{children:e.jsx(f,{placeholder:"Score"})}),e.jsx(v,{children:["+4","+3","+2","+1","0","-1","-2","-3","-4","-5"].map(s=>e.jsx(y,{value:s,children:s},s))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Richmond Agitation-Sedation Scale"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"notes",children:"Clinical Notes"}),e.jsx(W,{id:"notes",value:a.notes,onChange:s=>t({...a,notes:s.target.value}),rows:3,placeholder:"Daily progress notes..."})]})]}),e.jsx(E,{value:"lines",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(r,{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4"})," Invasive Lines (Days)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Central Line"}),e.jsx(c,{type:"number",value:a.central_line_days,onChange:s=>t({...a,central_line_days:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Arterial Line"}),e.jsx(c,{type:"number",value:a.arterial_line_days,onChange:s=>t({...a,arterial_line_days:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Foley Catheter"}),e.jsx(c,{type:"number",value:a.foley_catheter_days,onChange:s=>t({...a,foley_catheter_days:s.target.value})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(r,{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"})," 24h Fluid Balance (mL)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Total Intake"}),e.jsx(c,{type:"number",placeholder:"2500",value:a.daily_intake,onChange:s=>t({...a,daily_intake:s.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Total Output"}),e.jsx(c,{type:"number",placeholder:"1800",value:a.daily_output,onChange:s=>t({...a,daily_output:s.target.value})})]}),e.jsxs("div",{className:"col-span-2 space-y-1",children:[e.jsx(r,{className:"text-xs",children:"Net Balance"}),e.jsx(c,{className:parseInt(a.fluid_balance)>0?"text-green-600 font-bold":"text-red-500 font-bold",value:a.daily_intake&&a.daily_output?(parseFloat(a.daily_intake)-parseFloat(a.daily_output)).toFixed(0):a.fluid_balance,readOnly:!0,placeholder:"+/- Balance"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Auto-calculated: Intake - Output"})]})]})]})]})})]}),e.jsxs(Me,{children:[e.jsx(I,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(I,{onClick:ue,disabled:k,children:[k&&e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}),S?"Update":"Admit"," Patient"]})]})]})}),e.jsx(Ze,{open:oe,onOpenChange:T,onConfirm:pe,title:"Remove ICU Patient",description:`Are you sure you want to remove ${h==null?void 0:h.patient_name} from ICU records?`,loading:k})]})};export{vs as default};
