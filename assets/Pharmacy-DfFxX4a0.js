import{f as l,r as o,d as X,j as e}from"./index-MFUeX4KC.js";import{c as Y,i as Z,B as C,S as ee,P as R,D as ae,e as se,f as te,g as T,T as re}from"./AdminLayout-CEyGcOXW.js";import{C as $,a as ne,b as ie,d as H,B as f}from"./card--ujVzSXa.js";import{I as m}from"./Combination-CVDpaV-S.js";import{L as d}from"./label-Cw8AwbsX.js";import{T as ce}from"./textarea-BWkPO5tB.js";import{T as le,a as oe,b as F,c as j,d as de,e as h}from"./table-tgADzikB.js";import{D as me,a as pe,b as he,c as ue,e as ge,d as xe}from"./dialog-C_l7gpm1.js";import{S as je,a as ye,b as fe,c as _e,d as ve}from"./select-CM0PFwtY.js";import{E as we,D as Ne}from"./DeleteConfirmDialog-Tv4EgB03.js";import{F as Se}from"./filter-MFaesxLD.js";import{P as Ce}from"./plus-DrrZjkgX.js";import{L as U}from"./loader-circle-DYBsGSuP.js";import{S as ke}from"./square-pen-QpnerZQe.js";import"./index-lz0iHb9C.js";const _={async getAll(t={}){return(await l.get("/pharmacy",{params:t})).data},async getById(t){return(await l.get(`/pharmacy/${t}`)).data.data},async create(t){return(await l.post("/pharmacy",t)).data.data},async update(t,c){return(await l.put(`/pharmacy/${t}`,c)).data.data},async updateStock(t,c,p="add"){return(await l.put(`/pharmacy/${t}/stock`,{quantity:c,operation:p})).data.data},async dispense(t){return(await l.post("/pharmacy/dispense",t)).data.data},async getLowStock(){return(await l.get("/pharmacy/low-stock")).data.data},async getExpiring(t=30){return(await l.get("/pharmacy/expiring",{params:{days:t}})).data.data},async getCategories(){return(await l.get("/pharmacy/categories")).data.data},async getTransactions(t={}){return(await l.get("/pharmacy/transactions",{params:t})).data.data},async delete(t){await l.delete(`/pharmacy/${t}`)}},be=["Tablet","Capsule","Syrup","Injection","Cream","Ointment","Drops","Inhaler","Suppository","Powder"],Ue=()=>{const[t,c]=o.useState([]),[p,I]=o.useState([]),[E,L]=o.useState(!0),[v,G]=o.useState(""),[V,y]=o.useState(!1),[z,k]=o.useState(!1),[u,w]=o.useState(null),[N,q]=o.useState(!1),[b,S]=o.useState(!1),{toast:g}=X(),[s,i]=o.useState({name:"",generic_name:"",dosage_form:"",strength:"",manufacturer:"",stock_quantity:"",min_stock_level:"50",unit_price:"",selling_price:"",expiry_date:"",description:""});o.useEffect(()=>{D()},[]);const D=async()=>{var a,n;try{L(!0);const[r,x]=await Promise.all([_.getAll({limit:100}),_.getLowStock().catch(()=>[])]);c(r.data||[]),I(x||[])}catch(r){g({title:"Error",description:((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to load pharmacy data",variant:"destructive"})}finally{L(!1)}},P=()=>{i({name:"",generic_name:"",dosage_form:"",strength:"",manufacturer:"",stock_quantity:"",min_stock_level:"50",unit_price:"",selling_price:"",expiry_date:"",description:""}),w(null),q(!1)},Q=()=>{P(),y(!0)},A=a=>{var n,r,x,B,M;w(a),q(!0),i({name:a.name||"",generic_name:a.generic_name||"",dosage_form:a.dosage_form||"",strength:a.strength||"",manufacturer:a.manufacturer||"",stock_quantity:((n=a.stock_quantity)==null?void 0:n.toString())||"",min_stock_level:((r=a.min_stock_level)==null?void 0:r.toString())||"50",unit_price:((x=a.unit_price)==null?void 0:x.toString())||"",selling_price:((B=a.selling_price)==null?void 0:B.toString())||"",expiry_date:((M=a.expiry_date)==null?void 0:M.split("T")[0])||"",description:a.description||""}),y(!0)},J=a=>{w(a),k(!0)},K=async()=>{var a,n;if(!s.name||!s.dosage_form||!s.selling_price){g({title:"Error",description:"Please fill name, dosage form, and price",variant:"destructive"});return}try{S(!0);const r={...s,stock_quantity:s.stock_quantity?parseInt(s.stock_quantity):0,min_stock_level:parseInt(s.min_stock_level),unit_price:s.unit_price?parseFloat(s.unit_price):null,selling_price:parseFloat(s.selling_price)};N&&u?(await _.update(u.id,r),g({title:"Success",description:"Item updated successfully"})):(await _.create(r),g({title:"Success",description:"Item added successfully"})),y(!1),P(),D()}catch(r){g({title:"Error",description:((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Operation failed",variant:"destructive"})}finally{S(!1)}},W=async()=>{var a,n;if(u)try{S(!0),await _.delete(u.id),g({title:"Success",description:"Item deleted successfully"}),k(!1),w(null),D()}catch(r){g({title:"Error",description:((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to delete item",variant:"destructive"})}finally{S(!1)}},O=t.filter(a=>{var n,r,x;return((n=a.name)==null?void 0:n.toLowerCase().includes(v.toLowerCase()))||((r=a.item_code)==null?void 0:r.toLowerCase().includes(v.toLowerCase()))||((x=a.generic_name)==null?void 0:x.toLowerCase().includes(v.toLowerCase()))});return e.jsxs(Y,{title:"Pharmacy",subtitle:"Manage pharmacy inventory and medications",children:[p.length>0&&e.jsxs($,{className:"mb-6 border-warning/50 bg-warning/5",children:[e.jsx(ne,{className:"pb-2",children:e.jsxs(ie,{className:"text-sm font-medium text-warning flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Low Stock Alert (",p.length," items)"]})}),e.jsx(H,{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[p.slice(0,5).map(a=>e.jsxs(C,{variant:"outline",className:"border-warning/50 text-warning",children:[a.name," (",a.stock_quantity," left)"]},a.id)),p.length>5&&e.jsxs(C,{variant:"secondary",children:["+",p.length-5," more"]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search medications...",className:"pl-10",value:v,onChange:a=>G(a.target.value)})]}),e.jsx(f,{variant:"outline",size:"icon",children:e.jsx(Se,{className:"w-4 h-4"})})]}),e.jsxs(f,{className:"gap-2",onClick:Q,children:[e.jsx(Ce,{className:"w-4 h-4"}),"Add Item"]})]}),e.jsx($,{children:e.jsx(H,{className:"p-0",children:E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(U,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(le,{children:[e.jsx(oe,{children:e.jsxs(F,{children:[e.jsx(j,{children:"Code"}),e.jsx(j,{children:"Name"}),e.jsx(j,{children:"Generic Name"}),e.jsx(j,{children:"Form"}),e.jsx(j,{children:"Stock"}),e.jsx(j,{children:"Price"}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsxs(de,{children:[O.map(a=>e.jsxs(F,{className:"group",children:[e.jsx(h,{className:"font-mono text-sm",children:a.item_code}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:a.name})]})}),e.jsx(h,{className:"text-muted-foreground",children:a.generic_name||"N/A"}),e.jsx(h,{children:e.jsx(C,{variant:"secondary",children:a.dosage_form||"Tablet"})}),e.jsx(h,{children:e.jsx(C,{variant:"outline",className:a.stock_quantity<=(a.min_stock_level||50)?"border-warning text-warning":"border-success text-success",children:a.stock_quantity})}),e.jsxs(h,{children:["ETB ",a.selling_price]}),e.jsx(h,{className:"text-right",children:e.jsxs(ae,{children:[e.jsx(se,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(we,{className:"w-4 h-4"})})}),e.jsxs(te,{align:"end",children:[e.jsxs(T,{className:"gap-2",onClick:()=>A(a),children:[e.jsx(ke,{className:"w-4 h-4"})," Edit"]}),e.jsxs(T,{className:"gap-2",onClick:()=>A(a),children:[e.jsx(R,{className:"w-4 h-4"})," Update Stock"]}),e.jsxs(T,{className:"gap-2 text-destructive",onClick:()=>J(a),children:[e.jsx(re,{className:"w-4 h-4"})," Delete"]})]})]})})]},a.id)),O.length===0&&!E&&e.jsx(F,{children:e.jsx(h,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No items found"})})]})]})})}),e.jsx(me,{open:V,onOpenChange:y,children:e.jsxs(pe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(he,{children:[e.jsx(ue,{children:N?"Edit Pharmacy Item":"Add New Item"}),e.jsx(ge,{children:N?"Update item information and stock":"Add a new medication to inventory"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Item Name *"}),e.jsx(m,{id:"name",value:s.name,onChange:a=>i({...s,name:a.target.value}),placeholder:"Brand name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"generic_name",children:"Generic Name"}),e.jsx(m,{id:"generic_name",value:s.generic_name,onChange:a=>i({...s,generic_name:a.target.value}),placeholder:"Generic name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"dosage_form",children:"Dosage Form *"}),e.jsxs(je,{value:s.dosage_form,onValueChange:a=>i({...s,dosage_form:a}),children:[e.jsx(ye,{children:e.jsx(fe,{placeholder:"Select form"})}),e.jsx(_e,{children:be.map(a=>e.jsx(ve,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"strength",children:"Strength"}),e.jsx(m,{id:"strength",value:s.strength,onChange:a=>i({...s,strength:a.target.value}),placeholder:"e.g., 500mg, 10ml"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"manufacturer",children:"Manufacturer"}),e.jsx(m,{id:"manufacturer",value:s.manufacturer,onChange:a=>i({...s,manufacturer:a.target.value}),placeholder:"Manufacturer name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"expiry_date",children:"Expiry Date"}),e.jsx(m,{id:"expiry_date",type:"date",value:s.expiry_date,onChange:a=>i({...s,expiry_date:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"stock_quantity",children:"Stock Quantity"}),e.jsx(m,{id:"stock_quantity",type:"number",value:s.stock_quantity,onChange:a=>i({...s,stock_quantity:a.target.value}),placeholder:"Current stock"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"min_stock_level",children:"Min Stock Level"}),e.jsx(m,{id:"min_stock_level",type:"number",value:s.min_stock_level,onChange:a=>i({...s,min_stock_level:a.target.value}),placeholder:"Reorder level"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"unit_price",children:"Unit Price (ETB)"}),e.jsx(m,{id:"unit_price",type:"number",step:"0.01",value:s.unit_price,onChange:a=>i({...s,unit_price:a.target.value}),placeholder:"Cost price"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"selling_price",children:"Selling Price (ETB) *"}),e.jsx(m,{id:"selling_price",type:"number",step:"0.01",value:s.selling_price,onChange:a=>i({...s,selling_price:a.target.value}),placeholder:"Retail price"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(ce,{id:"description",value:s.description,onChange:a=>i({...s,description:a.target.value}),placeholder:"Additional information",rows:2})]})]}),e.jsxs(xe,{children:[e.jsx(f,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(f,{onClick:K,disabled:b,children:[b&&e.jsx(U,{className:"w-4 h-4 mr-2 animate-spin"}),N?"Update":"Add"," Item"]})]})]})}),e.jsx(Ne,{open:z,onOpenChange:k,onConfirm:W,title:"Delete Pharmacy Item",description:`Are you sure you want to delete ${u==null?void 0:u.name}? This action cannot be undone.`,loading:b})]})};export{Ue as default};
