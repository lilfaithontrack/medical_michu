import{c as ie,r as i,d as re,j as e}from"./index-Ds3XC1ar.js";import{c as ne,B as O,S as le,l as ce,D as oe,e as de,f as me,g as T}from"./AdminLayout-CXoTaXAo.js";import{C as E,d as F,B as S}from"./card-f0OTF_cP.js";import{I as pe}from"./Combination-DFmHiCFn.js";import{L as c}from"./label-BYM7NRxj.js";import{T as P}from"./textarea-CyD-ufqi.js";import{T as he,a as xe,b as R,c as m,d as ue,e as o}from"./table-DBI9rBV5.js";import{E as ge,S as je,T as ye,D as fe,a as ve,b as Ne,c as Se,f as we,d as _e,e as Ce}from"./DeleteConfirmDialog-B8W9ttXa.js";import{S as h,a as x,b as u,c as g,d as j}from"./select-ksrcy_E6.js";import{r as f}from"./diagnosticService-yR2ezfc6.js";import{p as be}from"./patientService-DRPZqBm1.js";import{d as De}from"./doctorService-XNbiPam0.js";import{P as Oe}from"./plus-WvUahM_s.js";import{L as V}from"./loader-circle-Duh_MnJ-.js";import{E as Te}from"./eye-BBnAzWI7.js";import"./index-B2wLCXzD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=ie("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),Fe={Ordered:"bg-info/10 text-info border-info/20",Scheduled:"bg-warning/10 text-warning border-warning/20","In Progress":"bg-warning/10 text-warning border-warning/20",Completed:"bg-success/10 text-success border-success/20",Reported:"bg-success/10 text-success border-success/20",Cancelled:"bg-muted text-muted-foreground border-border"},Pe=["Ordered","Scheduled","In Progress","Completed","Reported","Cancelled"],Re=["X-Ray","CT Scan","MRI","Ultrasound","Mammography","Fluoroscopy","PET Scan","Bone Density"],Ie=["Normal","Urgent","STAT"],Le=["Head","Chest","Abdomen","Spine","Pelvis","Upper Extremity","Lower Extremity","Full Body"],Ye=()=>{const[B,U]=i.useState([]),[I,q]=i.useState([]),[H,$]=i.useState([]),[z,X]=i.useState([]),[w,L]=i.useState(!0),[_,G]=i.useState(""),[J,y]=i.useState(!1),[K,C]=i.useState(!1),[n,v]=i.useState(null),[p,k]=i.useState(!1),[b,N]=i.useState(!1),{toast:d}=re(),[a,r]=i.useState({patient_id:"",doctor_id:"",exam_type:"",body_part:"",priority:"Normal",clinical_indication:"",status:"Ordered",findings:"",impression:""});i.useEffect(()=>{D(),Q()},[]);const D=async()=>{var s,t;try{L(!0);const[l,te]=await Promise.all([f.getAll({limit:100}),f.getEquipment().catch(()=>[])]);U(l.data||[]),q(te||[])}catch(l){d({title:"Error",description:((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load radiology data",variant:"destructive"})}finally{L(!1)}},Q=async()=>{try{const[s,t]=await Promise.all([be.getAll({limit:200}),De.getAll({limit:100})]);$(s.data||[]),X(t.data||[])}catch(s){console.error("Failed to load lookups:",s)}},A=()=>{r({patient_id:"",doctor_id:"",exam_type:"",body_part:"",priority:"Normal",clinical_indication:"",status:"Ordered",findings:"",impression:""}),v(null),k(!1)},W=()=>{A(),y(!0)},Y=s=>{v(s),k(!0),r({patient_id:s.patient_id||"",doctor_id:s.doctor_id||"",exam_type:s.exam_type||"",body_part:s.body_part||"",priority:s.priority||"Normal",clinical_indication:s.clinical_indication||"",status:s.status||"Ordered",findings:s.findings||"",impression:s.impression||""}),y(!0)},Z=s=>{v(s),C(!0)},ee=async()=>{var s,t;if(!a.patient_id||!a.doctor_id||!a.exam_type){d({title:"Error",description:"Please fill all required fields",variant:"destructive"});return}try{N(!0),p&&n?(await f.update(n.id,a),d({title:"Success",description:"Radiology order updated successfully"})):(await f.create(a),d({title:"Success",description:"Imaging order placed successfully"})),y(!1),A(),D()}catch(l){d({title:"Error",description:((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Operation failed",variant:"destructive"})}finally{N(!1)}},se=async()=>{var s,t;if(n)try{N(!0),await f.delete(n.id),d({title:"Success",description:"Radiology order cancelled successfully"}),C(!1),v(null),D()}catch(l){d({title:"Error",description:((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete order",variant:"destructive"})}finally{N(!1)}},M=B.filter(s=>{var t,l;return((t=s.patient_name)==null?void 0:t.toLowerCase().includes(_.toLowerCase()))||((l=s.exam_type)==null?void 0:l.toLowerCase().includes(_.toLowerCase()))}),ae=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A";return e.jsxs(ne,{title:"Radiology",subtitle:"Manage imaging orders and equipment",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[I.slice(0,4).map(s=>e.jsx(E,{children:e.jsxs(F,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ee,{className:"w-6 h-6 text-muted-foreground"}),e.jsx(O,{variant:s.status==="Operational"?"default":"destructive",children:s.status})]}),e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.location})]})},s.id)),I.length===0&&!w&&e.jsx(E,{className:"col-span-4",children:e.jsx(F,{className:"pt-4 text-center text-muted-foreground",children:"No equipment data available"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(pe,{placeholder:"Search imaging orders...",className:"pl-10",value:_,onChange:s=>G(s.target.value)})]}),e.jsxs(S,{className:"gap-2",onClick:W,children:[e.jsx(Oe,{className:"w-4 h-4"}),"New Order"]})]}),e.jsx(E,{children:e.jsx(F,{className:"p-0",children:w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(V,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(he,{children:[e.jsx(xe,{children:e.jsxs(R,{children:[e.jsx(m,{children:"Order ID"}),e.jsx(m,{children:"Patient"}),e.jsx(m,{children:"Exam Type"}),e.jsx(m,{children:"Priority"}),e.jsx(m,{children:"Ordered Date"}),e.jsx(m,{children:"Status"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsxs(ue,{children:[M.map(s=>e.jsxs(R,{className:"group",children:[e.jsx(o,{className:"font-mono text-sm",children:s.order_id}),e.jsx(o,{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),s.exam_type]})}),e.jsx(o,{children:e.jsx(O,{variant:s.priority==="Urgent"?"destructive":"secondary",children:s.priority||"Normal"})}),e.jsx(o,{children:ae(s.ordered_date||s.created_at)}),e.jsx(o,{children:e.jsx(O,{variant:"outline",className:Fe[s.status]||"",children:s.status})}),e.jsx(o,{className:"text-right",children:e.jsxs(oe,{children:[e.jsx(de,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(ge,{className:"w-4 h-4"})})}),e.jsxs(me,{align:"end",children:[e.jsxs(T,{className:"gap-2",children:[e.jsx(Te,{className:"w-4 h-4"})," View Report"]}),e.jsxs(T,{className:"gap-2",onClick:()=>Y(s),children:[e.jsx(je,{className:"w-4 h-4"})," Enter Report"]}),e.jsxs(T,{className:"gap-2 text-destructive",onClick:()=>Z(s),children:[e.jsx(ye,{className:"w-4 h-4"})," Cancel"]})]})]})})]},s.id)),M.length===0&&!w&&e.jsx(R,{children:e.jsx(o,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No imaging orders found"})})]})]})})}),e.jsx(fe,{open:J,onOpenChange:y,children:e.jsxs(ve,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsx(Se,{children:p?"Update Radiology Order":"New Imaging Order"}),e.jsx(we,{children:p?"Update order status and enter report":"Order a new imaging study"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[!p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(h,{value:a.patient_id,onValueChange:s=>r({...a,patient_id:s}),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select patient"})}),e.jsx(g,{className:"max-h-60",children:H.map(s=>e.jsxs(j,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"doctor_id",children:"Ordering Physician *"}),e.jsxs(h,{value:a.doctor_id,onValueChange:s=>r({...a,doctor_id:s}),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select doctor"})}),e.jsx(g,{className:"max-h-60",children:z.map(s=>e.jsxs(j,{value:s.id,children:["Dr. ",s.name]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"exam_type",children:"Exam Type *"}),e.jsxs(h,{value:a.exam_type,onValueChange:s=>r({...a,exam_type:s}),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select type"})}),e.jsx(g,{children:Re.map(s=>e.jsx(j,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"body_part",children:"Body Part"}),e.jsxs(h,{value:a.body_part,onValueChange:s=>r({...a,body_part:s}),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select part"})}),e.jsx(g,{children:Le.map(s=>e.jsx(j,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"priority",children:"Priority"}),e.jsxs(h,{value:a.priority,onValueChange:s=>r({...a,priority:s}),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select priority"})}),e.jsx(g,{children:Ie.map(s=>e.jsx(j,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"clinical_indication",children:"Clinical Indication"}),e.jsx(P,{id:"clinical_indication",value:a.clinical_indication,onChange:s=>r({...a,clinical_indication:s.target.value}),placeholder:"Reason for imaging",rows:2})]})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"status",children:"Status"}),e.jsxs(h,{value:a.status,onValueChange:s=>r({...a,status:s}),children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Select status"})}),e.jsx(g,{children:Pe.map(s=>e.jsx(j,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"findings",children:"Findings"}),e.jsx(P,{id:"findings",value:a.findings,onChange:s=>r({...a,findings:s.target.value}),placeholder:"Describe findings from the imaging study",rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"impression",children:"Impression"}),e.jsx(P,{id:"impression",value:a.impression,onChange:s=>r({...a,impression:s.target.value}),placeholder:"Summary impression/diagnosis",rows:2})]})]})]}),e.jsxs(_e,{children:[e.jsx(S,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(S,{onClick:ee,disabled:b,children:[b&&e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),p?"Save Report":"Place Order"]})]})]})}),e.jsx(Ce,{open:K,onOpenChange:C,onConfirm:se,title:"Cancel Imaging Order",description:`Are you sure you want to cancel the ${n==null?void 0:n.exam_type} order for ${n==null?void 0:n.patient_name}?`,loading:b})]})};export{Ye as default};
