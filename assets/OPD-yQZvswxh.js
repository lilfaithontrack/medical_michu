import{r as i,d as Z,j as e}from"./index-BM0IHp2M.js";import{c as ee,C as se,h as te,S as ae,B as ie,D as le,e as ne,f as re,g as C,T as ce}from"./AdminLayout-CWUWmsnS.js";import{C as g,d as f,B as v}from"./card-DeprxXCB.js";import{U as oe,I as b}from"./Combination-DWTH6IhY.js";import{L as d}from"./label-PzrI3jAD.js";import{T as de}from"./textarea-DWoGW9ma.js";import{T as me,a as he,b as T,c as m,d as xe,e as o}from"./table-BzDp6Nnk.js";import{D as pe,a as ue,b as je,c as ge,e as fe,d as ve}from"./dialog-DCRhT7_F.js";import{S as O,a as V,b as P,c as E,d as k}from"./select-OA5PXWO7.js";import{o as N}from"./admissionService-BasvtlDv.js";import{p as Ne}from"./patientService-DFGR6BTX.js";import{d as we}from"./doctorService-jnKXpXU3.js";import{E as De,D as Se}from"./DeleteConfirmDialog-Dqug50Ir.js";import{P as _e}from"./plus-BoDGEuOf.js";import{L as R}from"./loader-circle-aBlEtCJL.js";import{E as ye}from"./eye-Dp2HsTK1.js";import{S as Ce}from"./square-pen-D0IrTuyB.js";import"./index-yV4U6faZ.js";const be={Waiting:"bg-warning/10 text-warning border-warning/20","In Consultation":"bg-info/10 text-info border-info/20",Completed:"bg-success/10 text-success border-success/20"},Te=["Waiting","In Consultation","Completed"],Qe=()=>{const[w,U]=i.useState([]),[W,B]=i.useState([]),[M,H]=i.useState([]),[F,I]=i.useState(!0),[D,z]=i.useState(""),[q,h]=i.useState(!1),[G,S]=i.useState(!1),[r,p]=i.useState(null),[x,L]=i.useState(!1),[_,u]=i.useState(!1),{toast:c}=Z(),[t,n]=i.useState({patient_id:"",doctor_id:"",visit_date:new Date().toISOString().split("T")[0],visit_time:new Date().toTimeString().slice(0,5),chief_complaint:"",status:"Waiting"});i.useEffect(()=>{y(),Q()},[]);const y=async()=>{var s,a;try{I(!0);const l=await N.getAll({limit:100});U(l.data||[])}catch(l){c({title:"Error",description:((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to load OPD visits",variant:"destructive"})}finally{I(!1)}},Q=async()=>{try{const[s,a]=await Promise.all([Ne.getAll({limit:200}),we.getAll({limit:100})]);B(s.data||[]),H(a.data||[])}catch(s){console.error("Failed to load lookups:",s)}},A=()=>{n({patient_id:"",doctor_id:"",visit_date:new Date().toISOString().split("T")[0],visit_time:new Date().toTimeString().slice(0,5),chief_complaint:"",status:"Waiting"}),p(null),L(!1)},$=()=>{A(),h(!0)},J=s=>{var a;p(s),L(!0),n({patient_id:s.patient_id||"",doctor_id:s.doctor_id||"",visit_date:((a=s.visit_date)==null?void 0:a.split("T")[0])||new Date().toISOString().split("T")[0],visit_time:s.visit_time||"",chief_complaint:s.chief_complaint||"",status:s.status||"Waiting"}),h(!0)},K=s=>{p(s),S(!0)},X=async()=>{var s,a;if(!t.patient_id||!t.doctor_id){c({title:"Error",description:"Please select patient and doctor",variant:"destructive"});return}try{u(!0),x&&r?(await N.update(r.id,t),c({title:"Success",description:"Visit updated successfully"})):(await N.create(t),c({title:"Success",description:"OPD visit registered successfully"})),h(!1),A(),y()}catch(l){c({title:"Error",description:((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{u(!1)}},Y=async()=>{var s,a;if(r)try{u(!0),await N.delete(r.id),c({title:"Success",description:"Visit deleted successfully"}),S(!1),p(null),y()}catch(l){c({title:"Error",description:((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete visit",variant:"destructive"})}finally{u(!1)}},j=Array.isArray(w)?w.filter(s=>{var a,l;return((a=s.patient_name)==null?void 0:a.toLowerCase().includes(D.toLowerCase()))||((l=s.token_number)==null?void 0:l.toString().includes(D))}):[];return e.jsxs(ee,{title:"OPD",subtitle:"Outpatient Department - Today's Queue",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(g,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Today"}),e.jsx("p",{className:"text-3xl font-bold",children:w.length})]}),e.jsx(oe,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(g,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Waiting"}),e.jsx("p",{className:"text-3xl font-bold text-warning",children:j.filter(s=>s.status==="Waiting").length})]}),e.jsx(se,{className:"w-8 h-8 text-warning"})]})})}),e.jsx(g,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-success",children:j.filter(s=>s.status==="Completed").length})]}),e.jsx(te,{className:"w-8 h-8 text-success"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(b,{placeholder:"Search by name or token...",className:"pl-10",value:D,onChange:s=>z(s.target.value)})]}),e.jsxs(v,{className:"gap-2",onClick:$,children:[e.jsx(_e,{className:"w-4 h-4"}),"New Visit"]})]}),e.jsx(g,{children:e.jsx(f,{className:"p-0",children:F?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(R,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(T,{children:[e.jsx(m,{children:"Token"}),e.jsx(m,{children:"Patient"}),e.jsx(m,{children:"Doctor"}),e.jsx(m,{children:"Department"}),e.jsx(m,{children:"Status"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsxs(xe,{children:[j.map(s=>e.jsxs(T,{className:"group",children:[e.jsx(o,{className:"font-bold text-lg",children:s.token_number||"-"}),e.jsx(o,{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsx(o,{children:s.doctor_name||"Unassigned"}),e.jsx(o,{children:s.department_name||"General"}),e.jsx(o,{children:e.jsx(ie,{variant:"outline",className:be[s.status]||"",children:s.status})}),e.jsx(o,{className:"text-right",children:e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(De,{className:"w-4 h-4"})})}),e.jsxs(re,{align:"end",children:[e.jsxs(C,{className:"gap-2",children:[e.jsx(ye,{className:"w-4 h-4"})," View Details"]}),e.jsxs(C,{className:"gap-2",onClick:()=>J(s),children:[e.jsx(Ce,{className:"w-4 h-4"})," Edit"]}),e.jsxs(C,{className:"gap-2 text-destructive",onClick:()=>K(s),children:[e.jsx(ce,{className:"w-4 h-4"})," Delete"]})]})]})})]},s.id)),j.length===0&&!F&&e.jsx(T,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No OPD visits today"})})]})]})})}),e.jsx(pe,{open:q,onOpenChange:h,children:e.jsxs(ue,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(je,{children:[e.jsx(ge,{children:x?"Update OPD Visit":"Register New OPD Visit"}),e.jsx(fe,{children:x?"Update visit status or details":"Register a new outpatient visit"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(O,{value:t.patient_id,onValueChange:s=>n({...t,patient_id:s}),children:[e.jsx(V,{children:e.jsx(P,{placeholder:"Select patient"})}),e.jsx(E,{className:"max-h-60",children:W.map(s=>e.jsxs(k,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"doctor_id",children:"Doctor *"}),e.jsxs(O,{value:t.doctor_id,onValueChange:s=>n({...t,doctor_id:s}),children:[e.jsx(V,{children:e.jsx(P,{placeholder:"Select doctor"})}),e.jsx(E,{className:"max-h-60",children:M.map(s=>e.jsxs(k,{value:s.id,children:["Dr. ",s.name," (",s.specialization,")"]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"visit_date",children:"Visit Date"}),e.jsx(b,{id:"visit_date",type:"date",value:t.visit_date,onChange:s=>n({...t,visit_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"visit_time",children:"Visit Time"}),e.jsx(b,{id:"visit_time",type:"time",value:t.visit_time,onChange:s=>n({...t,visit_time:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"chief_complaint",children:"Chief Complaint"}),e.jsx(de,{id:"chief_complaint",value:t.chief_complaint,onChange:s=>n({...t,chief_complaint:s.target.value}),placeholder:"Reason for visit",rows:3})]}),x&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"status",children:"Status"}),e.jsxs(O,{value:t.status,onValueChange:s=>n({...t,status:s}),children:[e.jsx(V,{children:e.jsx(P,{placeholder:"Select status"})}),e.jsx(E,{children:Te.map(s=>e.jsx(k,{value:s,children:s},s))})]})]})]}),e.jsxs(ve,{children:[e.jsx(v,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(v,{onClick:X,disabled:_,children:[_&&e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),x?"Update":"Register"," Visit"]})]})]})}),e.jsx(Se,{open:G,onOpenChange:S,onConfirm:Y,title:"Delete OPD Visit",description:`Are you sure you want to delete this visit for ${r==null?void 0:r.patient_name}?`,loading:_})]})};export{Qe as default};
