import{c as ee,r as i,d as se,j as e,l as ae}from"./index-MFUeX4KC.js";import{c as te,S as re,A as le,a as ne,B as j,D as ie,e as ce,f as oe,g as D,T as de}from"./AdminLayout-CEyGcOXW.js";import{B as g,C as he,d as me}from"./card--ujVzSXa.js";import{I as o}from"./Combination-CVDpaV-S.js";import{L as n}from"./label-Cw8AwbsX.js";import{S as ue}from"./switch-BSdZvj2s.js";import{T as pe,a as xe,b as E,c as h,d as fe,e as d}from"./table-tgADzikB.js";import{D as je,a as ge,b as ye,c as ve,e as we,d as Ne}from"./dialog-C_l7gpm1.js";import{S as F,a as T,b as L,c as M,d as k}from"./select-CM0PFwtY.js";import{s as N}from"./staffService-DIBXRwRi.js";import{s as Se}from"./staffRoleService-C1Icp4Fs.js";import{E as Ce,D as _e}from"./DeleteConfirmDialog-Tv4EgB03.js";import{P as Ae}from"./plus-DrrZjkgX.js";import{L as B}from"./loader-circle-DYBsGSuP.js";import{U as be}from"./user-check-BxacW4wR.js";import{E as De}from"./eye-CxZXf5Ga.js";import{S as Ee}from"./square-pen-QpnerZQe.js";import{R as Fe}from"./refresh-cw-DbMwhjYY.js";import"./index-lz0iHb9C.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ee("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),Le={Morning:"bg-warning/10 text-warning border-warning/20",Afternoon:"bg-info/10 text-info border-info/20",Night:"bg-purple-500/10 text-purple-500 border-purple-500/20",Rotating:"bg-muted text-muted-foreground border-border"},Me=["Morning","Afternoon","Night","Rotating"],ke=["Active","Inactive","On Leave"],es=()=>{const[V,U]=i.useState([]),[S,q]=i.useState([]),[O,R]=i.useState(!0),[y,H]=i.useState(""),[K,u]=i.useState(!1),[$,C]=i.useState(!1),[m,v]=i.useState(null),[p,I]=i.useState(!1),[_,w]=i.useState(!1),{toast:c}=se(),[a,l]=i.useState({name:"",role_id:"",phone:"",email:"",shift:"Morning",status:"Active",join_date:new Date().toISOString().split("T")[0],salary:"",address:"",emergency_contact:"",createAccount:!1,password:""});i.useEffect(()=>{A(),z()},[]);const A=async()=>{var s,t;try{R(!0);const r=await N.getAll({limit:100});U(r.data||[])}catch(r){c({title:"Error",description:((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load staff",variant:"destructive"})}finally{R(!1)}},z=async()=>{try{const s=await Se.getActiveRoles();q(s)}catch(s){console.error("Failed to load roles:",s)}},P=()=>{l({name:"",role_id:"",phone:"",email:"",shift:"Morning",status:"Active",join_date:new Date().toISOString().split("T")[0],salary:"",address:"",emergency_contact:"",createAccount:!1,password:""}),v(null),I(!1)},G=()=>{const s="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%";let t="";for(let r=0;r<10;r++)t+=s.charAt(Math.floor(Math.random()*s.length));l({...a,password:t})},J=()=>{P(),u(!0)},Q=s=>{var t,r;v(s),I(!0),l({name:s.name||"",role_id:s.role_id||"",phone:s.phone||"",email:s.email||"",shift:s.shift||"Morning",status:s.status||"Active",join_date:((t=s.join_date)==null?void 0:t.split("T")[0])||new Date().toISOString().split("T")[0],salary:((r=s.salary)==null?void 0:r.toString())||"",address:s.address||"",emergency_contact:s.emergency_contact||"",createAccount:!1,password:""}),u(!0)},W=s=>{v(s),C(!0)},Y=async()=>{var s,t,r,x;if(!a.name||!a.role_id||!a.phone||!a.email){c({title:"Error",description:"Please fill all required fields",variant:"destructive"});return}if(a.createAccount&&!a.password){c({title:"Error",description:"Password is required when creating an account",variant:"destructive"});return}if(a.createAccount&&a.password.length<6){c({title:"Error",description:"Password must be at least 6 characters",variant:"destructive"});return}try{if(w(!0),p&&m){const f={name:a.name,role_id:a.role_id,role:((s=S.find(b=>b.id===a.role_id))==null?void 0:s.name)||"",phone:a.phone,email:a.email,shift:a.shift,status:a.status,salary:a.salary?parseFloat(a.salary):null,address:a.address||null,emergency_contact:a.emergency_contact||null};await N.update(m.id,f),c({title:"Success",description:"Staff member updated successfully"})}else if(a.createAccount)await ae.createStaffAccount({email:a.email,password:a.password,name:a.name,role_id:a.role_id,phone:a.phone,shift:a.shift}),c({title:"Success",description:`Staff account created. Login: ${a.email}`});else{const f={name:a.name,role_id:a.role_id,role:((t=S.find(b=>b.id===a.role_id))==null?void 0:t.name)||"",phone:a.phone,email:a.email,shift:a.shift,status:a.status,join_date:a.join_date,salary:a.salary?parseFloat(a.salary):null,address:a.address||null,emergency_contact:a.emergency_contact||null};await N.create(f),c({title:"Success",description:"Staff member added successfully"})}u(!1),P(),A()}catch(f){c({title:"Error",description:((x=(r=f.response)==null?void 0:r.data)==null?void 0:x.message)||"Operation failed",variant:"destructive"})}finally{w(!1)}},Z=async()=>{var s,t;if(m)try{w(!0),await N.delete(m.id),c({title:"Success",description:"Staff member deleted successfully"}),C(!1),v(null),A()}catch(r){c({title:"Error",description:((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete staff member",variant:"destructive"})}finally{w(!1)}},X=V.filter(s=>{var t,r,x;return((t=s.name)==null?void 0:t.toLowerCase().includes(y.toLowerCase()))||((r=s.role)==null?void 0:r.toLowerCase().includes(y.toLowerCase()))||((x=s.staff_id)==null?void 0:x.toLowerCase().includes(y.toLowerCase()))});return e.jsxs(te,{title:"Staff Management",subtitle:"Manage hospital staff and create user accounts",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsx("div",{className:"flex flex-1 gap-3",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search staff...",className:"pl-10",value:y,onChange:s=>H(s.target.value)})]})}),e.jsxs(g,{className:"gap-2",onClick:J,children:[e.jsx(Ae,{className:"w-4 h-4"}),"Add Staff"]})]}),e.jsx(he,{children:e.jsx(me,{className:"p-0",children:O?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(B,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(pe,{children:[e.jsx(xe,{children:e.jsxs(E,{children:[e.jsx(h,{children:"Staff ID"}),e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Role"}),e.jsx(h,{children:"Contact"}),e.jsx(h,{children:"Shift"}),e.jsx(h,{children:"Account"}),e.jsx(h,{children:"Status"}),e.jsx(h,{className:"text-right",children:"Actions"})]})}),e.jsxs(fe,{children:[X.map(s=>{var t;return e.jsxs(E,{className:"group",children:[e.jsx(d,{className:"font-mono text-sm",children:s.staff_id}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-9 w-9",children:e.jsx(ne,{className:"bg-primary/10 text-primary text-sm",children:(t=s.name)==null?void 0:t.split(" ").map(r=>r[0]).join("").substring(0,2)})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})]})}),e.jsx(d,{children:e.jsx(j,{variant:"secondary",children:s.role})}),e.jsx(d,{className:"text-muted-foreground",children:s.phone}),e.jsx(d,{children:e.jsx(j,{variant:"outline",className:Le[s.shift]||"",children:s.shift})}),e.jsx(d,{children:s.user_id?e.jsxs(j,{variant:"outline",className:"border-success text-success",children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),"Active"]}):e.jsx(j,{variant:"outline",className:"border-muted text-muted-foreground",children:"No Account"})}),e.jsx(d,{children:e.jsx(j,{variant:"outline",className:s.status==="Active"?"border-success text-success":"border-muted",children:s.status})}),e.jsx(d,{className:"text-right",children:e.jsxs(ie,{children:[e.jsx(ce,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(Ce,{className:"w-4 h-4"})})}),e.jsxs(oe,{align:"end",children:[e.jsxs(D,{className:"gap-2",children:[e.jsx(De,{className:"w-4 h-4"})," View"]}),e.jsxs(D,{className:"gap-2",onClick:()=>Q(s),children:[e.jsx(Ee,{className:"w-4 h-4"})," Edit"]}),e.jsxs(D,{className:"gap-2 text-destructive",onClick:()=>W(s),children:[e.jsx(de,{className:"w-4 h-4"})," Delete"]})]})]})})]},s.id)}),X.length===0&&!O&&e.jsx(E,{children:e.jsx(d,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No staff found"})})]})]})})}),e.jsx(je,{open:K,onOpenChange:u,children:e.jsxs(ge,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsx(ve,{children:p?"Edit Staff Member":"Add New Staff Member"}),e.jsx(we,{children:p?"Update staff member information":"Fill in the details to add a new staff member"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Full Name *"}),e.jsx(o,{id:"name",value:a.name,onChange:s=>l({...a,name:s.target.value}),placeholder:"Enter full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"role",children:"Role *"}),e.jsxs(F,{value:a.role_id,onValueChange:s=>l({...a,role_id:s}),children:[e.jsx(T,{children:e.jsx(L,{placeholder:"Select role"})}),e.jsx(M,{children:S.map(s=>e.jsx(k,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phone",children:"Phone *"}),e.jsx(o,{id:"phone",value:a.phone,onChange:s=>l({...a,phone:s.target.value}),placeholder:"+251 9XX XXX XXX"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"Email *"}),e.jsx(o,{id:"email",type:"email",value:a.email,onChange:s=>l({...a,email:s.target.value}),placeholder:"email@hospital.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"shift",children:"Shift"}),e.jsxs(F,{value:a.shift,onValueChange:s=>l({...a,shift:s}),children:[e.jsx(T,{children:e.jsx(L,{placeholder:"Select shift"})}),e.jsx(M,{children:Me.map(s=>e.jsx(k,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"status",children:"Status"}),e.jsxs(F,{value:a.status,onValueChange:s=>l({...a,status:s}),children:[e.jsx(T,{children:e.jsx(L,{placeholder:"Select status"})}),e.jsx(M,{children:ke.map(s=>e.jsx(k,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"join_date",children:"Join Date"}),e.jsx(o,{id:"join_date",type:"date",value:a.join_date,onChange:s=>l({...a,join_date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"salary",children:"Salary (ETB)"}),e.jsx(o,{id:"salary",type:"number",value:a.salary,onChange:s=>l({...a,salary:s.target.value}),placeholder:"Monthly salary"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(n,{htmlFor:"address",children:"Address"}),e.jsx(o,{id:"address",value:a.address,onChange:s=>l({...a,address:s.target.value}),placeholder:"Home address"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(n,{htmlFor:"emergency_contact",children:"Emergency Contact"}),e.jsx(o,{id:"emergency_contact",value:a.emergency_contact,onChange:s=>l({...a,emergency_contact:s.target.value}),placeholder:"Emergency contact name and phone"})]}),!p&&e.jsxs("div",{className:"col-span-2 border rounded-lg p-4 bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-base font-medium",children:"Create Login Account"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow this staff member to log into the system"})]}),e.jsx(ue,{checked:a.createAccount,onCheckedChange:s=>l({...a,createAccount:s})})]}),a.createAccount&&e.jsxs("div",{className:"space-y-4 pt-2 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Username"}),e.jsx(o,{value:a.email,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email will be used as username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"password",children:"Password *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{id:"password",type:"text",value:a.password,onChange:s=>l({...a,password:s.target.value}),placeholder:"Enter password (min 6 characters)",className:"flex-1"}),e.jsxs(g,{type:"button",variant:"outline",onClick:G,children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Generate"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Te,{className:"w-4 h-4 text-primary"}),e.jsx("p",{className:"text-sm",children:"Save the password and share it with the staff member securely."})]})]})]})]}),e.jsxs(Ne,{children:[e.jsx(g,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsxs(g,{onClick:Y,disabled:_,children:[_&&e.jsx(B,{className:"w-4 h-4 mr-2 animate-spin"}),p?"Update":a.createAccount?"Create with Account":"Add"," Staff"]})]})]})}),e.jsx(_e,{open:$,onOpenChange:C,onConfirm:Z,title:"Delete Staff Member",description:`Are you sure you want to delete ${m==null?void 0:m.name}? This action cannot be undone.`,loading:_})]})};export{es as default};
