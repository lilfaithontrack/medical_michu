import{f as v,r as m,d as oe,j as e}from"./index-MFUeX4KC.js";import{c as de,S as me,B as F,D as he,e as ge,f as pe,o as xe,g as V,p as ue,T as je,C as ve,i as be}from"./AdminLayout-CEyGcOXW.js";import{C as A,d as E,B as L,a as Q,b as X}from"./card--ujVzSXa.js";import{I as d,a as ye,A as fe}from"./Combination-CVDpaV-S.js";import{L as l}from"./label-Cw8AwbsX.js";import{T as $}from"./textarea-BWkPO5tB.js";import{T as Ne,a as _e,b as B,c as I}from"./tabs-BKpu8yr4.js";import{T as Ce,a as we,b as R,c as x,d as Se,e as g}from"./table-tgADzikB.js";import{D as De,a as Te,b as Ae,c as Ee,e as Le,d as Oe}from"./dialog-C_l7gpm1.js";import{S as b,a as y,b as f,c as N,d as o}from"./select-CM0PFwtY.js";import{E as Ue,D as ke}from"./DeleteConfirmDialog-Tv4EgB03.js";import{P as Pe}from"./plus-DrrZjkgX.js";import{L as Z}from"./loader-circle-DYBsGSuP.js";import{E as Fe}from"./eye-CxZXf5Ga.js";import{S as Ve}from"./square-pen-QpnerZQe.js";import"./index-lz0iHb9C.js";const O={async getAll(r={}){return(await v.get("/emergency",{params:r})).data},async getById(r){return(await v.get(`/emergency/${r}`)).data.data},async create(r){return(await v.post("/emergency",r)).data.data},async update(r,p){return(await v.put(`/emergency/${r}`,p)).data.data},async getActive(){return(await v.get("/emergency/active")).data.data},async getStats(){return(await v.get("/emergency/stats")).data.data},async delete(r){await v.delete(`/emergency/${r}`)}},Be={Resuscitation:"bg-black text-white border-black hover:bg-black/90",Critical:"bg-red-500 text-white border-red-500 hover:bg-red-600",Urgent:"bg-orange-500 text-white border-orange-500 hover:bg-orange-600","Less Urgent":"bg-yellow-500 text-white border-yellow-500 hover:bg-yellow-600","Non-Urgent":"bg-green-500 text-white border-green-500 hover:bg-green-600"},Ie={Waiting:"bg-slate-100 text-slate-800 border-slate-200","Under Treatment":"bg-blue-50 text-blue-700 border-blue-200",Stabilized:"bg-teal-50 text-teal-700 border-teal-200",Discharged:"bg-green-50 text-green-700 border-green-200",Transferred:"bg-purple-50 text-purple-700 border-purple-200",Deceased:"bg-red-50 text-red-700 border-red-200"},M=["Resuscitation","Critical","Urgent","Less Urgent","Non-Urgent"],Re=["Black","Red","Orange","Yellow","Green"],Me=["Waiting","Under Treatment","Stabilized","Discharged","Transferred","Deceased"],$e=["Male","Female"],He=["Admit","Discharge","Transfer","Death","LAMA"],Ge=({data:r,onChange:p})=>{const h=(c,_)=>{p({...r,[c]:_})};return e.jsxs("div",{className:"space-y-4 border rounded-md p-4 bg-muted/30",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"})," Primary Survey (ABCDE)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Airway"}),e.jsxs(b,{value:r==null?void 0:r.airway,onValueChange:c=>h("airway",c),children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Select Status"})}),e.jsxs(N,{children:[e.jsx(o,{value:"Patent",children:"Patent"}),e.jsx(o,{value:"Obstructed",children:"Obstructed"}),e.jsx(o,{value:"At Risk",children:"At Risk"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Breathing"}),e.jsxs(b,{value:r==null?void 0:r.breathing,onValueChange:c=>h("breathing",c),children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Select Status"})}),e.jsxs(N,{children:[e.jsx(o,{value:"Spontaneous",children:"Spontaneous"}),e.jsx(o,{value:"Labored",children:"Labored"}),e.jsx(o,{value:"Apneic",children:"Apneic"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Circulation"}),e.jsxs(b,{value:r==null?void 0:r.circulation,onValueChange:c=>h("circulation",c),children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Select Status"})}),e.jsxs(N,{children:[e.jsx(o,{value:"Stable",children:"Stable"}),e.jsx(o,{value:"Unstable",children:"Unstable"}),e.jsx(o,{value:"Shock",children:"Shock"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Disability (GCS)"}),e.jsx(d,{value:(r==null?void 0:r.disability)||"",onChange:c=>h("disability",c.target.value),placeholder:"E.g., GCS 15/15"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(l,{children:"Exposure/Notes"}),e.jsx($,{value:(r==null?void 0:r.exposure)||"",onChange:c=>h("exposure",c.target.value),placeholder:"Additional findings...",rows:2})]})]})]})},ns=()=>{var Y,q,J,K;const[r,p]=m.useState([]),[h,c]=m.useState(!0),[_,ee]=m.useState(""),[se,C]=m.useState(!1),[ae,U]=m.useState(!1),[u,S]=m.useState(null),[D,H]=m.useState(!1),[k,T]=m.useState(!1),{toast:j}=oe(),[a,n]=m.useState({patient_name:"",age:"",gender:"",chief_complaint:"",triage_level:"Urgent",triage_color:"Orange",triage_score:"3",status:"Waiting",bed_number:"",notes:"",primary_survey:{airway:"",breathing:"",circulation:"",disability:"",exposure:""},vitals:{bp:"",heart_rate:"",temp:"",spo2:"",resp_rate:""},procedures_performed:[],disposition_type:"",disposition_notes:""});m.useEffect(()=>{P()},[]);const P=async()=>{var s,t;try{c(!0);const i=await O.getAll({limit:100});p(i.data||[])}catch(i){j({title:"Error",description:((t=(s=i.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load emergency cases",variant:"destructive"})}finally{c(!1)}},G=()=>{n({patient_name:"",age:"",gender:"",chief_complaint:"",triage_level:"Urgent",triage_color:"Orange",triage_score:"3",status:"Waiting",bed_number:"",notes:"",primary_survey:{airway:"",breathing:"",circulation:"",disability:"",exposure:""},vitals:{bp:"",heart_rate:"",temp:"",spo2:"",resp_rate:""},procedures_performed:[],disposition_type:"",disposition_notes:""}),S(null),H(!1)},re=()=>{G(),C(!0)},te=s=>{var t,i;S(s),H(!0),n({patient_name:s.patient_name||"",age:((t=s.age)==null?void 0:t.toString())||"",gender:s.gender||"",chief_complaint:s.chief_complaint||"",triage_level:s.triage_level||"Urgent",triage_color:s.triage_color||"Orange",triage_score:((i=s.triage_score)==null?void 0:i.toString())||"3",status:s.status||"Waiting",bed_number:s.bed_number||"",notes:s.notes||"",primary_survey:s.primary_survey||{airway:"",breathing:"",circulation:"",disability:"",exposure:""},vitals:s.vitals||{bp:"",heart_rate:"",temp:"",spo2:"",resp_rate:""},procedures_performed:s.procedures_performed||[],disposition_type:s.disposition_type||"",disposition_notes:s.disposition_notes||""}),C(!0)},le=s=>{S(s),U(!0)},ie=async()=>{var s,t;if(!a.patient_name||!a.chief_complaint){j({title:"Error",description:"Please fill patient name and chief complaint",variant:"destructive"});return}try{T(!0);const i={...a,age:a.age?parseInt(a.age):null,triage_score:a.triage_score?parseInt(a.triage_score):null};D&&u?(await O.update(u.id,i),j({title:"Success",description:"Emergency case updated successfully"})):(await O.create(i),j({title:"Success",description:"Emergency case registered successfully"})),C(!1),G(),P()}catch(i){j({title:"Error",description:((t=(s=i.response)==null?void 0:s.data)==null?void 0:t.message)||"Operation failed",variant:"destructive"})}finally{T(!1)}},ne=async()=>{var s,t;if(u)try{T(!0),await O.delete(u.id),j({title:"Success",description:"Emergency case deleted successfully"}),U(!1),S(null),P()}catch(i){j({title:"Error",description:((t=(s=i.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to delete case",variant:"destructive"})}finally{T(!1)}},W=r.filter(s=>{var t,i,w;return((t=s.patient_name)==null?void 0:t.toLowerCase().includes(_.toLowerCase()))||((i=s.case_id)==null?void 0:i.toLowerCase().includes(_.toLowerCase()))||((w=s.chief_complaint)==null?void 0:w.toLowerCase().includes(_.toLowerCase()))}),ce=s=>s?new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"N/A",z=s=>Be[s]||"bg-gray-100 text-gray-800 border-gray-200";return e.jsxs(de,{title:"Emergency Department (ED)",subtitle:"Triage & Acute Care Management",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:M.map((s,t)=>{const i=r.filter(w=>w.triage_level===s&&!["Discharged","Deceased","Transferred"].includes(w.status)).length;return z(s),e.jsx(A,{className:`border-l-4 shadow-sm ${t===0?"border-l-black":t===1?"border-l-red-500":t===2?"border-l-orange-500":t===3?"border-l-yellow-500":"border-l-green-500"}`,children:e.jsxs(E,{className:"p-4 flex flex-col items-center justify-center text-center",children:[e.jsxs("span",{className:"text-xs font-semibold uppercase text-muted-foreground mb-1",children:["Level ",t+1]}),e.jsx("h3",{className:"text-lg font-bold leading-none mb-1",children:s}),e.jsx("p",{className:"text-3xl font-extrabold",children:i})]})},s)})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Search active cases...",className:"pl-10",value:_,onChange:s=>ee(s.target.value)})]}),e.jsxs(L,{className:"gap-2 bg-destructive hover:bg-destructive/90 text-white shadow-md",onClick:re,children:[e.jsx(Pe,{className:"w-4 h-4"}),"Register New Case"]})]}),e.jsx(A,{className:"shadow-md border-muted",children:e.jsx(E,{className:"p-0",children:h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Z,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(Ce,{children:[e.jsx(we,{className:"bg-muted/50",children:e.jsxs(R,{children:[e.jsx(x,{className:"w-[100px]",children:"Case ID"}),e.jsx(x,{children:"Patient"}),e.jsx(x,{className:"w-[80px]",children:"Score"}),e.jsx(x,{children:"Triage Level"}),e.jsx(x,{children:"Complaint"}),e.jsx(x,{children:"Arrival"}),e.jsx(x,{children:"Status"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsxs(Se,{children:[W.map(s=>e.jsxs(R,{className:"group hover:bg-muted/20 transition-colors",children:[e.jsx(g,{className:"font-mono text-xs text-muted-foreground",children:s.case_id}),e.jsx(g,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.age?`${s.age} yrs`:"N/A"," • ",s.gender||"N/A"]})]})}),e.jsx(g,{children:e.jsx(F,{variant:"outline",className:"font-mono",children:s.triage_score||"-"})}),e.jsx(g,{children:e.jsx(F,{className:`${z(s.triage_level)} shadow-sm`,children:s.triage_level})}),e.jsx(g,{className:"max-w-[200px] truncate text-sm",children:s.chief_complaint}),e.jsx(g,{className:"text-sm text-muted-foreground",children:ce(s.arrival_time||s.created_at)}),e.jsx(g,{children:e.jsx(F,{variant:"secondary",className:Ie[s.status]||"",children:s.status})}),e.jsx(g,{className:"text-right",children:e.jsxs(he,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(Ue,{className:"w-4 h-4"})})}),e.jsxs(pe,{align:"end",children:[e.jsx(xe,{children:"Actions"}),e.jsxs(V,{className:"gap-2 cursor-pointer",children:[e.jsx(Fe,{className:"w-4 h-4"})," View Details"]}),e.jsxs(V,{className:"gap-2 cursor-pointer",onClick:()=>te(s),children:[e.jsx(Ve,{className:"w-4 h-4"})," Triage / Update"]}),e.jsx(ue,{}),e.jsxs(V,{className:"gap-2 text-destructive cursor-pointer",onClick:()=>le(s),children:[e.jsx(je,{className:"w-4 h-4"})," Delete Case"]})]})]})})]},s.id)),W.length===0&&!h&&e.jsx(R,{children:e.jsx(g,{colSpan:8,className:"text-center py-12 text-muted-foreground",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(ve,{className:"w-10 h-10 opacity-20"}),e.jsx("p",{children:"No active emergency cases found matching your search."})]})})})]})]})})}),e.jsx(De,{open:se,onOpenChange:C,children:e.jsxs(Te,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ae,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-destructive"}),D?"Update Emergency Case":"New Emergency Case"]}),e.jsx(Le,{children:"Process patient triage, vitals, and initial assessment."})]}),e.jsxs(Ne,{defaultValue:"patient",className:"w-full",children:[e.jsxs(_e,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsx(B,{value:"patient",children:"Patient Info"}),e.jsx(B,{value:"triage",children:"Triage & Vitals"}),e.jsx(B,{value:"clinical",children:"Clinical Assessment"})]}),e.jsx(I,{value:"patient",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"patient_name",children:"Patient Name *"}),e.jsx(d,{id:"patient_name",value:a.patient_name,onChange:s=>n({...a,patient_name:s.target.value}),placeholder:"Full Name"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"age",children:"Age"}),e.jsx(d,{id:"age",type:"number",value:a.age,onChange:s=>n({...a,age:s.target.value}),placeholder:"Yrs"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"gender",children:"Gender"}),e.jsxs(b,{value:a.gender,onValueChange:s=>n({...a,gender:s}),children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Select"})}),e.jsx(N,{children:$e.map(s=>e.jsx(o,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(l,{htmlFor:"chief_complaint",children:"Chief Complaint *"}),e.jsx($,{id:"chief_complaint",value:a.chief_complaint,onChange:s=>n({...a,chief_complaint:s.target.value}),placeholder:"Reason for visit...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"status",children:"Current Status"}),e.jsxs(b,{value:a.status,onValueChange:s=>n({...a,status:s}),children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Status"})}),e.jsx(N,{children:Me.map(s=>e.jsx(o,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"bed_number",children:"Assigned Bed/Bay"}),e.jsx(d,{id:"bed_number",value:a.bed_number,onChange:s=>n({...a,bed_number:s.target.value}),placeholder:"Optional"})]})]})}),e.jsx(I,{value:"triage",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(A,{className:"border-destructive/20 bg-destructive/5",children:[e.jsx(Q,{className:"pb-2",children:e.jsx(X,{className:"text-base",children:"Triage Classification"})}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Select Level"}),e.jsxs(b,{value:a.triage_level,onValueChange:s=>{const t=M.indexOf(s);n({...a,triage_level:s,triage_color:Re[t]||"Orange",triage_score:(t+1).toString()})},children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Level"})}),e.jsx(N,{children:M.map(s=>e.jsx(o,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Color Code"}),e.jsx(d,{value:a.triage_color,readOnly:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"ESI Score (1-5)"}),e.jsx(d,{value:a.triage_score,readOnly:!0,className:"bg-muted"})]})]})]})]}),e.jsxs(A,{children:[e.jsx(Q,{className:"pb-2",children:e.jsxs(X,{className:"text-base flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"})," Vital Signs"]})}),e.jsxs(E,{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"text-xs",children:"BP (mmHg)"}),e.jsx(d,{placeholder:"120/80",value:((Y=a.vitals)==null?void 0:Y.bp)||"",onChange:s=>n({...a,vitals:{...a.vitals,bp:s.target.value}})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"text-xs",children:"HR (bpm)"}),e.jsx(d,{placeholder:"80",value:((q=a.vitals)==null?void 0:q.heart_rate)||"",onChange:s=>n({...a,vitals:{...a.vitals,heart_rate:s.target.value}})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"text-xs",children:"Temp (°C)"}),e.jsx(d,{placeholder:"37.0",value:((J=a.vitals)==null?void 0:J.temp)||"",onChange:s=>n({...a,vitals:{...a.vitals,temp:s.target.value}})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{className:"text-xs",children:"SpO2 (%)"}),e.jsx(d,{placeholder:"98",value:((K=a.vitals)==null?void 0:K.spo2)||"",onChange:s=>n({...a,vitals:{...a.vitals,spo2:s.target.value}})})]})]})]})]})}),e.jsxs(I,{value:"clinical",className:"space-y-4",children:[e.jsx(Ge,{data:a.primary_survey,onChange:s=>n({...a,primary_survey:s})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Disposition Plan"}),e.jsxs(b,{value:a.disposition_type,onValueChange:s=>n({...a,disposition_type:s}),children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Select Plan"})}),e.jsx(N,{children:He.map(s=>e.jsx(o,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"General Notes"}),e.jsx($,{rows:2,placeholder:"Clinical notes...",value:a.notes,onChange:s=>n({...a,notes:s.target.value})})]})]})]})]}),e.jsxs(Oe,{className:"mt-6",children:[e.jsx(L,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsxs(L,{onClick:ie,disabled:k,className:D?"bg-amber-600 hover:bg-amber-700":"",children:[k&&e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),D?"Update Case":"Register Patient"]})]})]})}),e.jsx(ke,{open:ae,onOpenChange:U,onConfirm:ne,title:"Delete Emergency Case",description:`Are you sure you want to delete the emergency case for ${u==null?void 0:u.patient_name}?`,loading:k})]})};export{ns as default};
