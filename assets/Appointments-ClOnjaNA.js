import{c as q,r as p,j as e,f as x,d as H}from"./index-MFUeX4KC.js";import{c as G,S as X,C as M,A as W,a as J,B as K,D as Q,e as Y,f as Z,g as E,h as V,T as ee}from"./AdminLayout-CEyGcOXW.js";import{B as _,C as se,d as te}from"./card--ujVzSXa.js";import{I as T}from"./Combination-CVDpaV-S.js";import{T as ae,a as ne,b as I,c as f,d as re,e as j}from"./table-tgADzikB.js";import{D as ie,a as oe,b as le,c as de,d as ce}from"./dialog-C_l7gpm1.js";import{L as m}from"./label-Cw8AwbsX.js";import{S as y,a as v,b,c as C,d as u}from"./select-CM0PFwtY.js";import{p as me}from"./patientService-CtAKoHA_.js";import{d as pe}from"./doctorService-Cf-rqgNH.js";import{E as ue,D as he}from"./DeleteConfirmDialog-Tv4EgB03.js";import{F as xe}from"./filter-MFaesxLD.js";import{P as ge}from"./plus-DrrZjkgX.js";import{L as je}from"./loader-circle-DYBsGSuP.js";import{S as fe}from"./square-pen-QpnerZQe.js";import"./index-lz0iHb9C.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=q("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ye=["Check-up","Follow-up","Consultation","Surgery Prep","Lab Results","Emergency"],ve=["Cardiology","Neurology","Pediatrics","Orthopedics","Dermatology","General"],be=["Pending","Paid","Partially Paid","Waived"],Ce=["Cash","Card","Insurance","Bank Transfer"],$={patient_id:"",doctor_id:"",date:new Date().toISOString().split("T")[0],time:"09:00 AM",type:"Check-up",status:"Scheduled",department:"General",reason:"",symptoms:"",notes:"",payment_status:"Pending",payment_method:"",amount:0};function Ne({open:r,onOpenChange:l,appointment:n,onSave:D}){const[a,d]=p.useState($),[P,N]=p.useState([]),[L,w]=p.useState([]),[F,g]=p.useState(!1);p.useEffect(()=>{(async()=>{if(r)try{g(!0);const[S,k]=await Promise.all([me.getAll({limit:100}),pe.getAll({limit:100})]);N(S.data||[]),k.data?w(k.data):w([])}catch(S){console.error("Failed to load dependency data",S)}finally{g(!1)}})()},[r]),p.useEffect(()=>{d(n?{patient_id:n.patient_id||"",doctor_id:n.doctor_id||"",date:n.date,time:n.time,type:n.type,status:n.status,department:n.department,reason:n.reason||"",symptoms:n.symptoms||"",notes:n.notes||"",payment_status:n.payment_status||"Pending",payment_method:n.payment_method||"",amount:n.amount||0}:$)},[n,r]);const h=s=>{s.preventDefault(),D(n?{...a,id:n.id}:a),l(!1)};return e.jsx(ie,{open:r,onOpenChange:l,children:e.jsxs(oe,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(le,{children:e.jsx(de,{children:n?"Edit Appointment":"New Appointment"})}),e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"patient",children:"Patient"}),e.jsxs(y,{value:a.patient_id,onValueChange:s=>d({...a,patient_id:s}),disabled:!!n,children:[e.jsx(v,{children:e.jsx(b,{placeholder:"Select Patient"})}),e.jsx(C,{children:P.map(s=>e.jsxs(u,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"doctor",children:"Doctor"}),e.jsxs(y,{value:a.doctor_id,onValueChange:s=>d({...a,doctor_id:s}),children:[e.jsx(v,{children:e.jsx(b,{placeholder:"Select Doctor"})}),e.jsx(C,{children:L.map(s=>e.jsxs(u,{value:s.id,children:[s.name," - ",s.specialization]},s.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"date",children:"Date"}),e.jsx(T,{id:"date",type:"date",value:a.date,onChange:s=>d({...a,date:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"time",children:"Time"}),e.jsx(T,{id:"time",value:a.time,onChange:s=>d({...a,time:s.target.value}),placeholder:"09:00 AM",required:!0,maxLength:10})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"type",children:"Type"}),e.jsxs(y,{value:a.type,onValueChange:s=>d({...a,type:s}),children:[e.jsx(v,{children:e.jsx(b,{})}),e.jsx(C,{children:ye.map(s=>e.jsx(u,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"department",children:"Department"}),e.jsxs(y,{value:a.department,onValueChange:s=>d({...a,department:s}),children:[e.jsx(v,{children:e.jsx(b,{})}),e.jsx(C,{children:ve.map(s=>e.jsx(u,{value:s,children:s},s))})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"symptoms",children:"Symptoms"}),e.jsx("textarea",{id:"symptoms",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:a.symptoms,onChange:s=>d({...a,symptoms:s.target.value}),placeholder:"Describe patient symptoms..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"reason",children:"Reason for Visit"}),e.jsx("textarea",{id:"reason",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:a.reason,onChange:s=>d({...a,reason:s.target.value}),placeholder:"Reason for appointment..."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"payment_status",children:"Payment Status"}),e.jsxs(y,{value:a.payment_status,onValueChange:s=>d({...a,payment_status:s}),children:[e.jsx(v,{children:e.jsx(b,{})}),e.jsx(C,{children:be.map(s=>e.jsx(u,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"payment_method",children:"Payment Method"}),e.jsxs(y,{value:a.payment_method,onValueChange:s=>d({...a,payment_method:s}),children:[e.jsx(v,{children:e.jsx(b,{placeholder:"Select Method"})}),e.jsx(C,{children:Ce.map(s=>e.jsx(u,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"amount",children:"Amount"}),e.jsx(T,{id:"amount",type:"number",value:a.amount,onChange:s=>d({...a,amount:parseFloat(s.target.value)||0}),placeholder:"0.00"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",className:"flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:a.notes,onChange:s=>d({...a,notes:s.target.value}),placeholder:"Additional notes..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"status",children:"Status"}),e.jsxs(y,{value:a.status,onValueChange:s=>d({...a,status:s}),children:[e.jsx(v,{children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(u,{value:"Scheduled",children:"Scheduled"}),e.jsx(u,{value:"Confirmed",children:"Confirmed"}),e.jsx(u,{value:"Completed",children:"Completed"}),e.jsx(u,{value:"Cancelled",children:"Cancelled"}),e.jsx(u,{value:"No Show",children:"No Show"})]})]})]}),e.jsxs(ce,{children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsxs(_,{type:"submit",children:[n?"Update":"Create"," Appointment"]})]})]})]})})}const A={async getAll(r={}){return(await x.get("/appointments",{params:r})).data},async getById(r){return(await x.get(`/appointments/${r}`)).data.data},async create(r){return(await x.post("/appointments",r)).data.data},async update(r,l){return(await x.put(`/appointments/${r}`,l)).data.data},async updateStatus(r,l){return(await x.put(`/appointments/${r}/status`,{status:l})).data.data},async cancel(r){await x.delete(`/appointments/${r}`)},async getToday(){return(await x.get("/appointments/today")).data.data},async getByDate(r){return(await x.get(`/appointments/date/${r}`)).data.data},async getAvailableSlots(r,l,n=30){return(await x.get("/appointments/available-slots",{params:{doctor_id:r,date:l,duration:n}})).data.data},async getStats(r,l){return(await x.get("/appointments/stats",{params:{startDate:r,endDate:l}})).data.data}},we={Scheduled:"bg-info/10 text-info border-info/20",Confirmed:"bg-success/10 text-success border-success/20",Completed:"bg-muted text-muted-foreground border-border",Cancelled:"bg-destructive/10 text-destructive border-destructive/20","In Progress":"bg-warning/10 text-warning border-warning/20","No Show":"bg-destructive/10 text-destructive border-destructive/20"},Se={Scheduled:M,Confirmed:V,Completed:V,Cancelled:B,"In Progress":M,"No Show":B},ze=()=>{const[r,l]=p.useState([]),[n,D]=p.useState(!0),[a,d]=p.useState(""),[P,N]=p.useState(!1),[L,w]=p.useState(!1),[F,g]=p.useState(null),{toast:h}=H();p.useEffect(()=>{s()},[]);const s=async()=>{var t,o;try{D(!0);const i=await A.getAll({limit:100});l(i.data||[])}catch(i){h({title:"Error",description:((o=(t=i.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to load appointments",variant:"destructive"})}finally{D(!1)}},S=r.filter(t=>{var o,i,c;return((o=t.patient_name)==null?void 0:o.toLowerCase().includes(a.toLowerCase()))||((i=t.doctor_name)==null?void 0:i.toLowerCase().includes(a.toLowerCase()))||((c=t.appointment_id)==null?void 0:c.toLowerCase().includes(a.toLowerCase()))}),k=async t=>{var o,i;try{t.id?(await A.update(t.id,t),h({title:"Appointment Updated",description:"Appointment has been updated."})):(await A.create(t),h({title:"Appointment Created",description:"New appointment has been scheduled."})),s(),g(null),N(!1)}catch(c){h({title:"Error",description:((i=(o=c.response)==null?void 0:o.data)==null?void 0:i.message)||"Failed to save appointment",variant:"destructive"})}},R=async()=>{var t,o;if(F)try{await A.cancel(F.id),h({title:"Appointment Cancelled",description:"Appointment has been removed.",variant:"destructive"}),s(),g(null)}catch(i){h({title:"Error",description:((o=(t=i.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to cancel appointment",variant:"destructive"})}w(!1)},O=async t=>{var o,i;try{await A.updateStatus(t.id,"Completed"),h({title:"Appointment Completed",description:"Appointment marked as complete."}),s()}catch(c){h({title:"Error",description:((i=(o=c.response)==null?void 0:o.data)==null?void 0:i.message)||"Failed to update status",variant:"destructive"})}},z=t=>t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",U=t=>{if(!t)return"";const[o,i]=t.split(":"),c=parseInt(o);return`${c>12?c-12:c}:${i} ${c>=12?"PM":"AM"}`};return e.jsxs(G,{title:"Appointments",subtitle:"Manage patient appointments and schedules",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(T,{placeholder:"Search appointments...",className:"pl-10",value:a,onChange:t=>d(t.target.value)})]}),e.jsx(_,{variant:"outline",size:"icon",children:e.jsx(xe,{className:"w-4 h-4"})})]}),e.jsxs(_,{className:"gap-2",onClick:()=>{g(null),N(!0)},children:[e.jsx(ge,{className:"w-4 h-4"}),"New Appointment"]})]}),e.jsx(se,{children:e.jsx(te,{className:"p-0",children:n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(je,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(ae,{children:[e.jsx(ne,{children:e.jsxs(I,{children:[e.jsx(f,{children:"ID"}),e.jsx(f,{children:"Patient"}),e.jsx(f,{children:"Doctor"}),e.jsx(f,{children:"Date & Time"}),e.jsx(f,{children:"Type"}),e.jsx(f,{children:"Status"}),e.jsx(f,{className:"text-right",children:"Actions"})]})}),e.jsxs(re,{children:[S.map(t=>{var i;const o=Se[t.status]||M;return e.jsxs(I,{className:"group",children:[e.jsx(j,{className:"font-mono text-sm",children:t.appointment_id}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"h-8 w-8",children:e.jsx(J,{className:"bg-primary/10 text-primary text-xs",children:((i=t.patient_name)==null?void 0:i.split(" ").map(c=>c[0]).join("").substring(0,2))||"P"})}),e.jsx("span",{className:"font-medium",children:t.patient_name||"Unknown"})]})}),e.jsx(j,{className:"text-muted-foreground",children:t.doctor_name||"Unassigned"}),e.jsx(j,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:z(t.appointment_date)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:U(t.appointment_time)})]})}),e.jsx(j,{children:t.type||"Consultation"}),e.jsx(j,{children:e.jsxs(K,{variant:"outline",className:`gap-1 ${we[t.status]||""}`,children:[e.jsx(o,{className:"w-3 h-3"}),t.status]})}),e.jsx(j,{className:"text-right",children:e.jsxs(Q,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(_,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(ue,{className:"w-4 h-4"})})}),e.jsxs(Z,{align:"end",children:[e.jsxs(E,{className:"gap-2",onClick:()=>{g(t),N(!0)},children:[e.jsx(fe,{className:"w-4 h-4"})," Edit"]}),t.status!=="Completed"&&t.status!=="Cancelled"&&e.jsxs(E,{className:"gap-2",onClick:()=>O(t),children:[e.jsx(V,{className:"w-4 h-4"})," Mark Complete"]}),e.jsxs(E,{className:"gap-2 text-destructive",onClick:()=>{g(t),w(!0)},children:[e.jsx(ee,{className:"w-4 h-4"})," Cancel"]})]})]})})]},t.id)}),S.length===0&&!n&&e.jsx(I,{children:e.jsx(j,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No appointments found"})})]})]})})}),e.jsx(Ne,{open:P,onOpenChange:N,appointment:F,onSave:k}),e.jsx(he,{open:L,onOpenChange:w,title:"Cancel Appointment",description:"Cancel this appointment?",onConfirm:R})]})};export{ze as default};
