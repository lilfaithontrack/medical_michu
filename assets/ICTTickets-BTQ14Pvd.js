import{R as T,j as e,r as m,d as b}from"./index-DIh5wxCw.js";import{b as k}from"./AdminLayout-CVdM3u-8.js";import{i as x}from"./ictService-BhDKOsZs.js";import{B as f,C,d as w}from"./card-BVj2mpCd.js";import{B as S}from"./badge-DwC97fZb.js";import{u as O}from"./index.esm-DrJAPi1Y.js";import{D as P,a as I,b as F,c as V,d as H,T as A}from"./dialog-CmLsLM44.js";import{L as j}from"./label-BOSjw2jr.js";import{T as E}from"./textarea-DqMGnoNS.js";import{S as g,a as v,b as y,c as N,d as r}from"./select-DxzT1k0b.js";import{P as L}from"./plus-BlBB68lF.js";import"./index-CXyJ5PVz.js";import"./Combination-B3qkWEI7.js";import"./index-lGeLsNXG.js";function M({open:c,onOpenChange:o,initialData:t,onSubmit:l}){const{register:d,handleSubmit:n,reset:i,setValue:a,formState:{errors:u,isSubmitting:p}}=O();return T.useEffect(()=>{c&&i(t||{priority:"Medium",status:"Open",issue_type:"Software"})},[c,t,i]),e.jsx(P,{open:c,onOpenChange:o,children:e.jsxs(I,{children:[e.jsx(F,{children:e.jsx(V,{children:t?"Update Ticket":"Open Support Ticket"})}),e.jsxs("form",{onSubmit:n(l),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Issue Category"}),e.jsxs(g,{onValueChange:s=>a("issue_type",s),defaultValue:(t==null?void 0:t.issue_type)||"Software",children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Category"})}),e.jsxs(N,{children:[e.jsx(r,{value:"Hardware",children:"Hardware Failure"}),e.jsx(r,{value:"Software",children:"Software/App Issue"}),e.jsx(r,{value:"Network",children:"Network/Connectivity"}),e.jsx(r,{value:"Access",children:"Account/Access"}),e.jsx(r,{value:"Printer",children:"Printing"}),e.jsx(r,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Priority"}),e.jsxs(g,{onValueChange:s=>a("priority",s),defaultValue:(t==null?void 0:t.priority)||"Medium",children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Priority"})}),e.jsxs(N,{children:[e.jsx(r,{value:"Low",children:"Low"}),e.jsx(r,{value:"Medium",children:"Medium"}),e.jsx(r,{value:"High",children:"High (Urgent)"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"description",children:"Description of Issue"}),e.jsx(E,{id:"description",...d("description",{required:"Description is required"}),placeholder:"Please describe the problem in detail...",className:"min-h-[100px]"}),u.description&&e.jsx("p",{className:"text-sm text-destructive",children:u.description.message})]}),t&&e.jsxs("div",{className:"space-y-2 bg-muted p-3 rounded-md",children:[e.jsx(j,{children:"Status Update"}),e.jsxs(g,{onValueChange:s=>a("status",s),defaultValue:t.status,children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Status"})}),e.jsxs(N,{children:[e.jsx(r,{value:"Open",children:"Open"}),e.jsx(r,{value:"In Progress",children:"In Progress"}),e.jsx(r,{value:"Resolved",children:"Resolved"}),e.jsx(r,{value:"Closed",children:"Closed"})]})]})]}),e.jsxs(H,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(f,{type:"submit",disabled:p,children:p?"Saving...":t?"Update Ticket":"Submit Ticket"})]})]})]})})}const D=()=>{const[c,o]=m.useState([]),[t,l]=m.useState(!1),[d,n]=m.useState(null),{toast:i}=b(),a=async()=>{try{const s=await x.getTickets();o(s.data||[])}catch(s){console.error("Failed to fetch tickets",s)}};m.useEffect(()=>{a()},[]);const u=async s=>{try{d?(await x.updateTicket(d.id,s),i({title:"Updated",description:"Ticket updated successfully."})):(await x.addTicket(s),i({title:"Created",description:"Support ticket created."})),l(!1),a()}catch{i({variant:"destructive",title:"Error",description:"Failed to save ticket."})}},p=async(s,h)=>{if(s.stopPropagation(),!!confirm("Are you sure you want to delete this ticket?"))try{await x.deleteTicket(h),i({title:"Success",description:"Ticket deleted."}),a()}catch{i({variant:"destructive",title:"Error",description:"Failed to delete ticket."})}};return e.jsxs(k,{title:"ICT Support Tickets",subtitle:"Helpdesk & Issue Tracking",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("div",{className:"flex gap-2 ml-auto",children:e.jsxs(f,{onClick:()=>{n(null),l(!0)},className:"gap-2",children:[e.jsx(L,{className:"w-4 h-4"})," Open Ticket"]})})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[c.map(s=>e.jsx(C,{className:"cursor-pointer hover:border-primary/50 group",onClick:()=>{n(s),l(!0)},children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-xs bg-muted px-2 py-1 rounded",children:s.ticket_id}),e.jsx("h3",{className:"font-semibold text-lg",children:s.issue_type}),e.jsx(S,{variant:s.priority==="High"?"destructive":s.priority==="Medium"?"default":"outline",children:s.priority})]}),e.jsx("p",{className:"text-muted-foreground",children:s.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:s.status==="Open"?"default":s.status==="Resolved"?"secondary":"outline",className:"uppercase",children:s.status}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity text-destructive hover:text-destructive hover:bg-destructive/10",onClick:h=>p(h,s.id),children:e.jsx(A,{className:"w-4 h-4"})})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})]})]})})},s.id)),c.length===0&&e.jsx("div",{className:"py-12 text-center text-muted-foreground border-2 border-dashed rounded-lg",children:"No tickets found."})]})]}),e.jsx(M,{open:t,onOpenChange:l,initialData:d,onSubmit:u})]})};export{D as default};
