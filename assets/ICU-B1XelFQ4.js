import{r as i,d as ie,j as e}from"./index-D78T4imR.js";import{c as ne,T as re,b as le,S as oe,B as A,D as ce,e as de,f as me,g as U}from"./AdminLayout-BtskhTy9.js";import{C as h,d as u,B as N}from"./card-C-gqQ2Kk.js";import{A as xe,I as he}from"./Combination-_iD594Rc.js";import{L as d}from"./label-w-1BiFyq.js";import{T as V}from"./textarea-CRZhH00m.js";import{S as ue}from"./switch-CsnzGRqq.js";import{T as pe,a as je,b as P,c as m,d as ge,e as l}from"./table-C3lzzPFT.js";import{E as fe,S as ve,T as Ne,D as Ce,a as Se,b as we,c as ye,f as be,d as _e,e as De}from"./DeleteConfirmDialog-DGUrLfLj.js";import{S as C,a as S,b as w,c as y,d as b}from"./select-DRVA5bys.js";import{i as p}from"./facilityService-DFmrmyg1.js";import{p as Ie}from"./patientService-BRDsGSW5.js";import{d as Te}from"./doctorService-CLVUwGBi.js";import{H as Ae}from"./heart-B4yExWTD.js";import{P as Ue}from"./plus-DSx3Cbm8.js";import{L as k}from"./loader-circle-B7-Z8OSf.js";import{E as Pe}from"./eye-CYehyE3Z.js";import"./index-Dldki3LP.js";const Ee=["Critical","Serious","Stable","Improving"],Oe=["Active","Transferred","Discharged","Deceased"],Ze=()=>{const[j,R]=i.useState([]),[H,M]=i.useState([]),[q,z]=i.useState([]),[Y,$]=i.useState([]),[E,O]=i.useState(!0),[_,G]=i.useState(""),[J,x]=i.useState(!1),[K,D]=i.useState(!1),[o,g]=i.useState(null),[f,F]=i.useState(!1),[I,v]=i.useState(!1),{toast:c}=ie(),[t,r]=i.useState({patient_id:"",doctor_id:"",admission_date:new Date().toISOString().split("T")[0],diagnosis:"",condition:"Critical",ventilator_support:!1,status:"Active",notes:""});i.useEffect(()=>{T(),Q()},[]);const T=async()=>{var s,a;try{O(!0);const[n,ae]=await Promise.all([p.getAll({limit:100}),p.getBeds().catch(()=>[])]);R(n.data||[]),M(ae||[])}catch(n){c({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to load ICU data",variant:"destructive"})}finally{O(!1)}},Q=async()=>{try{const[s,a]=await Promise.all([Ie.getAll({limit:200}),Te.getAll({limit:100})]);z(s.data||[]),$(a.data||[])}catch(s){console.error("Failed to load lookups:",s)}},L=()=>{r({patient_id:"",doctor_id:"",admission_date:new Date().toISOString().split("T")[0],diagnosis:"",condition:"Critical",ventilator_support:!1,status:"Active",notes:""}),g(null),F(!1)},W=()=>{L(),x(!0)},X=s=>{var a;g(s),F(!0),r({patient_id:s.patient_id||"",doctor_id:s.doctor_id||"",admission_date:((a=s.admission_date)==null?void 0:a.split("T")[0])||new Date().toISOString().split("T")[0],diagnosis:s.diagnosis||"",condition:s.condition||"Critical",ventilator_support:s.ventilator_support||!1,status:s.status||"Active",notes:s.notes||""}),x(!0)},Z=s=>{g(s),D(!0)},ee=async()=>{var s,a;if(!t.patient_id||!t.doctor_id){c({title:"Error",description:"Please select patient and doctor",variant:"destructive"});return}try{v(!0),f&&o?(await p.update(o.id,t),c({title:"Success",description:"ICU patient updated successfully"})):(await p.create(t),c({title:"Success",description:"Patient admitted to ICU successfully"})),x(!1),L(),T()}catch(n){c({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Operation failed",variant:"destructive"})}finally{v(!1)}},se=async()=>{var s,a;if(o)try{v(!0),await p.delete(o.id),c({title:"Success",description:"ICU record deleted successfully"}),D(!1),g(null),T()}catch(n){c({title:"Error",description:((a=(s=n.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to delete record",variant:"destructive"})}finally{v(!1)}},B=j.filter(s=>{var a,n;return((a=s.patient_name)==null?void 0:a.toLowerCase().includes(_.toLowerCase()))||((n=s.bed_number)==null?void 0:n.toLowerCase().includes(_.toLowerCase()))}),te=H.filter(s=>s.status==="Available").length;return e.jsxs(ne,{title:"ICU",subtitle:"Intensive Care Unit Monitoring",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(h,{className:"border-destructive/50",children:e.jsx(u,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"ICU Patients"}),e.jsx("p",{className:"text-3xl font-bold text-destructive",children:j.length})]}),e.jsx(re,{className:"w-8 h-8 text-destructive"})]})})}),e.jsx(h,{children:e.jsx(u,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Critical"}),e.jsx("p",{className:"text-3xl font-bold text-warning",children:j.filter(s=>s.condition==="Critical").length})]}),e.jsx(Ae,{className:"w-8 h-8 text-warning"})]})})}),e.jsx(h,{children:e.jsx(u,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"On Ventilator"}),e.jsx("p",{className:"text-3xl font-bold",children:j.filter(s=>s.ventilator_support).length})]}),e.jsx(xe,{className:"w-8 h-8 text-muted-foreground"})]})})}),e.jsx(h,{children:e.jsx(u,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Available Beds"}),e.jsx("p",{className:"text-3xl font-bold text-success",children:te})]}),e.jsx(le,{className:"w-8 h-8 text-success"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(he,{placeholder:"Search ICU patients...",className:"pl-10",value:_,onChange:s=>G(s.target.value)})]}),e.jsxs(N,{className:"gap-2",onClick:W,children:[e.jsx(Ue,{className:"w-4 h-4"}),"Admit to ICU"]})]}),e.jsx(h,{children:e.jsx(u,{className:"p-0",children:E?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):e.jsxs(pe,{children:[e.jsx(je,{children:e.jsxs(P,{children:[e.jsx(m,{children:"Bed"}),e.jsx(m,{children:"Patient"}),e.jsx(m,{children:"Diagnosis"}),e.jsx(m,{children:"Condition"}),e.jsx(m,{children:"Ventilator"}),e.jsx(m,{children:"Status"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsxs(ge,{children:[B.map(s=>e.jsxs(P,{className:"group",children:[e.jsx(l,{className:"font-bold",children:s.bed_number}),e.jsx(l,{className:"font-medium",children:s.patient_name||"Unknown"}),e.jsx(l,{className:"max-w-[200px] truncate",children:s.diagnosis}),e.jsx(l,{children:e.jsx(A,{variant:"outline",className:s.condition==="Critical"?"border-destructive text-destructive":"border-warning text-warning",children:s.condition})}),e.jsx(l,{children:e.jsx(A,{variant:s.ventilator_support?"destructive":"secondary",children:s.ventilator_support?"Yes":"No"})}),e.jsx(l,{children:e.jsx(A,{variant:"outline",children:s.status})}),e.jsx(l,{className:"text-right",children:e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100",children:e.jsx(fe,{className:"w-4 h-4"})})}),e.jsxs(me,{align:"end",children:[e.jsxs(U,{className:"gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"})," View Vitals"]}),e.jsxs(U,{className:"gap-2",onClick:()=>X(s),children:[e.jsx(ve,{className:"w-4 h-4"})," Update"]}),e.jsxs(U,{className:"gap-2 text-destructive",onClick:()=>Z(s),children:[e.jsx(Ne,{className:"w-4 h-4"})," Remove"]})]})]})})]},s.id)),B.length===0&&!E&&e.jsx(P,{children:e.jsx(l,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No ICU patients found"})})]})]})})}),e.jsx(Ce,{open:J,onOpenChange:x,children:e.jsxs(Se,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(we,{children:[e.jsx(ye,{children:f?"Update ICU Patient":"Admit to ICU"}),e.jsx(be,{children:f?"Update patient condition and status":"Admit a patient to intensive care unit"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"patient_id",children:"Patient *"}),e.jsxs(C,{value:t.patient_id,onValueChange:s=>r({...t,patient_id:s}),children:[e.jsx(S,{children:e.jsx(w,{placeholder:"Select patient"})}),e.jsx(y,{className:"max-h-60",children:q.map(s=>e.jsxs(b,{value:s.id,children:[s.name," (",s.patient_id,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"doctor_id",children:"Attending Physician *"}),e.jsxs(C,{value:t.doctor_id,onValueChange:s=>r({...t,doctor_id:s}),children:[e.jsx(S,{children:e.jsx(w,{placeholder:"Select doctor"})}),e.jsx(y,{className:"max-h-60",children:Y.map(s=>e.jsxs(b,{value:s.id,children:["Dr. ",s.name," (",s.specialization,")"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"diagnosis",children:"Diagnosis"}),e.jsx(V,{id:"diagnosis",value:t.diagnosis,onChange:s=>r({...t,diagnosis:s.target.value}),placeholder:"Primary diagnosis",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"condition",children:"Condition"}),e.jsxs(C,{value:t.condition,onValueChange:s=>r({...t,condition:s}),children:[e.jsx(S,{children:e.jsx(w,{placeholder:"Select condition"})}),e.jsx(y,{children:Ee.map(s=>e.jsx(b,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"status",children:"Status"}),e.jsxs(C,{value:t.status,onValueChange:s=>r({...t,status:s}),children:[e.jsx(S,{children:e.jsx(w,{placeholder:"Select status"})}),e.jsx(y,{children:Oe.map(s=>e.jsx(b,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{id:"ventilator",checked:t.ventilator_support,onCheckedChange:s=>r({...t,ventilator_support:s})}),e.jsx(d,{htmlFor:"ventilator",children:"Ventilator Support Required"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"notes",children:"Notes"}),e.jsx(V,{id:"notes",value:t.notes,onChange:s=>r({...t,notes:s.target.value}),placeholder:"Additional notes",rows:2})]})]}),e.jsxs(_e,{children:[e.jsx(N,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsxs(N,{onClick:ee,disabled:I,children:[I&&e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),f?"Update":"Admit"," Patient"]})]})]})}),e.jsx(De,{open:K,onOpenChange:D,onConfirm:se,title:"Remove ICU Patient",description:`Are you sure you want to remove ${o==null?void 0:o.patient_name} from ICU records?`,loading:I})]})};export{Ze as default};
